(self["webpackChunkwebsap"]=self["webpackChunkwebsap"]||[]).push([[869],{1874:function(e,a,s){"use strict";s.d(a,{A:function(){return P}});var t=s(641),r=s(33),o=s(3751);const l={class:"backups-container"},n={class:"backups-actions"},i=["disabled"],c={key:0},u={key:1},d={key:0,class:"loading-container"},v={key:1,class:"empty-state"},p={key:2,class:"backups-grid"},m={class:"backup-info"},k={class:"backup-date"},g={class:"backup-size"},h={class:"backup-actions"},b=["onClick","disabled"],y={key:0},L={key:1},f=["onClick"],E=["onClick","disabled"],w={key:0},C={key:1},D={class:"modal-container"},S={class:"modal-header"},U={class:"modal-footer"};function R(e,a,s,R,I,_){return(0,t.uX)(),(0,t.CE)("div",l,[a[12]||(a[12]=(0,t.Lk)("h2",{class:"section-title"},"Gestión de Respaldos",-1)),(0,t.Lk)("div",n,[(0,t.Lk)("button",{onClick:a[0]||(a[0]=(...e)=>R.createNewBackup&&R.createNewBackup(...e)),class:"create-backup-btn",disabled:R.creating},[R.creating?((0,t.uX)(),(0,t.CE)("span",c,a[5]||(a[5]=[(0,t.Lk)("span",{class:"loading-spinner"},null,-1),(0,t.eW)(" Creando respaldo... ")]))):((0,t.uX)(),(0,t.CE)("span",u,a[6]||(a[6]=[(0,t.Lk)("span",{class:"action-icon"},"💾",-1),(0,t.eW)(" Crear respaldo ahora ")])))],8,i)]),R.loading?((0,t.uX)(),(0,t.CE)("div",d,a[7]||(a[7]=[(0,t.Lk)("div",{class:"spinner"},null,-1),(0,t.Lk)("p",null,"Cargando respaldos...",-1)]))):0===R.backups.length?((0,t.uX)(),(0,t.CE)("div",v,a[8]||(a[8]=[(0,t.Lk)("div",{class:"empty-icon"},"📂",-1),(0,t.Lk)("p",null,"No hay respaldos disponibles",-1),(0,t.Lk)("p",{class:"empty-desc"},'Crea tu primer respaldo haciendo clic en el botón "Crear respaldo ahora"',-1)]))):((0,t.uX)(),(0,t.CE)("div",p,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(R.backups,(e=>((0,t.uX)(),(0,t.CE)("div",{key:e.id,class:"backup-card"},[a[9]||(a[9]=(0,t.Lk)("div",{class:"backup-icon"},"💾",-1)),(0,t.Lk)("div",m,[(0,t.Lk)("h3",null,(0,r.v_)(e.archivo),1),(0,t.Lk)("p",k,"Fecha: "+(0,r.v_)(R.formatDate(e.fecha)),1),(0,t.Lk)("p",g,"Tamaño: "+(0,r.v_)(e.tamano),1)]),(0,t.Lk)("div",h,[(0,t.Lk)("button",{onClick:a=>R.restoreBackup(e),class:"restore-btn",disabled:R.restoring===e.id},[R.restoring===e.id?((0,t.uX)(),(0,t.CE)("span",y,"Restaurando...")):((0,t.uX)(),(0,t.CE)("span",L,"Restaurar"))],8,b),(0,t.Lk)("button",{onClick:a=>R.downloadBackup(e),class:"download-btn"},"Descargar",8,f),(0,t.Lk)("button",{onClick:a=>R.deleteBackup(e),class:"delete-btn",disabled:R.deleting===e.id},[R.deleting===e.id?((0,t.uX)(),(0,t.CE)("span",w,"Eliminando...")):((0,t.uX)(),(0,t.CE)("span",C,"Eliminar"))],8,E)])])))),128))])),R.showRestoreModal?((0,t.uX)(),(0,t.CE)("div",{key:3,class:"modal-overlay",onClick:a[4]||(a[4]=(0,o.D$)(((...e)=>R.cancelRestore&&R.cancelRestore(...e)),["self"]))},[(0,t.Lk)("div",D,[(0,t.Lk)("div",S,[a[10]||(a[10]=(0,t.Lk)("h3",null,"Confirmar restauración",-1)),(0,t.Lk)("button",{onClick:a[1]||(a[1]=(...e)=>R.cancelRestore&&R.cancelRestore(...e)),class:"close-btn"},"×")]),a[11]||(a[11]=(0,t.Lk)("div",{class:"modal-body"},[(0,t.Lk)("p",{class:"warning-text"},[(0,t.Lk)("span",{class:"warning-icon"},"⚠️"),(0,t.eW)(" Estás a punto de restaurar el sistema a partir del respaldo seleccionado. Esta acción sobrescribirá los datos actuales. ")]),(0,t.Lk)("p",null,"¿Estás seguro de que deseas continuar?")],-1)),(0,t.Lk)("div",U,[(0,t.Lk)("button",{onClick:a[2]||(a[2]=(...e)=>R.cancelRestore&&R.cancelRestore(...e)),class:"cancel-btn"},"Cancelar"),(0,t.Lk)("button",{onClick:a[3]||(a[3]=(...e)=>R.confirmRestore&&R.confirmRestore(...e)),class:"confirm-btn"},"Confirmar restauración")])])])):(0,t.Q3)("",!0)])}s(8111),s(2489);var I=s(953);async function _(){return new Promise((e=>{setTimeout((()=>{e({success:!0,data:[{id:1,fecha:(new Date).toISOString(),archivo:"backup_"+x(new Date)+".zip",tamano:"2.5 MB"},{id:2,fecha:new Date(Date.now()-864e5).toISOString(),archivo:"backup_"+x(new Date(Date.now()-864e5))+".zip",tamano:"2.3 MB"},{id:3,fecha:new Date(Date.now()-6048e5).toISOString(),archivo:"backup_"+x(new Date(Date.now()-6048e5))+".zip",tamano:"2.1 MB"}]})}),1e3)}))}async function A(){return new Promise((e=>{setTimeout((()=>{const a=new Date;e({success:!0,data:{id:Date.now(),fecha:a.toISOString(),archivo:"backup_"+x(a)+".zip",tamano:"2.4 MB"},message:"Respaldo creado exitosamente"})}),2e3)}))}async function F(e){return new Promise((e=>{setTimeout((()=>{e({success:!0,message:"Respaldo eliminado exitosamente"})}),1e3)}))}function x(e){const a=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),t=String(e.getDate()).padStart(2,"0"),r=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0"),l=String(e.getSeconds()).padStart(2,"0");return`${a}${s}${t}_${r}${o}${l}`}var X=s(4887),M={name:"AdminBackups",setup(){const e=(0,I.KR)([]),a=(0,I.KR)(!0),s=(0,I.KR)(!1),r=(0,I.KR)(null),o=(0,I.KR)(null),l=(0,I.KR)(null),n=(0,I.KR)(!1);(0,t.sV)((async()=>{await i()}));const i=async()=>{try{a.value=!0;const s=await _();if(!s||!s.success)throw new Error("Error al cargar respaldos");e.value=s.data||[],e.value.sort(((e,a)=>new Date(a.fecha)-new Date(e.fecha)))}catch(s){console.error("Error al obtener respaldos:",s),await(0,X.xE)("Error al cargar los respaldos: "+(s.message||"Error desconocido"))}finally{a.value=!1}},c=e=>{if(!e)return"N/A";try{const a=new Date(e);return isNaN(a.getTime())?"Fecha inválida":new Intl.DateTimeFormat("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(a)}catch(a){return"Fecha inválida"}},u=async()=>{try{s.value=!0;const a=await A();if(!a||!a.success)throw new Error("Error al crear el respaldo");e.value.unshift(a.data),await(0,X.xE)("Respaldo creado correctamente")}catch(a){console.error("Error al crear respaldo:",a),await(0,X.xE)("Error al crear respaldo: "+(a.message||"Error desconocido"))}finally{s.value=!1}},d=e=>{l.value=e,n.value=!0},v=()=>{n.value=!1,l.value=null},p=async()=>{try{if(!l.value)return;n.value=!1,r.value=l.value.id;const e=await d(l.value.id);if(!e||!e.success)throw new Error("Error al restaurar el respaldo");await(0,X.xE)("Respaldo restaurado correctamente. Se recargará la página para aplicar los cambios."),window.location.reload()}catch(e){console.error("Error al restaurar respaldo:",e),await(0,X.xE)("Error al restaurar respaldo: "+(e.message||"Error desconocido"))}finally{r.value=null,l.value=null}},m=async e=>{try{const a=document.createElement("a");a.setAttribute("href","data:application/zip;charset=utf-8,"+encodeURIComponent("Contenido simulado de respaldo")),a.setAttribute("download",e.archivo),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),await(0,X.xE)("Respaldo descargado correctamente")}catch(a){console.error("Error al descargar respaldo:",a),await(0,X.xE)("Error al descargar respaldo: "+(a.message||"Error desconocido"))}},k=async a=>{try{const s=await(0,X.lJ)(`¿Estás seguro de eliminar el respaldo "${a.archivo}"?`,{title:"Confirmar eliminación",confirmText:"Eliminar",cancelText:"Cancelar"});if(s){o.value=a.id;const s=await F(a.id);if(!s||!s.success)throw new Error("Error al eliminar el respaldo");e.value=e.value.filter((e=>e.id!==a.id)),await(0,X.xE)("Respaldo eliminado correctamente")}}catch(s){console.error("Error al eliminar respaldo:",s),await(0,X.xE)("Error al eliminar respaldo: "+(s.message||"Error desconocido"))}finally{o.value=null}};return{backups:e,loading:a,creating:s,restoring:r,deleting:o,selectedBackup:l,showRestoreModal:n,formatDate:c,createNewBackup:u,restoreBackup:d,cancelRestore:v,confirmRestore:p,downloadBackup:m,deleteBackup:k}}},T=s(6262);const K=(0,T.A)(M,[["render",R],["__scopeId","data-v-1ca49867"]]);var P=K},2346:function(e,a,s){"use strict";s.d(a,{A:function(){return G}});var t=s(641),r=s(3751),o=s(33);const l={class:"inventory-container"},n={class:"inventory-controls"},i={class:"search-container"},c={class:"filters"},u={class:"actions"},d={key:0,class:"loading-container"},v={key:1,class:"error-container"},p={class:"error-message"},m={key:2,class:"empty-state"},k={key:3,class:"inventory-table-container"},g={class:"inventory-table"},h={class:"actions-cell"},b=["onClick"],y=["onClick"],L={key:4,class:"modal-overlay"},f={class:"modal-container"},E={class:"modal-header"},w={class:"modal-body"},C={class:"form-group"},D={class:"form-group"},S={class:"modal-footer"},U=["disabled"],R={key:0},I={key:1},_={key:5,class:"modal-overlay"},A={class:"modal-container history-modal"},F={class:"modal-header"},x={class:"modal-body"},X={key:0,class:"empty-history"},M={key:1,class:"history-list"},T={class:"history-date"},K={class:"history-details"},P={class:"history-quantity"},N={class:"history-stock"},z={class:"history-reason"},Q={class:"history-user"},V={class:"modal-footer"};function $(e,a,s,$,H,j){return(0,t.uX)(),(0,t.CE)("div",l,[a[27]||(a[27]=(0,t.Lk)("h2",{class:"section-title"},"Gestión de Inventario",-1)),(0,t.Lk)("div",n,[(0,t.Lk)("div",i,[(0,t.bo)((0,t.Lk)("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>$.searchTerm=e),placeholder:"Buscar producto...",class:"search-input",onInput:a[1]||(a[1]=(...e)=>$.handleSearchInput&&$.handleSearchInput(...e))},null,544),[[r.Jo,$.searchTerm]])]),(0,t.Lk)("div",c,[(0,t.bo)((0,t.Lk)("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>$.stockFilter=e),onChange:a[3]||(a[3]=(...e)=>$.applyFilters&&$.applyFilters(...e)),class:"filter-select"},a[15]||(a[15]=[(0,t.Lk)("option",{value:"all"},"Todos los productos",-1),(0,t.Lk)("option",{value:"low"},"Stock bajo",-1),(0,t.Lk)("option",{value:"out"},"Sin stock",-1)]),544),[[r.u1,$.stockFilter]]),(0,t.bo)((0,t.Lk)("select",{"onUpdate:modelValue":a[4]||(a[4]=e=>$.categoryFilter=e),onChange:a[5]||(a[5]=(...e)=>$.applyFilters&&$.applyFilters(...e)),class:"filter-select"},a[16]||(a[16]=[(0,t.Lk)("option",{value:""},"Todas las categorías",-1),(0,t.Lk)("option",{value:"con_refresco"},"Con refresco",-1),(0,t.Lk)("option",{value:"sin_refresco"},"Sin refresco",-1)]),544),[[r.u1,$.categoryFilter]])]),(0,t.Lk)("div",u,[(0,t.Lk)("button",{onClick:a[6]||(a[6]=(...e)=>$.refreshInventory&&$.refreshInventory(...e)),class:"refresh-btn"},a[17]||(a[17]=[(0,t.Lk)("span",{class:"btn-icon"},"🔄",-1),(0,t.eW)(" Actualizar ")]))])]),$.loading?((0,t.uX)(),(0,t.CE)("div",d,a[18]||(a[18]=[(0,t.Lk)("div",{class:"spinner"},null,-1),(0,t.Lk)("p",null,"Cargando inventario...",-1)]))):$.error?((0,t.uX)(),(0,t.CE)("div",v,[(0,t.Lk)("p",p,(0,o.v_)($.error),1),(0,t.Lk)("button",{onClick:a[7]||(a[7]=(...e)=>$.loadInventory&&$.loadInventory(...e)),class:"retry-btn"},"Reintentar")])):0===$.filteredProducts.length?((0,t.uX)(),(0,t.CE)("div",m,a[19]||(a[19]=[(0,t.Lk)("div",{class:"empty-icon"},"📦",-1),(0,t.Lk)("p",null,"No se encontraron productos",-1),(0,t.Lk)("p",{class:"empty-desc"},"Intenta cambiar los filtros de búsqueda o agrega nuevos productos al inventario",-1)]))):((0,t.uX)(),(0,t.CE)("div",k,[(0,t.Lk)("table",g,[a[20]||(a[20]=(0,t.Lk)("thead",null,[(0,t.Lk)("tr",null,[(0,t.Lk)("th",null,"Nombre"),(0,t.Lk)("th",null,"Categoría"),(0,t.Lk)("th",null,"Stock Actual"),(0,t.Lk)("th",null,"Estado"),(0,t.Lk)("th",null,"Última Actualización"),(0,t.Lk)("th",null,"Acciones")])],-1)),(0,t.Lk)("tbody",null,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)($.filteredProducts,(e=>((0,t.uX)(),(0,t.CE)("tr",{key:e.id,class:(0,o.C4)($.getRowClass(e))},[(0,t.Lk)("td",null,(0,o.v_)(e.name),1),(0,t.Lk)("td",null,(0,o.v_)(e.includesDrink?"Con refresco":"Sin refresco"),1),(0,t.Lk)("td",null,(0,o.v_)(e.availableQuantity),1),(0,t.Lk)("td",null,[(0,t.Lk)("span",{class:(0,o.C4)($.getStatusClass(e))},(0,o.v_)($.getStatusText(e)),3)]),(0,t.Lk)("td",null,(0,o.v_)($.formatDate(e.lastUpdated)),1),(0,t.Lk)("td",h,[(0,t.Lk)("button",{onClick:a=>$.openUpdateStockModal(e),class:"update-btn",title:"Actualizar stock"}," 📝 ",8,b),(0,t.Lk)("button",{onClick:a=>$.openHistoryModal(e),class:"history-btn",title:"Ver historial"}," 📋 ",8,y)])],2)))),128))])])])),$.showUpdateModal?((0,t.uX)(),(0,t.CE)("div",L,[(0,t.Lk)("div",f,[(0,t.Lk)("div",E,[a[21]||(a[21]=(0,t.Lk)("h3",null,"Actualizar Stock",-1)),(0,t.Lk)("button",{onClick:a[8]||(a[8]=(...e)=>$.closeUpdateModal&&$.closeUpdateModal(...e)),class:"close-btn"},"×")]),(0,t.Lk)("div",w,[(0,t.Lk)("p",null,[a[22]||(a[22]=(0,t.Lk)("strong",null,"Producto:",-1)),(0,t.eW)(" "+(0,o.v_)($.selectedProduct?.name),1)]),(0,t.Lk)("p",null,[a[23]||(a[23]=(0,t.Lk)("strong",null,"Stock actual:",-1)),(0,t.eW)(" "+(0,o.v_)($.selectedProduct?.availableQuantity||0),1)]),(0,t.Lk)("div",C,[a[24]||(a[24]=(0,t.Lk)("label",{for:"newStock"},"Nuevo stock:",-1)),(0,t.bo)((0,t.Lk)("input",{type:"number",id:"newStock","onUpdate:modelValue":a[9]||(a[9]=e=>$.updateStockForm.newQuantity=e),min:"0",class:"form-input"},null,512),[[r.Jo,$.updateStockForm.newQuantity]])]),(0,t.Lk)("div",D,[a[25]||(a[25]=(0,t.Lk)("label",{for:"reason"},"Motivo del ajuste:",-1)),(0,t.bo)((0,t.Lk)("textarea",{id:"reason","onUpdate:modelValue":a[10]||(a[10]=e=>$.updateStockForm.reason=e),class:"form-textarea",placeholder:"Explique el motivo del ajuste de inventario"},null,512),[[r.Jo,$.updateStockForm.reason]])])]),(0,t.Lk)("div",S,[(0,t.Lk)("button",{onClick:a[11]||(a[11]=(...e)=>$.closeUpdateModal&&$.closeUpdateModal(...e)),class:"cancel-btn"},"Cancelar"),(0,t.Lk)("button",{onClick:a[12]||(a[12]=(...e)=>$.updateStock&&$.updateStock(...e)),class:"save-btn",disabled:$.updateStockForm.isUpdating},[$.updateStockForm.isUpdating?((0,t.uX)(),(0,t.CE)("span",R,"Actualizando...")):((0,t.uX)(),(0,t.CE)("span",I,"Guardar Cambios"))],8,U)])])])):(0,t.Q3)("",!0),$.showHistoryModal?((0,t.uX)(),(0,t.CE)("div",_,[(0,t.Lk)("div",A,[(0,t.Lk)("div",F,[(0,t.Lk)("h3",null,"Historial de "+(0,o.v_)($.selectedProduct?.name),1),(0,t.Lk)("button",{onClick:a[13]||(a[13]=(...e)=>$.closeHistoryModal&&$.closeHistoryModal(...e)),class:"close-btn"},"×")]),(0,t.Lk)("div",x,[0===$.productHistory.length?((0,t.uX)(),(0,t.CE)("div",X,a[26]||(a[26]=[(0,t.Lk)("p",null,"No hay registros de movimientos para este producto.",-1)]))):((0,t.uX)(),(0,t.CE)("div",M,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)($.productHistory,((e,a)=>((0,t.uX)(),(0,t.CE)("div",{key:a,class:"history-item"},[(0,t.Lk)("div",T,(0,o.v_)($.formatDate(e.date)),1),(0,t.Lk)("div",K,[(0,t.Lk)("span",{class:(0,o.C4)(["history-type",e.type])},(0,o.v_)("increase"===e.type?"Incremento":"decrease"===e.type?"Reducción":"Ajuste"),3),(0,t.Lk)("span",P,(0,o.v_)("increase"===e.type?"+":"")+(0,o.v_)(e.change),1),(0,t.Lk)("span",N," Stock resultante: "+(0,o.v_)(e.newQuantity),1)]),(0,t.Lk)("div",z,(0,o.v_)(e.reason||"Sin motivo especificado"),1),(0,t.Lk)("div",Q," Por: "+(0,o.v_)(e.userName||"Sistema"),1)])))),128))]))]),(0,t.Lk)("div",V,[(0,t.Lk)("button",{onClick:a[14]||(a[14]=(...e)=>$.closeHistoryModal&&$.closeHistoryModal(...e)),class:"cancel-btn"},"Cerrar")])])])):(0,t.Q3)("",!0)])}s(4114),s(8111),s(2489),s(1701);var H=s(953),j=s(3444),B=s(4887),O=s(981),W={name:"AdminInventory",setup(){const e=(0,H.KR)([]),a=(0,H.KR)(!0),s=(0,H.KR)(null),r=(0,H.KR)(""),o=(0,H.KR)("all"),l=(0,H.KR)(""),n=(0,H.KR)(!1),i=(0,H.KR)(!1),c=(0,H.KR)(null),u=(0,H.KR)([]),d=(0,H.KR)({newQuantity:0,reason:"",isUpdating:!1});(0,t.sV)((()=>{v()}));const v=async()=>{try{a.value=!0,s.value=null;const t=await(0,j.gL)();if(!t.success)throw new Error(t.message||"Error al cargar el inventario");e.value=t.data.map((e=>({...e,availableQuantity:e.availableQuantity||0,lastUpdated:e.lastUpdated||(new Date).toISOString(),stockHistory:e.stockHistory||[]}))),console.log("Inventario cargado:",e.value)}catch(t){console.error("Error al cargar inventario:",t),s.value=`Error al cargar inventario: ${t.message||"Error desconocido"}`}finally{a.value=!1}},p=()=>{v()},m=()=>{},k=()=>{},g=(0,t.EW)((()=>{let a=[...e.value];if(r.value){const e=r.value.toLowerCase();a=a.filter((a=>a.name?.toLowerCase().includes(e)))}return"all"!==o.value&&("low"===o.value?a=a.filter((e=>e.availableQuantity>0&&e.availableQuantity<=5)):"out"===o.value&&(a=a.filter((e=>0===e.availableQuantity)))),l.value&&("con_refresco"===l.value?a=a.filter((e=>e.includesDrink)):"sin_refresco"===l.value&&(a=a.filter((e=>!e.includesDrink)))),a})),h=e=>0===e.availableQuantity?"out-of-stock-row":e.availableQuantity<=5?"low-stock-row":"",b=e=>0===e.availableQuantity?"status-badge out-of-stock":e.availableQuantity<=5?"status-badge low-stock":"status-badge in-stock",y=e=>0===e.availableQuantity?"Sin stock":e.availableQuantity<=5?"Stock bajo":"Disponible",L=e=>{if(!e)return"N/A";try{const a=new Date(e);return new Intl.DateTimeFormat("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(a)}catch(a){return console.error("Error al formatear fecha:",a),"Fecha inválida"}},f=e=>{c.value={...e},d.value={newQuantity:e.availableQuantity,reason:"",isUpdating:!1},n.value=!0},E=()=>{n.value=!1,c.value=null},w=async()=>{if(c.value)if(isNaN(d.value.newQuantity)||d.value.newQuantity<0)await(0,B.xE)("Por favor ingrese una cantidad válida (mayor o igual a 0)");else if(d.value.reason.trim())try{d.value.isUpdating=!0;const a=c.value.availableQuantity,s=parseInt(d.value.newQuantity),t=s-a,r=t>0?"increase":t<0?"decrease":"adjustment",o=(0,O.HW)(),l={date:(new Date).toISOString(),type:r,change:Math.abs(t),previousQuantity:a,newQuantity:s,reason:d.value.reason,userId:o?.id,userName:o?.nombre||"Usuario"};await(0,j.NT)(c.value.id,s,l);const n=e.value.findIndex((e=>e.id===c.value.id));-1!==n&&(e.value[n].availableQuantity=s,e.value[n].lastUpdated=(new Date).toISOString(),e.value[n].stockHistory||(e.value[n].stockHistory=[]),e.value[n].stockHistory.push(l)),await(0,B.xE)("Stock actualizado correctamente",{title:"Actualización Exitosa"}),E()}catch(a){console.error("Error al actualizar stock:",a),await(0,B.xE)(`Error al actualizar stock: ${a.message||"Error desconocido"}`)}finally{d.value.isUpdating=!1}else await(0,B.xE)("Por favor ingrese un motivo para el ajuste de inventario")},C=e=>{c.value={...e},u.value=e.stockHistory||[],i.value=!0},D=()=>{i.value=!1,c.value=null,u.value=[]};return{products:e,loading:a,error:s,searchTerm:r,stockFilter:o,categoryFilter:l,filteredProducts:g,showUpdateModal:n,showHistoryModal:i,selectedProduct:c,productHistory:u,updateStockForm:d,loadInventory:v,refreshInventory:p,handleSearchInput:m,applyFilters:k,getRowClass:h,getStatusClass:b,getStatusText:y,formatDate:L,openUpdateStockModal:f,closeUpdateModal:E,updateStock:w,openHistoryModal:C,closeHistoryModal:D}}},J=s(6262);const q=(0,J.A)(W,[["render",$],["__scopeId","data-v-55f4fd9a"]]);var G=q},2435:function(e,a,s){"use strict";s.d(a,{A:function(){return G}});var t=s(641),r=s(3751),o=s(33);const l={class:"users-container"},n={class:"users-controls"},i={class:"search-container"},c={class:"filters"},u=["value"],d={class:"actions"},v={key:0,class:"loading-container"},p={key:1,class:"error-container"},m={class:"error-message"},k={key:2,class:"empty-state"},g={key:3,class:"users-table-container"},h={class:"users-table"},b={class:"roles-list"},y={class:"action-buttons"},L=["onClick"],f=["onClick"],E=["onClick"],w=["onClick"],C={class:"modal-container"},D={class:"modal-header"},S={class:"modal-body"},U={key:0,class:"alert alert-danger mb-3"},R={class:"form-group"},I={class:"form-group"},_=["disabled"],A={class:"form-group"},F={class:"form-group"},x={for:"password"},X=["required"],M={class:"form-group"},T={class:"roles-checkboxes"},K=["id","value"],P=["for"],N={key:0,class:"form-group"},z={class:"form-buttons"},Q={type:"submit",class:"save-btn"};function V(e,a,s,V,$,H){return(0,t.uX)(),(0,t.CE)("div",l,[a[37]||(a[37]=(0,t.Lk)("h2",{class:"section-title"},"Gestión de Usuarios",-1)),(0,t.Lk)("div",n,[(0,t.Lk)("div",i,[(0,t.bo)((0,t.Lk)("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>V.searchTerm=e),placeholder:"Buscar usuario...",class:"search-input",onInput:a[1]||(a[1]=(...e)=>V.handleSearchInput&&V.handleSearchInput(...e))},null,544),[[r.Jo,V.searchTerm]])]),(0,t.Lk)("div",c,[(0,t.bo)((0,t.Lk)("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>V.roleFilter=e),onChange:a[3]||(a[3]=(...e)=>V.fetchUsers&&V.fetchUsers(...e)),class:"filter-select"},[a[19]||(a[19]=(0,t.Lk)("option",{value:""},"Todos los roles",-1)),((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(V.roles,(e=>((0,t.uX)(),(0,t.CE)("option",{key:e.id,value:e.nombre},(0,o.v_)(e.nombre),9,u)))),128))],544),[[r.u1,V.roleFilter]]),(0,t.bo)((0,t.Lk)("select",{"onUpdate:modelValue":a[4]||(a[4]=e=>V.statusFilter=e),onChange:a[5]||(a[5]=(...e)=>V.fetchUsers&&V.fetchUsers(...e)),class:"filter-select"},a[20]||(a[20]=[(0,t.Lk)("option",{value:""},"Todos los estados",-1),(0,t.Lk)("option",{value:"activo"},"Activos",-1),(0,t.Lk)("option",{value:"inactivo"},"Inactivos",-1)]),544),[[r.u1,V.statusFilter]])]),(0,t.Lk)("div",d,[(0,t.Lk)("button",{onClick:a[6]||(a[6]=(...e)=>V.showCreateForm&&V.showCreateForm(...e)),class:"create-user-btn"},a[21]||(a[21]=[(0,t.Lk)("span",{class:"btn-icon"},"➕",-1),(0,t.eW)(" Nuevo Usuario ")]))])]),V.loading?((0,t.uX)(),(0,t.CE)("div",v,a[22]||(a[22]=[(0,t.Lk)("div",{class:"spinner"},null,-1),(0,t.Lk)("p",null,"Cargando usuarios...",-1)]))):V.error?((0,t.uX)(),(0,t.CE)("div",p,[(0,t.Lk)("p",m,(0,o.v_)(V.error),1),(0,t.Lk)("button",{onClick:a[7]||(a[7]=(...e)=>V.fetchUsers&&V.fetchUsers(...e)),class:"retry-btn"},"Reintentar")])):0===V.users.length?((0,t.uX)(),(0,t.CE)("div",k,[a[23]||(a[23]=(0,t.Lk)("div",{class:"empty-icon"},"👥",-1)),a[24]||(a[24]=(0,t.Lk)("p",{class:"empty-title"},"No se encontraron usuarios",-1)),a[25]||(a[25]=(0,t.Lk)("p",{class:"empty-description"},"No hay usuarios que coincidan con los criterios de búsqueda",-1)),(0,t.Lk)("button",{onClick:a[8]||(a[8]=(...e)=>V.resetFilters&&V.resetFilters(...e)),class:"reset-filters-btn"},"Limpiar filtros")])):((0,t.uX)(),(0,t.CE)("div",g,[(0,t.Lk)("table",h,[a[30]||(a[30]=(0,t.Lk)("thead",null,[(0,t.Lk)("tr",null,[(0,t.Lk)("th",null,"Nombre"),(0,t.Lk)("th",null,"Email"),(0,t.Lk)("th",null,"Teléfono"),(0,t.Lk)("th",null,"Rol"),(0,t.Lk)("th",null,"Estado"),(0,t.Lk)("th",null,"Fecha de registro"),(0,t.Lk)("th",null,"Acciones")])],-1)),(0,t.Lk)("tbody",null,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(V.users,(e=>((0,t.uX)(),(0,t.CE)("tr",{key:e.id,class:(0,o.C4)({"inactive-user":"inactivo"===e.estado})},[(0,t.Lk)("td",null,(0,o.v_)(e.nombre),1),(0,t.Lk)("td",null,(0,o.v_)(e.email),1),(0,t.Lk)("td",null,(0,o.v_)(e.telefono||"-"),1),(0,t.Lk)("td",null,[(0,t.Lk)("div",b,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(e.roles,((e,a)=>((0,t.uX)(),(0,t.CE)("span",{key:a,class:(0,o.C4)(["role-badge",{"admin-role":"Administrador"===e,"superadmin-role":"Superadministrador"===e}])},(0,o.v_)(e),3)))),128))])]),(0,t.Lk)("td",null,[(0,t.Lk)("span",{class:(0,o.C4)(["status-badge","activo"===e.estado?"active-status":"inactive-status"])},(0,o.v_)("activo"===e.estado?"Activo":"Inactivo"),3)]),(0,t.Lk)("td",null,(0,o.v_)(V.formatDate(e.fecha_creacion)),1),(0,t.Lk)("td",null,[(0,t.Lk)("div",y,[(0,t.Lk)("button",{onClick:a=>V.editUser(e),class:"edit-btn",title:"Editar"},a[26]||(a[26]=[(0,t.Lk)("span",{class:"btn-icon"},"✏️",-1)]),8,L),"activo"===e.estado?((0,t.uX)(),(0,t.CE)("button",{key:0,onClick:a=>V.deactivateUser(e),class:"deactivate-btn",title:"Desactivar"},a[27]||(a[27]=[(0,t.Lk)("span",{class:"btn-icon"},"🔴",-1)]),8,f)):((0,t.uX)(),(0,t.CE)("button",{key:1,onClick:a=>V.activateUser(e),class:"activate-btn",title:"Activar"},a[28]||(a[28]=[(0,t.Lk)("span",{class:"btn-icon"},"🟢",-1)]),8,E)),(0,t.Lk)("button",{onClick:a=>V.deleteUser(e),class:"delete-btn",title:"Eliminar"},a[29]||(a[29]=[(0,t.Lk)("span",{class:"btn-icon"},"❌",-1)]),8,w)])])],2)))),128))])])])),V.showModal?((0,t.uX)(),(0,t.CE)("div",{key:4,class:"modal-overlay",onClick:a[18]||(a[18]=(0,r.D$)(((...e)=>V.closeModal&&V.closeModal(...e)),["self"]))},[(0,t.Lk)("div",C,[(0,t.Lk)("div",D,[(0,t.Lk)("h3",null,(0,o.v_)(V.isEditing?"Editar Usuario":"Crear Nuevo Usuario"),1),(0,t.Lk)("button",{onClick:a[9]||(a[9]=(...e)=>V.closeModal&&V.closeModal(...e)),class:"close-btn"},"×")]),(0,t.Lk)("div",S,[V.error?((0,t.uX)(),(0,t.CE)("div",U,(0,o.v_)(V.error),1)):(0,t.Q3)("",!0),(0,t.Lk)("form",{onSubmit:a[17]||(a[17]=(0,r.D$)(((...e)=>V.saveUser&&V.saveUser(...e)),["prevent"])),class:"user-form"},[(0,t.Lk)("div",R,[a[31]||(a[31]=(0,t.Lk)("label",{for:"nombre"},"Nombre completo",-1)),(0,t.bo)((0,t.Lk)("input",{type:"text",id:"nombre","onUpdate:modelValue":a[10]||(a[10]=e=>V.formData.nombre=e),required:"",placeholder:"Ej: Juan Pérez"},null,512),[[r.Jo,V.formData.nombre]])]),(0,t.Lk)("div",I,[a[32]||(a[32]=(0,t.Lk)("label",{for:"email"},"Correo electrónico",-1)),(0,t.bo)((0,t.Lk)("input",{type:"email",id:"email","onUpdate:modelValue":a[11]||(a[11]=e=>V.formData.email=e),required:"",placeholder:"ejemplo@correo.com",disabled:V.isEditing},null,8,_),[[r.Jo,V.formData.email]])]),(0,t.Lk)("div",A,[a[33]||(a[33]=(0,t.Lk)("label",{for:"telefono"},"Teléfono",-1)),(0,t.bo)((0,t.Lk)("input",{type:"tel",id:"telefono","onUpdate:modelValue":a[12]||(a[12]=e=>V.formData.telefono=e),placeholder:"Ej: 3001234567"},null,512),[[r.Jo,V.formData.telefono]])]),(0,t.Lk)("div",F,[(0,t.Lk)("label",x,"Contraseña "+(0,o.v_)(V.isEditing?"(dejar en blanco para mantener actual)":""),1),(0,t.bo)((0,t.Lk)("input",{type:"password",id:"password","onUpdate:modelValue":a[13]||(a[13]=e=>V.formData.password=e),required:!V.isEditing,placeholder:"Contraseña segura",autocomplete:"new-password"},null,8,X),[[r.Jo,V.formData.password]])]),(0,t.Lk)("div",M,[a[34]||(a[34]=(0,t.Lk)("label",null,"Roles",-1)),(0,t.Lk)("div",T,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(V.availableRoles,(e=>((0,t.uX)(),(0,t.CE)("div",{key:e.id,class:"role-checkbox"},[(0,t.bo)((0,t.Lk)("input",{type:"checkbox",id:"role-"+e.id,value:e.nombre,"onUpdate:modelValue":a[14]||(a[14]=e=>V.formData.roles=e)},null,8,K),[[r.lH,V.formData.roles]]),(0,t.Lk)("label",{for:"role-"+e.id},(0,o.v_)(e.nombre),9,P)])))),128))])]),V.isEditing?((0,t.uX)(),(0,t.CE)("div",N,[a[36]||(a[36]=(0,t.Lk)("label",{for:"estado"},"Estado",-1)),(0,t.bo)((0,t.Lk)("select",{id:"estado","onUpdate:modelValue":a[15]||(a[15]=e=>V.formData.estado=e)},a[35]||(a[35]=[(0,t.Lk)("option",{value:"activo"},"Activo",-1),(0,t.Lk)("option",{value:"inactivo"},"Inactivo",-1)]),512),[[r.u1,V.formData.estado]])])):(0,t.Q3)("",!0),(0,t.Lk)("div",z,[(0,t.Lk)("button",{type:"button",onClick:a[16]||(a[16]=(...e)=>V.closeModal&&V.closeModal(...e)),class:"cancel-btn"},"Cancelar"),(0,t.Lk)("button",Q,(0,o.v_)(V.isEditing?"Actualizar":"Crear"),1)])],32)])])])):(0,t.Q3)("",!0)])}s(8111),s(2489);var $=s(9984),H=s.n($),j=s(953),B=s(981),O=s(4887),W={name:"AdminUsers",emits:["user-created"],setup(e,{emit:a}){const s=(0,j.KR)([]),r=(0,j.KR)([]),o=(0,j.KR)([]),l=(0,j.KR)(!0),n=(0,j.KR)(null),i=(0,j.KR)(""),c=(0,j.KR)(""),u=(0,j.KR)(""),d=(0,j.KR)(!1),v=(0,j.KR)(!1),p=(0,j.KR)({id:null,nombre:"",email:"",telefono:"",password:"",roles:[],estado:"activo"}),{getUsers:m,getRoles:k,createUser:g,updateUser:h,cambiarEstadoUsuario:b,deleteUser:y}=H();let L=null;const f=(0,t.EW)((()=>(0,B.hf)("Administrador")&&!(0,B.hf)("Superadministrador"))),E=(0,t.EW)((()=>(0,B.hf)("Superadministrador"))),w=(0,t.EW)((()=>f.value?o.value.filter((e=>"Empleado"===e.nombre)):o.value)),C=(0,t.EW)((()=>{const e=(0,B.HW)();return s.value.filter((a=>{if(e&&a.email===e.email)return!0;if("superadmin@example.com"===a.email&&!E.value)return!1;if(f.value&&a.roles&&Array.isArray(a.roles)&&a.roles.includes("Superadministrador"))return!1;if(c.value&&(!a.roles||!a.roles.includes(c.value)))return!1;if(u.value&&a.estado!==u.value)return!1;if(i.value&&i.value.length>=2){const e=i.value.toLowerCase(),s=a.nombre&&a.nombre.toLowerCase().includes(e),t=a.email&&a.email.toLowerCase().includes(e);return s||t}return!0}))}));(0,t.sV)((async()=>{try{console.log("AdminUsers componente montado - inicializando..."),s.value=[],r.value=[],await Promise.all([D(),S()]),console.log("Inicialización completa, usuarios cargados:",r.value.length)}catch(e){console.error("Error durante la inicialización:",e),n.value=`Error durante la inicialización: ${e.message}`}}));const D=async()=>{try{l.value=!0,n.value="",s.value=[],r.value=[];try{console.log("Obteniendo usuarios con filtros:",{searchTerm:i.value,role:c.value,status:u.value});const e=await m({searchTerm:i.value,role:c.value,status:u.value});if(e&&e.success)return console.log(`Recibidos ${e.data.length} usuarios de la API`),s.value=e.data,void(r.value=C.value);throw console.warn("Respuesta no exitosa de la API o formato incorrecto:",e),new Error(e?.message||"Error al cargar usuarios")}catch(e){throw console.error("Error al llamar a la API:",e),e}}catch(a){console.error("Error general al cargar usuarios:",a),n.value=`Error al cargar usuarios: ${a.message||"Error desconocido"}`,s.value=[],r.value=[]}finally{l.value=!1}},S=async()=>{try{try{const e=await k();if(e&&e.success)return void(o.value=Array.isArray(e.data)?e.data:[]);throw console.warn("Respuesta no exitosa de la API de roles:",e),new Error(e?.message||"Error al cargar roles")}catch(e){console.error("Error al llamar a la API de roles:",e),o.value=[{id:1,nombre:"Superadministrador",descripcion:"Control total del sistema"},{id:2,nombre:"Administrador",descripcion:"Gestión de usuarios y configuración"},{id:3,nombre:"Empleado",descripcion:"Operaciones básicas"}],console.log("Usando roles básicos para mantener la funcionalidad:",o.value.length)}}catch(a){console.error("Error general al cargar roles:",a),o.value=[{id:1,nombre:"Superadministrador"},{id:2,nombre:"Administrador"},{id:3,nombre:"Empleado"}]}},U=()=>{clearTimeout(L),L=setTimeout((()=>{(""===i.value||i.value.length>=2)&&D()}),300)},R=()=>{i.value="",c.value="",u.value="",D()},I=()=>{v.value=!1,p.value={id:null,nombre:"",email:"",telefono:"",password:"",roles:["Empleado"],estado:"activo"},d.value=!0},_=e=>{f.value&&e.roles&&Array.isArray(e.roles)&&e.roles.includes("Superadministrador")?(0,O.xE)("No tienes permisos para editar usuarios con rol de Superadministrador"):(v.value=!0,p.value={id:e.id,nombre:e.nombre,email:e.email,telefono:e.telefono||"",password:"",roles:[...e.roles],estado:e.estado},d.value=!0)},A=async()=>{try{if(l.value=!0,n.value="",!p.value.roles.length)return await(0,O.xE)("Debe seleccionar al menos un rol para el usuario"),void(l.value=!1);if(f.value&&(p.value.roles=p.value.roles.filter((e=>"Empleado"===e)),0===p.value.roles.length&&(p.value.roles=["Empleado"])),v.value){const e={nombre:p.value.nombre,telefono:p.value.telefono,roles:p.value.roles,estado:p.value.estado};p.value.password&&(e.password=p.value.password);const a=await h(p.value.id,e);if(!a||!a.success)throw new Error(a?.message||"Error al actualizar usuario");{await(0,O.xE)(a.message||"Usuario actualizado exitosamente");const t=s.value.findIndex((e=>e.id===p.value.id));-1!==t?(s.value[t]={...s.value[t],...e},r.value=C.value):await D()}}else{const t={nombre:p.value.nombre,email:p.value.email,password:p.value.password,telefono:p.value.telefono,roles:p.value.roles,fecha_creacion:(new Date).toISOString()};try{console.log("Llamando a createUser con:",t);const e=await g(t);if(!e||!e.success)throw new Error(e?.message||"Error al crear usuario");if(await(0,O.xE)(e.message||"Usuario creado exitosamente"),d.value=!1,e.data){const a={...e.data,fecha_creacion:e.data.fecha_creacion||(new Date).toISOString()};s.value=[a,...s.value],r.value=C.value}else await D();a("user-created")}catch(e){console.error("Error al crear usuario:",e),n.value=e.message||"Error al crear usuario"}}}catch(t){console.error("Error al guardar el usuario:",t),n.value=t.message||"Error al guardar el usuario"}finally{l.value=!1}},F=async e=>{if(f.value&&e.roles&&Array.isArray(e.roles)&&e.roles.includes("Superadministrador"))(0,O.xE)("No tienes permisos para modificar usuarios con rol de Superadministrador");else try{const a=await(0,O.lJ)(`¿Estás seguro de que deseas activar el usuario ${e.nombre}?`,{title:"Confirmar activación",confirmText:"Activar",cancelText:"Cancelar"});if(a){l.value=!0,console.log(`Activando usuario con ID: ${e.id}`);const a=await b(e.id,"activo");if(!a||!a.success)throw new Error(a?.message||"Error al activar usuario");{await(0,O.xE)(a.message||"Usuario activado exitosamente");const t=s.value.findIndex((a=>a.id===e.id));-1!==t&&(s.value[t].estado="activo",r.value=C.value)}}}catch(a){console.error("Error al activar usuario:",a),await(0,O.xE)(`Error al activar usuario: ${a.message||"Error desconocido"}`)}finally{l.value=!1}},x=async e=>{if(f.value&&e.roles&&Array.isArray(e.roles)&&e.roles.includes("Superadministrador"))(0,O.xE)("No tienes permisos para modificar usuarios con rol de Superadministrador");else try{const a=await(0,O.lJ)(`¿Estás seguro de que deseas desactivar el usuario ${e.nombre}? No podrá acceder al sistema mientras esté inactivo.`,{title:"Confirmar desactivación"});if(a){l.value=!0,console.log(`Desactivando usuario con ID: ${e.id}`);const a=await b(e.id,"inactivo");if(!a||!a.success)throw new Error(a?.message||"Error al desactivar usuario");{await(0,O.xE)(a.message||"Usuario desactivado exitosamente");const t=s.value.findIndex((a=>a.id===e.id));-1!==t&&(s.value[t].estado="inactivo",r.value=C.value)}}}catch(a){console.error("Error al desactivar usuario:",a),await(0,O.xE)(`Error al desactivar usuario: ${a.message||"Error desconocido"}`)}finally{l.value=!1}},X=async e=>{if(f.value&&e.roles&&Array.isArray(e.roles)&&e.roles.includes("Superadministrador"))(0,O.xE)("No tienes permisos para eliminar usuarios con rol de Superadministrador");else try{const a=await(0,O.lJ)(`¿Estás seguro de que deseas eliminar permanentemente el usuario ${e.nombre}? Esta acción no se puede deshacer.`,{title:"Confirmar eliminación",confirmText:"Eliminar",cancelText:"Cancelar"});if(a){l.value=!0,console.log(`Eliminando usuario con ID: ${e.id}`);const a=await y(e.id);if(!a||!a.success)throw new Error(a?.message||"Error al eliminar usuario");await(0,O.xE)(a.message||"Usuario eliminado exitosamente"),s.value=s.value.filter((a=>a.id!==e.id)),r.value=C.value}}catch(a){console.error("Error al eliminar usuario:",a),await(0,O.xE)(`Error al eliminar usuario: ${a.message||"Error desconocido"}`)}finally{l.value=!1}},M=()=>{d.value=!1},T=e=>{e||(e=(new Date).toISOString());try{const a=new Date(e);return isNaN(a.getTime())?"Fecha inválida":new Intl.DateTimeFormat("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(a)}catch(a){return"Fecha inválida"}};return{users:r,roles:o,loading:l,error:n,searchTerm:i,roleFilter:c,statusFilter:u,showModal:d,isEditing:v,formData:p,fetchUsers:D,handleSearchInput:U,resetFilters:R,showCreateForm:I,editUser:_,saveUser:A,activateUser:F,deactivateUser:x,deleteUser:X,closeModal:M,formatDate:T,availableRoles:w,isOnlyAdmin:f,filteredUsers:C}}},J=s(6262);const q=(0,J.A)(W,[["render",V],["__scopeId","data-v-1ce8111d"]]);var G=q},2812:function(e){"use strict";var a=TypeError;e.exports=function(e,s){if(e<s)throw new a("Not enough arguments");return e}},3444:function(e,a,s){"use strict";s.d(a,{NT:function(){return n},Um:function(){return l},ao:function(){return o},gL:function(){return r}});s(4114),s(8111),s(2489),s(116),s(1701),s(8982);var t=s(133);async function r(){try{0;const e=await t["default"].get("/admin/menu-items");return e}catch(e){return console.error("Error al obtener elementos del menú:",e),{success:!1,error:e.message||"Error al obtener elementos del menú"}}}async function o(){return new Promise((e=>{setTimeout((()=>{e({success:!0,data:[{id:1,timestamp:(new Date).toISOString(),type:"info",user:"Admin",message:"Inicio de sesión exitoso",details:{ip:"192.168.1.1",userAgent:"Chrome/96.0"}},{id:2,timestamp:new Date(Date.now()-36e5).toISOString(),type:"warning",user:"Sistema",message:"Intento de acceso fallido",details:{ip:"203.0.113.1",userAgent:"Edge/96.0",attempts:3}},{id:3,timestamp:new Date(Date.now()-72e5).toISOString(),type:"error",user:"Sistema",message:"Error en la creación de backup",details:{error:"Espacio insuficiente",code:"E0023"}},{id:4,timestamp:new Date(Date.now()-864e5).toISOString(),type:"success",user:"Juan Pérez",message:"Nuevo usuario creado",details:{newUser:"carlos@ejemplo.com"}}]})}),500)}))}async function l(){try{const e=await o();if(!e.success||!Array.isArray(e.data))throw new Error("No se pudieron obtener los logs para descargar");const a=e.data,s=["ID","Fecha","Tipo","Usuario","Mensaje","Detalles"],t=a.map((e=>[e.id||"",e.timestamp||"",e.type||"",e.user||"Sistema",e.message||"",e.details?JSON.stringify(e.details):""])),r=[s.join(","),...t.map((e=>e.map((e=>`"${String(e).replace(/"/g,'""')}"`)).join(",")))].join("\n");return{success:!0,data:r,message:"Logs descargados correctamente"}}catch(e){return console.error("Error al descargar logs en CSV:",e),{success:!1,message:e.message||"Error al descargar logs"}}}async function n(e,a){try{const s=await t["default"].put(`/admin/menu-items/${e}/stock`,{stock:a});if(s&&s.success)return{success:!0,message:"Stock actualizado correctamente",data:s.data};throw new Error(s?.message||"Error al actualizar stock")}catch(s){return console.error("Error al actualizar stock:",s),{success:!1,message:s.message||"Error al actualizar stock"}}}},4592:function(e,a,s){"use strict";s.d(a,{A:function(){return O}});var t=s(641),r=s(33);const o={class:"admin-dashboard"},l={key:0,class:"loading-panel"},n={key:1,class:"error-panel"},i={class:"error-message"},c={key:2,class:"dashboard-content"},u={class:"stats-cards"},d={class:"stat-card"},v={class:"stat-value"},p={class:"stat-card"},m={class:"stat-value"},k={class:"stat-card"},g={class:"stat-value"},h={class:"stat-card"},b={class:"stat-value"},y={class:"chart-panel"},L={class:"chart-container"},f={class:"chart"},E={class:"chart-tooltip"},w={class:"chart-labels"},C={class:"lower-panels"},D={class:"panel"},S={class:"restaurant-list"},U={class:"restaurant-rank"},R={class:"restaurant-info"},I={class:"restaurant-name"},_={class:"restaurant-orders"},A={class:"panel"},F={class:"user-list"},x={class:"user-avatar"},X={class:"user-info"},M={class:"user-name"},T={class:"user-role"},K={class:"user-access"},P={class:"access-date"},N={class:"dashboard-footer"},z={class:"data-updated"},Q={key:3,class:"no-data"};function V(e,a,s,V,$,H){return(0,t.uX)(),(0,t.CE)("div",o,[a[15]||(a[15]=(0,t.Lk)("h2",null,"Panel de Control",-1)),$.loading?((0,t.uX)(),(0,t.CE)("div",l,a[2]||(a[2]=[(0,t.Lk)("div",{class:"spinner"},null,-1),(0,t.Lk)("p",null,"Cargando estadísticas del dashboard...",-1)]))):$.error?((0,t.uX)(),(0,t.CE)("div",n,[(0,t.Lk)("p",i,(0,r.v_)($.error),1),(0,t.Lk)("button",{onClick:a[0]||(a[0]=(...a)=>e.cargarDatos&&e.cargarDatos(...a)),class:"btn btn-retry"},"Reintentar")])):$.dashboardData?((0,t.uX)(),(0,t.CE)("div",c,[(0,t.Lk)("div",u,[(0,t.Lk)("div",d,[a[3]||(a[3]=(0,t.Lk)("div",{class:"stat-icon"},"👤",-1)),(0,t.Lk)("div",v,(0,r.v_)($.dashboardData.estadisticas.totalUsuarios),1),a[4]||(a[4]=(0,t.Lk)("div",{class:"stat-label"},"Usuarios",-1))]),(0,t.Lk)("div",p,[a[5]||(a[5]=(0,t.Lk)("div",{class:"stat-icon"},"🍽️",-1)),(0,t.Lk)("div",m,(0,r.v_)($.dashboardData.estadisticas.totalRestaurantes),1),a[6]||(a[6]=(0,t.Lk)("div",{class:"stat-label"},"Restaurantes",-1))]),(0,t.Lk)("div",k,[a[7]||(a[7]=(0,t.Lk)("div",{class:"stat-icon"},"📝",-1)),(0,t.Lk)("div",g,(0,r.v_)($.dashboardData.estadisticas.totalPedidos),1),a[8]||(a[8]=(0,t.Lk)("div",{class:"stat-label"},"Pedidos",-1))]),(0,t.Lk)("div",h,[a[9]||(a[9]=(0,t.Lk)("div",{class:"stat-icon"},"💰",-1)),(0,t.Lk)("div",b,(0,r.v_)(H.formatCurrency($.dashboardData.estadisticas.totalVentas)),1),a[10]||(a[10]=(0,t.Lk)("div",{class:"stat-label"},"Ventas",-1))])]),(0,t.Lk)("div",y,[a[11]||(a[11]=(0,t.Lk)("h3",null,"Ventas Mensuales",-1)),(0,t.Lk)("div",L,[(0,t.Lk)("div",f,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)($.dashboardData.graficoVentas,((e,a)=>((0,t.uX)(),(0,t.CE)("div",{key:`venta-${a}`,class:"chart-bar",style:(0,r.Tr)({height:H.calcBarHeight(e.ventas)+"%"})},[(0,t.Lk)("span",E,(0,r.v_)(H.formatCurrency(e.ventas)),1)],4)))),128))]),(0,t.Lk)("div",w,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)($.dashboardData.graficoVentas,((e,a)=>((0,t.uX)(),(0,t.CE)("span",{key:`label-${a}`,class:"chart-label"},(0,r.v_)(e.mes),1)))),128))])])]),(0,t.Lk)("div",C,[(0,t.Lk)("div",D,[a[12]||(a[12]=(0,t.Lk)("h3",null,"Restaurantes Populares",-1)),(0,t.Lk)("div",S,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)($.dashboardData.restaurantesPopulares,((e,a)=>((0,t.uX)(),(0,t.CE)("div",{key:`rest-${a}`,class:"restaurant-item"},[(0,t.Lk)("div",U,(0,r.v_)(a+1),1),(0,t.Lk)("div",R,[(0,t.Lk)("div",I,(0,r.v_)(e.nombre),1),(0,t.Lk)("div",_,(0,r.v_)(e.pedidos)+" pedidos",1)])])))),128))])]),(0,t.Lk)("div",A,[a[13]||(a[13]=(0,t.Lk)("h3",null,"Usuarios Activos",-1)),(0,t.Lk)("div",F,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)($.dashboardData.usuariosActivos,((e,a)=>((0,t.uX)(),(0,t.CE)("div",{key:`user-${a}`,class:"user-item"},[(0,t.Lk)("div",x,(0,r.v_)(H.getInitials(e.nombre)),1),(0,t.Lk)("div",X,[(0,t.Lk)("div",M,(0,r.v_)(e.nombre),1),(0,t.Lk)("div",T,(0,r.v_)(e.rol),1)]),(0,t.Lk)("div",K,[(0,t.Lk)("span",P,(0,r.v_)(H.formatDate(e.ultimoAcceso)),1)])])))),128))])])]),(0,t.Lk)("div",N,[(0,t.Lk)("div",z," Datos actualizados: "+(0,r.v_)(e.fechaActualizacion),1)])])):((0,t.uX)(),(0,t.CE)("div",Q,[a[14]||(a[14]=(0,t.Lk)("p",null,"No hay datos disponibles para mostrar.",-1)),(0,t.Lk)("button",{onClick:a[1]||(a[1]=(...a)=>e.cargarDatos&&e.cargarDatos(...a)),class:"btn btn-retry"},"Cargar datos")]))])}s(8111),s(1701);var $=s(9984),H={name:"AdminDashboard",data(){return{dashboardData:{estadisticas:{totalUsuarios:0,totalRestaurantes:0,totalPedidos:0,totalVentas:0},graficoVentas:[],restaurantesPopulares:[],usuariosActivos:[]},loading:!0,error:null}},async created(){await this.cargarDatosDashboard()},methods:{async cargarDatosDashboard(){try{console.log("Cargando estadísticas del dashboard..."),this.loading=!0;const e=await(0,$.obtenerDatosDashboard)();e&&e.success&&e.data?(this.dashboardData=e.data,console.log("Datos del dashboard cargados correctamente")):console.warn("Respuesta incorrecta del API de dashboard")}catch(e){console.error("Error al cargar datos del dashboard:",e)}finally{this.loading=!1}},formatCurrency(e){return new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(e)},formatDate(e){try{const a=new Date(e);return a.toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(a){return e}},getInitials(e){return e.split(" ").map((e=>e[0])).join("").toUpperCase().substring(0,2)},calcBarHeight(e){if(!this.dashboardData||!this.dashboardData.graficoVentas)return 0;const a=Math.max(...this.dashboardData.graficoVentas.map((e=>e.ventas)));return e/a*80}}},j=s(6262);const B=(0,j.A)(H,[["render",V],["__scopeId","data-v-0d384ca6"]]);var O=B},4603:function(e,a,s){"use strict";var t=s(6840),r=s(9504),o=s(655),l=s(2812),n=URLSearchParams,i=n.prototype,c=r(i.append),u=r(i["delete"]),d=r(i.forEach),v=r([].push),p=new n("a=1&a=2&b=3");p["delete"]("a",1),p["delete"]("b",void 0),p+""!=="a=2"&&t(i,"delete",(function(e){var a=arguments.length,s=a<2?void 0:arguments[1];if(a&&void 0===s)return u(this,e);var t=[];d(this,(function(e,a){v(t,{key:a,value:e})})),l(a,1);var r,n=o(e),i=o(s),p=0,m=0,k=!1,g=t.length;while(p<g)r=t[p++],k||r.key===n?(k=!0,u(this,r.key)):m++;while(m<g)r=t[m++],r.key===n&&r.value===i||c(this,r.key,r.value)}),{enumerable:!0,unsafe:!0})},7469:function(e,a,s){"use strict";s.d(a,{A:function(){return $}});var t=s(641),r=s(3751),o=s(33);const l={class:"logs-container"},n={class:"logs-controls"},i={class:"search-box"},c={class:"filters"},u={class:"actions"},d={key:0,class:"loading-container"},v={key:1,class:"empty-state"},p={key:2,class:"logs-table-wrapper"},m={class:"logs-table"},k={class:"message-cell"},g=["onClick"],h={key:3,class:"pagination"},b=["disabled"],y={class:"page-numbers"},L=["onClick"],f=["disabled"],E={class:"modal-container"},w={class:"modal-header"},C={class:"modal-body"},D={class:"log-detail-item"},S={class:"detail-value"},U={class:"log-detail-item"},R={class:"detail-value"},I={class:"log-detail-item"},_={class:"detail-value"},A={class:"log-detail-item"},F={class:"detail-value"},x={class:"log-detail-item"},X={class:"detail-value detail-json"},M={class:"modal-footer"};function T(e,a,s,T,K,P){return(0,t.uX)(),(0,t.CE)("div",l,[a[28]||(a[28]=(0,t.Lk)("h2",{class:"section-title"},"Registros del Sistema",-1)),(0,t.Lk)("div",n,[(0,t.Lk)("div",i,[(0,t.bo)((0,t.Lk)("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>T.searchTerm=e),placeholder:"Buscar en registros...",class:"search-input",onInput:a[1]||(a[1]=(...e)=>T.debounceSearch&&T.debounceSearch(...e))},null,544),[[r.Jo,T.searchTerm]]),a[13]||(a[13]=(0,t.Lk)("button",{class:"search-btn"},"🔍",-1))]),(0,t.Lk)("div",c,[(0,t.bo)((0,t.Lk)("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>T.typeFilter=e),class:"filter-select",onChange:a[3]||(a[3]=(...e)=>T.applyFilters&&T.applyFilters(...e))},a[14]||(a[14]=[(0,t.Fv)('<option value="" data-v-4dbe11f6>Todos los tipos</option><option value="info" data-v-4dbe11f6>Información</option><option value="warning" data-v-4dbe11f6>Advertencia</option><option value="error" data-v-4dbe11f6>Error</option><option value="success" data-v-4dbe11f6>Éxito</option>',5)]),544),[[r.u1,T.typeFilter]]),(0,t.bo)((0,t.Lk)("select",{"onUpdate:modelValue":a[4]||(a[4]=e=>T.dateFilter=e),class:"filter-select",onChange:a[5]||(a[5]=(...e)=>T.applyFilters&&T.applyFilters(...e))},a[15]||(a[15]=[(0,t.Fv)('<option value="" data-v-4dbe11f6>Todas las fechas</option><option value="today" data-v-4dbe11f6>Hoy</option><option value="yesterday" data-v-4dbe11f6>Ayer</option><option value="week" data-v-4dbe11f6>Esta semana</option><option value="month" data-v-4dbe11f6>Este mes</option>',5)]),544),[[r.u1,T.dateFilter]])]),(0,t.Lk)("div",u,[(0,t.Lk)("button",{onClick:a[6]||(a[6]=(...e)=>T.refreshLogs&&T.refreshLogs(...e)),class:"refresh-btn"},a[16]||(a[16]=[(0,t.Lk)("span",{class:"btn-icon"},"🔄",-1),(0,t.eW)(" Actualizar ")])),(0,t.Lk)("button",{onClick:a[7]||(a[7]=(...e)=>T.downloadLogs&&T.downloadLogs(...e)),class:"download-btn"},a[17]||(a[17]=[(0,t.Lk)("span",{class:"btn-icon"},"⬇️",-1),(0,t.eW)(" Descargar ")]))])]),T.loading?((0,t.uX)(),(0,t.CE)("div",d,a[18]||(a[18]=[(0,t.Lk)("div",{class:"spinner"},null,-1),(0,t.Lk)("p",null,"Cargando registros...",-1)]))):0===T.filteredLogs.length?((0,t.uX)(),(0,t.CE)("div",v,a[19]||(a[19]=[(0,t.Lk)("div",{class:"empty-icon"},"📝",-1),(0,t.Lk)("p",null,"No se encontraron registros",-1)]))):((0,t.uX)(),(0,t.CE)("div",p,[(0,t.Lk)("table",m,[a[21]||(a[21]=(0,t.Lk)("thead",null,[(0,t.Lk)("tr",null,[(0,t.Lk)("th",{class:"timestamp-col"},"Fecha y Hora"),(0,t.Lk)("th",{class:"type-col"},"Tipo"),(0,t.Lk)("th",{class:"user-col"},"Usuario"),(0,t.Lk)("th",{class:"message-col"},"Mensaje"),(0,t.Lk)("th",{class:"actions-col"},"Acciones")])],-1)),(0,t.Lk)("tbody",null,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(T.filteredLogs,(e=>((0,t.uX)(),(0,t.CE)("tr",{key:e.id,class:(0,o.C4)("log-row "+e.type)},[(0,t.Lk)("td",null,(0,o.v_)(T.formatDate(e.timestamp)),1),(0,t.Lk)("td",null,[(0,t.Lk)("span",{class:(0,o.C4)(["log-type",e.type])},(0,o.v_)(T.getTypeLabel(e.type)),3)]),(0,t.Lk)("td",null,(0,o.v_)(e.user||"Sistema"),1),(0,t.Lk)("td",k,(0,o.v_)(e.message),1),(0,t.Lk)("td",null,[(0,t.Lk)("button",{onClick:a=>T.viewLogDetails(e),class:"detail-btn"},a[20]||(a[20]=[(0,t.Lk)("span",null,"👁️",-1)]),8,g)])],2)))),128))])])])),T.filteredLogs.length>0?((0,t.uX)(),(0,t.CE)("div",h,[(0,t.Lk)("button",{onClick:a[8]||(a[8]=e=>T.changePage(T.currentPage-1)),disabled:1===T.currentPage,class:"pagination-btn"}," < Anterior ",8,b),(0,t.Lk)("div",y,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(T.displayedPages,(e=>((0,t.uX)(),(0,t.CE)("button",{key:e,onClick:a=>T.changePage(e),class:(0,o.C4)(["page-number",{active:T.currentPage===e}])},(0,o.v_)(e),11,L)))),128))]),(0,t.Lk)("button",{onClick:a[9]||(a[9]=e=>T.changePage(T.currentPage+1)),disabled:T.currentPage===T.totalPages,class:"pagination-btn"}," Siguiente > ",8,f)])):(0,t.Q3)("",!0),T.showModal?((0,t.uX)(),(0,t.CE)("div",{key:4,class:"modal-overlay",onClick:a[12]||(a[12]=(0,r.D$)(((...e)=>T.closeModal&&T.closeModal(...e)),["self"]))},[(0,t.Lk)("div",E,[(0,t.Lk)("div",w,[a[22]||(a[22]=(0,t.Lk)("h3",null,"Detalles del Registro",-1)),(0,t.Lk)("button",{onClick:a[10]||(a[10]=(...e)=>T.closeModal&&T.closeModal(...e)),class:"close-btn"},"×")]),(0,t.Lk)("div",C,[(0,t.Lk)("div",D,[a[23]||(a[23]=(0,t.Lk)("span",{class:"detail-label"},"Fecha y Hora:",-1)),(0,t.Lk)("span",S,(0,o.v_)(T.formatDate(T.selectedLog.timestamp)),1)]),(0,t.Lk)("div",U,[a[24]||(a[24]=(0,t.Lk)("span",{class:"detail-label"},"Tipo:",-1)),(0,t.Lk)("span",R,[(0,t.Lk)("span",{class:(0,o.C4)(["log-type",T.selectedLog.type])},(0,o.v_)(T.getTypeLabel(T.selectedLog.type)),3)])]),(0,t.Lk)("div",I,[a[25]||(a[25]=(0,t.Lk)("span",{class:"detail-label"},"Usuario:",-1)),(0,t.Lk)("span",_,(0,o.v_)(T.selectedLog.user||"Sistema"),1)]),(0,t.Lk)("div",A,[a[26]||(a[26]=(0,t.Lk)("span",{class:"detail-label"},"Mensaje:",-1)),(0,t.Lk)("span",F,(0,o.v_)(T.selectedLog.message),1)]),(0,t.Lk)("div",x,[a[27]||(a[27]=(0,t.Lk)("span",{class:"detail-label"},"Detalles adicionales:",-1)),(0,t.Lk)("pre",X,(0,o.v_)(JSON.stringify(T.selectedLog.details,null,2)),1)])]),(0,t.Lk)("div",M,[(0,t.Lk)("button",{onClick:a[11]||(a[11]=(...e)=>T.closeModal&&T.closeModal(...e)),class:"close-btn"},"Cerrar")])])])):(0,t.Q3)("",!0)])}s(4114),s(8111),s(2489),s(4603),s(7566),s(8721);var K=s(953),P=s(3444),N=s(4887),z={name:"AdminLogs",setup(){const e=(0,K.KR)([]),a=(0,K.KR)(!0),s=(0,K.KR)(""),r=(0,K.KR)(""),o=(0,K.KR)(""),l=(0,K.KR)(1),n=(0,K.KR)(10),i=(0,K.KR)(!1),c=(0,K.KR)({});let u=null;(0,t.sV)((async()=>{await d()}));const d=async()=>{try{a.value=!0;const s=await(0,P.ao)();if(!s||!s.success)throw new Error("Error al cargar logs");e.value=s.data||[]}catch(s){console.error("Error al obtener logs:",s),await(0,N.xE)("Error al cargar los logs: "+(s.message||"Error desconocido"))}finally{a.value=!1}},v=e=>{if(!e)return"N/A";try{const a=new Date(e);return isNaN(a.getTime())?"Fecha inválida":new Intl.DateTimeFormat("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(a)}catch(a){return"Fecha inválida"}},p=e=>{switch(e){case"info":return"Información";case"warning":return"Advertencia";case"error":return"Error";case"success":return"Éxito";default:return e}},m=(0,t.EW)((()=>{let a=[...e.value];if(s.value){const e=s.value.toLowerCase();a=a.filter((a=>a.message&&a.message.toLowerCase().includes(e)||a.user&&a.user.toLowerCase().includes(e)))}if(r.value&&(a=a.filter((e=>e.type===r.value))),o.value){const e=new Date,s=new Date(e.getFullYear(),e.getMonth(),e.getDate());switch(o.value){case"today":a=a.filter((e=>{const a=new Date(e.timestamp);return a>=s}));break;case"yesterday":const e=new Date(s);e.setDate(e.getDate()-1),a=a.filter((a=>{const t=new Date(a.timestamp);return t>=e&&t<s}));break;case"week":const t=new Date(s);t.setDate(t.getDate()-7),a=a.filter((e=>{const a=new Date(e.timestamp);return a>=t}));break;case"month":const r=new Date(s);r.setMonth(r.getMonth()-1),a=a.filter((e=>{const a=new Date(e.timestamp);return a>=r}));break}}return a})),k=(0,t.EW)((()=>Math.ceil(m.value.length/n.value))),g=(0,t.EW)((()=>{const e=[],a=5;if(k.value<=a)for(let s=1;s<=k.value;s++)e.push(s);else{let s=Math.max(1,l.value-Math.floor(a/2));const t=Math.min(k.value,s+a-1);t-s+1<a&&(s=Math.max(1,t-a+1));for(let a=s;a<=t;a++)e.push(a)}return e})),h=((0,t.EW)((()=>{const e=(l.value-1)*n.value;return m.value.slice(e,e+n.value)})),e=>{e>=1&&e<=k.value&&(l.value=e)}),b=()=>{clearTimeout(u),u=setTimeout((()=>{l.value=1}),300)},y=()=>{l.value=1},L=async()=>{await d(),await(0,N.xE)("Registros actualizados correctamente")},f=async()=>{try{a.value=!0;const e=await(0,P.Um)();if(!e||!e.success)throw new Error("Error al descargar logs");{const a=new Blob([e.data],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),t=URL.createObjectURL(a);s.setAttribute("href",t),s.setAttribute("download",`logs_${(new Date).toISOString().split("T")[0]}.csv`),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),await(0,N.xE)("Logs descargados correctamente")}}catch(e){console.error("Error al descargar logs:",e),await(0,N.xE)("Error al descargar logs: "+(e.message||"Error desconocido"))}finally{a.value=!1}},E=e=>{c.value=e,i.value=!0},w=()=>{i.value=!1};return{logs:e,loading:a,searchTerm:s,typeFilter:r,dateFilter:o,currentPage:l,totalPages:k,displayedPages:g,filteredLogs:m,showModal:i,selectedLog:c,formatDate:v,getTypeLabel:p,debounceSearch:b,applyFilters:y,refreshLogs:L,downloadLogs:f,changePage:h,viewLogDetails:E,closeModal:w}}},Q=s(6262);const V=(0,Q.A)(z,[["render",T],["__scopeId","data-v-4dbe11f6"]]);var $=V},7566:function(e,a,s){"use strict";var t=s(6840),r=s(9504),o=s(655),l=s(2812),n=URLSearchParams,i=n.prototype,c=r(i.getAll),u=r(i.has),d=new n("a=1");!d.has("a",2)&&d.has("a",void 0)||t(i,"has",(function(e){var a=arguments.length,s=a<2?void 0:arguments[1];if(a&&void 0===s)return u(this,e);var t=c(this,e);l(a,1);var r=o(s),n=0;while(n<t.length)if(t[n++]===r)return!0;return!1}),{enumerable:!0,unsafe:!0})},8721:function(e,a,s){"use strict";var t=s(3724),r=s(9504),o=s(2106),l=URLSearchParams.prototype,n=r(l.forEach);t&&!("size"in l)&&o(l,"size",{get:function(){var e=0;return n(this,(function(){e++})),e},configurable:!0,enumerable:!0})},9984:function(){}}]);
//# sourceMappingURL=869.8943b79c.js.map