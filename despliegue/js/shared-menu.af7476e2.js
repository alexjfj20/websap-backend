"use strict";(self["webpackChunkwebsap"]=self["webpackChunkwebsap"]||[]).push([[260],{8075:function(e,a,n){n.r(a),n.d(a,{default:function(){return De}});var t=n(641),o=n(33),s=n(3751);const i=["id"],r={key:0,class:"loading"},l={key:1,class:"error"},c={key:2,class:"menu-content"},u={key:0,class:"business-info"},d=["src"],m={class:"description"},p={key:1,class:"contact-info"},v={key:0},f={key:1},y={class:"menu-list"},g={class:"menu-items"},b={class:"item-image-container"},I=["src"],h={key:1,src:"https://via.placeholder.com/150?text=Sin+Imagen",alt:"Sin imagen disponible",class:"item-image"},k={class:"item-details"},L={class:"item-description"},E={class:"item-price"},C={key:0,class:"includes-drink"},$=["onClick","disabled"],D={key:0,class:"btn-icon"},P={key:1,class:"btn-icon"},w={key:0,class:"menu-list special-menu-list"},q={class:"menu-items"},A={class:"item-image-container"},R=["src"],X={key:1,src:"https://via.placeholder.com/150?text=Sin+Imagen",alt:"Sin imagen disponible",class:"item-image"},N={class:"item-details"},Q={class:"item-description"},_={class:"item-price"},M={key:0,class:"includes-drink"},S=["onClick","disabled"],T={key:0,class:"btn-icon"},x={key:1,class:"btn-icon"},z={class:"order-section",ref:"orderSection"},U={key:0,class:"empty-cart"},W={key:1,class:"cart-items"},F={class:"cart-item-details"},O={class:"cart-item-actions"},V=["onClick"],K={class:"quantity-display"},B=["onClick"],J=["onClick"],j={class:"cart-total"},H={class:"customer-form"},G={class:"form-row"},Y={class:"form-row"},Z={class:"form-row"},ee={class:"form-row"},ae={class:"payment-methods-selection"},ne={class:"payment-options"},te={class:"payment-option"},oe={class:"payment-option"},se={class:"payment-option"},ie={class:"form-row"},re={class:"order-actions"},le={class:"cart-items-count"},ce={key:2,class:"payment-section"},ue={class:"payment-methods"},de={key:0,class:"payment-method"},me=["src"],pe={key:1,class:"payment-method"},ve=["src"],fe={key:1,class:"payment-detail"},ye={key:2,class:"payment-method"},ge={class:"payment-detail"},be={key:3,class:"payment-method"},Ie={class:"payment-detail"};function he(e,a,n,he,ke,Le){return(0,t.uX)(),(0,t.CE)("div",{class:"shared-menu-container",id:he.restauranteId},[he.isLoading?((0,t.uX)(),(0,t.CE)("div",r,a[10]||(a[10]=[(0,t.Lk)("div",{class:"spinner"},null,-1),(0,t.Lk)("p",null,"Cargando men√∫...",-1)]))):he.error?((0,t.uX)(),(0,t.CE)("div",l,[(0,t.Lk)("p",null,(0,o.v_)(he.error),1)])):((0,t.uX)(),(0,t.CE)("div",c,[he.menuData?.businessInfo?((0,t.uX)(),(0,t.CE)("div",u,[he.menuData.businessInfo.logo&&he.isValidImage(he.menuData.businessInfo.logo)?((0,t.uX)(),(0,t.CE)("img",{key:0,src:he.fixImageFormat(he.menuData.businessInfo.logo),alt:"Logo",class:"business-logo"},null,8,d)):(0,t.Q3)("",!0),(0,t.Lk)("h1",null,(0,o.v_)(he.menuData.businessInfo.name),1),(0,t.Lk)("p",m,(0,o.v_)(he.menuData.businessInfo.description),1),he.menuData.businessInfo.contact||he.menuData.businessInfo.address?((0,t.uX)(),(0,t.CE)("div",p,[he.menuData.businessInfo.contact?((0,t.uX)(),(0,t.CE)("p",v,[a[11]||(a[11]=(0,t.Lk)("strong",null,"Contacto:",-1)),(0,t.eW)(" "+(0,o.v_)(he.menuData.businessInfo.contact),1)])):(0,t.Q3)("",!0),he.menuData.businessInfo.address?((0,t.uX)(),(0,t.CE)("p",f,[a[12]||(a[12]=(0,t.Lk)("strong",null,"Direcci√≥n:",-1)),(0,t.eW)(" "+(0,o.v_)(he.menuData.businessInfo.address),1)])):(0,t.Q3)("",!0)])):(0,t.Q3)("",!0)])):(0,t.Q3)("",!0),(0,t.Lk)("div",null,[(0,t.Lk)("div",y,[a[13]||(a[13]=(0,t.Lk)("h2",null,"Nuestro Men√∫",-1)),(0,t.Lk)("div",g,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(he.regularItems,((e,a)=>((0,t.uX)(),(0,t.CE)("div",{key:a,class:"menu-item"},[(0,t.Lk)("div",b,[e.image&&he.isValidImage(e.image)?((0,t.uX)(),(0,t.CE)("img",{key:0,src:he.fixImageFormat(e.image),alt:"Imagen del producto",class:"item-image"},null,8,I)):((0,t.uX)(),(0,t.CE)("img",h))]),(0,t.Lk)("div",k,[(0,t.Lk)("h3",null,(0,o.v_)(e.name),1),(0,t.Lk)("p",L,(0,o.v_)(e.description),1),(0,t.Lk)("p",E,"$"+(0,o.v_)(he.formatPrice(e.price)),1),e.includesDrink?((0,t.uX)(),(0,t.CE)("p",C,"Incluye refresco")):(0,t.Q3)("",!0),(0,t.Lk)("button",{onClick:a=>he.addToCart(e),class:(0,o.C4)(["add-to-cart-btn",{"disabled-btn":!e.realAvailability||e.realAvailability<=0}]),disabled:!e.realAvailability||e.realAvailability<=0},[!e.realAvailability||e.realAvailability<=0?((0,t.uX)(),(0,t.CE)("span",D,"‚ùå")):((0,t.uX)(),(0,t.CE)("span",P,"üõí")),(0,t.eW)(" "+(0,o.v_)(!e.realAvailability||e.realAvailability<=0?"No disponible":"A√±adir al pedido"),1)],10,$)])])))),128))])]),he.specialItems.length>0?((0,t.uX)(),(0,t.CE)("div",w,[a[14]||(a[14]=(0,t.Lk)("h2",null,"Platos Especiales",-1)),(0,t.Lk)("div",q,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(he.specialItems,((e,a)=>((0,t.uX)(),(0,t.CE)("div",{key:a,class:"menu-item special-item"},[(0,t.Lk)("div",A,[e.image&&he.isValidImage(e.image)?((0,t.uX)(),(0,t.CE)("img",{key:0,src:he.fixImageFormat(e.image),alt:"Imagen del producto",class:"item-image"},null,8,R)):((0,t.uX)(),(0,t.CE)("img",X))]),(0,t.Lk)("div",N,[(0,t.Lk)("h3",null,(0,o.v_)(e.name),1),(0,t.Lk)("p",Q,(0,o.v_)(e.description),1),(0,t.Lk)("p",_,"$"+(0,o.v_)(he.formatPrice(e.price)),1),e.includesDrink?((0,t.uX)(),(0,t.CE)("p",M,"Incluye refresco")):(0,t.Q3)("",!0),(0,t.Lk)("button",{onClick:a=>he.addToCart(e),class:(0,o.C4)(["add-to-cart-btn special-button",{"disabled-btn":!e.realAvailability||e.realAvailability<=0}]),disabled:!e.realAvailability||e.realAvailability<=0},[!e.realAvailability||e.realAvailability<=0?((0,t.uX)(),(0,t.CE)("span",T,"‚ùå")):((0,t.uX)(),(0,t.CE)("span",x,"üõí")),(0,t.eW)(" "+(0,o.v_)(!e.realAvailability||e.realAvailability<=0?"No disponible":"A√±adir al pedido"),1)],10,S)])])))),128))])])):(0,t.Q3)("",!0),(0,t.Lk)("div",z,[a[23]||(a[23]=(0,t.Lk)("h2",null,"Tu Pedido",-1)),0===he.cartItems.length?((0,t.uX)(),(0,t.CE)("div",U,a[15]||(a[15]=[(0,t.Lk)("p",null,"Tu pedido est√° vac√≠o",-1),(0,t.Lk)("p",{class:"empty-cart-message"},"A√±ade productos del men√∫ para comenzar tu pedido",-1)]))):((0,t.uX)(),(0,t.CE)("div",W,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(he.cartItems,((e,n)=>((0,t.uX)(),(0,t.CE)("div",{key:n,class:"cart-item"},[(0,t.Lk)("div",F,[(0,t.Lk)("h3",null,(0,o.v_)(e.name),1),(0,t.Lk)("p",null,"$"+(0,o.v_)(he.formatPrice(e.price))+" x "+(0,o.v_)(e.quantity),1)]),(0,t.Lk)("div",O,[(0,t.Lk)("button",{onClick:e=>he.decreaseQuantity(n),class:"quantity-btn"},"-",8,V),(0,t.Lk)("span",K,(0,o.v_)(e.quantity),1),(0,t.Lk)("button",{onClick:e=>he.increaseQuantity(n),class:"quantity-btn"},"+",8,B),(0,t.Lk)("button",{onClick:e=>he.removeFromCart(n),class:"remove-btn"},a[16]||(a[16]=[(0,t.Lk)("span",{class:"btn-icon"},"üóëÔ∏è",-1)]),8,J)])])))),128)),(0,t.Lk)("div",j,[(0,t.Lk)("h3",null,"Total: $"+(0,o.v_)(he.formatPrice(he.cartTotal)),1),(0,t.Lk)("div",H,[a[21]||(a[21]=(0,t.Lk)("h4",null,"Datos del Cliente",-1)),(0,t.Lk)("div",G,[(0,t.bo)((0,t.Lk)("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>he.customerInfo.name=e),placeholder:"Nombres completos",class:"form-input"},null,512),[[s.Jo,he.customerInfo.name]])]),(0,t.Lk)("div",Y,[(0,t.bo)((0,t.Lk)("input",{type:"tel","onUpdate:modelValue":a[1]||(a[1]=e=>he.customerInfo.phone=e),placeholder:"Tel√©fono",class:"form-input"},null,512),[[s.Jo,he.customerInfo.phone]])]),(0,t.Lk)("div",Z,[(0,t.bo)((0,t.Lk)("input",{type:"email","onUpdate:modelValue":a[2]||(a[2]=e=>he.customerInfo.email=e),placeholder:"Correo electr√≥nico",class:"form-input"},null,512),[[s.Jo,he.customerInfo.email]])]),(0,t.Lk)("div",ee,[(0,t.bo)((0,t.Lk)("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=e=>he.customerInfo.address=e),placeholder:"Direcci√≥n de entrega",class:"form-input"},null,512),[[s.Jo,he.customerInfo.address]])]),(0,t.Lk)("div",ae,[a[20]||(a[20]=(0,t.Lk)("h4",null,"Forma de Pago",-1)),(0,t.Lk)("div",ne,[(0,t.Lk)("label",te,[(0,t.bo)((0,t.Lk)("input",{type:"radio","onUpdate:modelValue":a[4]||(a[4]=e=>he.selectedPaymentMethod=e),value:"qr",name:"paymentMethod"},null,512),[[s.XL,he.selectedPaymentMethod]]),a[17]||(a[17]=(0,t.Lk)("span",{class:"payment-option-text"},"QR",-1))]),(0,t.Lk)("label",oe,[(0,t.bo)((0,t.Lk)("input",{type:"radio","onUpdate:modelValue":a[5]||(a[5]=e=>he.selectedPaymentMethod=e),value:"nequi",name:"paymentMethod"},null,512),[[s.XL,he.selectedPaymentMethod]]),a[18]||(a[18]=(0,t.Lk)("span",{class:"payment-option-text"},"Nequi",-1))]),(0,t.Lk)("label",se,[(0,t.bo)((0,t.Lk)("input",{type:"radio","onUpdate:modelValue":a[6]||(a[6]=e=>he.selectedPaymentMethod=e),value:"cash",name:"paymentMethod"},null,512),[[s.XL,he.selectedPaymentMethod]]),a[19]||(a[19]=(0,t.Lk)("span",{class:"payment-option-text"},"Contra entrega",-1))])])]),(0,t.Lk)("div",ie,[(0,t.bo)((0,t.Lk)("textarea",{"onUpdate:modelValue":a[7]||(a[7]=e=>he.additionalMessage=e),placeholder:"Mensaje o instrucciones adicionales",class:"form-textarea"},null,512),[[s.Jo,he.additionalMessage]])])]),(0,t.Lk)("div",re,[(0,t.Lk)("button",{onClick:a[8]||(a[8]=(...e)=>he.completeOrder&&he.completeOrder(...e)),class:"complete-order-btn"},a[22]||(a[22]=[(0,t.Lk)("span",{class:"btn-icon"},"üì±",-1),(0,t.eW)(" Enviar por WhatsApp ")]))])])]))],512),he.cartItems.length>0?((0,t.uX)(),(0,t.CE)("div",{key:1,class:"floating-cart-button",onClick:a[9]||(a[9]=(...e)=>he.scrollToOrder&&he.scrollToOrder(...e))},[(0,t.Lk)("span",le,(0,o.v_)(he.totalItems),1),a[24]||(a[24]=(0,t.Lk)("span",null,"Ver Pedido",-1))])):(0,t.Q3)("",!0),he.hasPaymentInfo?((0,t.uX)(),(0,t.CE)("div",ce,[a[31]||(a[31]=(0,t.Lk)("h2",null,"Forma de Pago",-1)),(0,t.Lk)("div",ue,[he.menuData?.businessInfo?.paymentInfo?.qrImage?((0,t.uX)(),(0,t.CE)("div",de,[(0,t.Lk)("h3",null,(0,o.v_)(he.menuData?.businessInfo?.paymentInfo?.qrTitle||"C√≥digo QR de Pago"),1),he.menuData?.businessInfo?.paymentInfo?.qrImage&&he.isValidImage(he.menuData?.businessInfo?.paymentInfo?.qrImage)?((0,t.uX)(),(0,t.CE)("img",{key:0,src:he.fixImageFormat(he.menuData?.businessInfo?.paymentInfo?.qrImage),alt:"QR de Pago",class:"payment-image"},null,8,me)):(0,t.Q3)("",!0)])):(0,t.Q3)("",!0),he.menuData?.businessInfo?.paymentInfo?.nequiNumber||he.menuData?.businessInfo?.paymentInfo?.nequiImage?((0,t.uX)(),(0,t.CE)("div",pe,[a[26]||(a[26]=(0,t.Lk)("h3",null,"Pago con Nequi",-1)),he.menuData?.businessInfo?.paymentInfo?.nequiImage&&he.isValidImage(he.menuData?.businessInfo?.paymentInfo?.nequiImage)?((0,t.uX)(),(0,t.CE)("img",{key:0,src:he.fixImageFormat(he.menuData?.businessInfo?.paymentInfo?.nequiImage),alt:"Nequi",class:"payment-image"},null,8,ve)):(0,t.Q3)("",!0),he.menuData?.businessInfo?.paymentInfo?.nequiNumber?((0,t.uX)(),(0,t.CE)("p",fe,[a[25]||(a[25]=(0,t.Lk)("strong",null,"N√∫mero:",-1)),(0,t.eW)(" "+(0,o.v_)(he.menuData?.businessInfo?.paymentInfo?.nequiNumber),1)])):(0,t.Q3)("",!0)])):(0,t.Q3)("",!0),he.menuData?.businessInfo?.paymentInfo?.bankInfo?((0,t.uX)(),(0,t.CE)("div",ye,[a[28]||(a[28]=(0,t.Lk)("h3",null,"Pago Bancario",-1)),(0,t.Lk)("p",ge,[a[27]||(a[27]=(0,t.Lk)("strong",null,"Informaci√≥n Bancaria:",-1)),(0,t.eW)(" "+(0,o.v_)(he.menuData?.businessInfo?.paymentInfo?.bankInfo),1)])])):(0,t.Q3)("",!0),he.menuData?.businessInfo?.paymentInfo?.otherPaymentMethods?((0,t.uX)(),(0,t.CE)("div",be,[a[30]||(a[30]=(0,t.Lk)("h3",null,"Otras Formas de Pago",-1)),(0,t.Lk)("p",Ie,[a[29]||(a[29]=(0,t.Lk)("strong",null,"M√©todos Adicionales:",-1)),(0,t.eW)(" "+(0,o.v_)(he.menuData?.businessInfo?.paymentInfo?.otherPaymentMethods),1)])])):(0,t.Q3)("",!0)])])):(0,t.Q3)("",!0),he.toast.visible?((0,t.uX)(),(0,t.CE)("div",{key:3,class:(0,o.C4)(["toast-notification",he.toast.type])},(0,o.v_)(he.toast.message),3)):(0,t.Q3)("",!0)])]))],8,i)}n(4114),n(8111),n(2489),n(116),n(7588),n(1701),n(8237);var ke=n(953),Le=n(5220),Ee={name:"SharedMenuView",setup(){const e=(0,Le.lq)(),a=(0,ke.KR)(!0),o=(0,ke.KR)(null),s=(0,ke.KR)(null),i=(0,ke.KR)([]),r=(0,ke.KR)({name:"",phone:"",email:"",address:""}),l=(0,ke.KR)("cash"),c=(0,ke.KR)(""),u=(0,t.EW)((()=>e.params.id||"1")),d=(0,t.EW)((()=>s.value&&s.value.items?s.value.items.filter((e=>!e.isSpecial)):[])),m=(0,t.EW)((()=>s.value&&s.value.items?s.value.items.filter((e=>e.isSpecial)):[])),p=(0,t.EW)((()=>i.value.reduce(((e,a)=>e+a.price*a.quantity),0))),v=async()=>{try{a.value=!0,o.value=null;const r=await Promise.resolve().then(n.bind(n,4640)),l=r.default.API_URL;console.log("Usando API URL:",l);const c=e.params.id;if(console.log("ID del restaurante desde URL:",c),!c)return o.value="ID de restaurante no v√°lido",void(a.value=!1);try{const e="https://websap-backend.onrender.com/api/menu-publico/1";console.log("Intentando cargar men√∫ desde URL de producci√≥n:",e);const n=await fetch(e);if(n.ok){const e=await n.json();if(e.success)return s.value=e.menu,console.log("Men√∫ cargado correctamente desde producci√≥n:",s.value),void(a.value=!1)}console.error("Error al cargar desde URL de producci√≥n, intentando con API_URL")}catch(t){console.error("Error al cargar desde URL de producci√≥n:",t)}try{const e=`${l}/menu-publico/${c}`;console.log("Intentando cargar men√∫ desde API_URL:",e);const n=await fetch(e);if(!n.ok){console.error("Error en la respuesta de API_URL:",n.status,n.statusText),console.log("Intentando cargar men√∫ con ID de fallback: 1");const e=await fetch(`${l}/menu-publico/1`);if(!e.ok)throw new Error(`Error al cargar el men√∫ con ID de fallback: ${e.status}`);const t=await e.json();if(t.success)return s.value=t.menu,console.log("Men√∫ cargado con ID de fallback:",s.value),void(a.value=!1);throw new Error("Error al cargar el men√∫ con ID de fallback")}const t=await n.json();if(!t.success)throw new Error(t.message||"Error al cargar el men√∫");return s.value=t.menu,console.log("Men√∫ cargado correctamente desde API_URL:",s.value),void(a.value=!1)}catch(i){console.error("Error al cargar desde API_URL:",i),console.log("Creando datos de demostraci√≥n como √∫ltimo recurso"),s.value={restaurante:{id:"demo",nombre:"Restaurante de Demostraci√≥n",descripcion:"Este es un restaurante de demostraci√≥n para probar la aplicaci√≥n",direccion:"Calle Principal #123",telefono:"123-456-7890",logo:"https://picsum.photos/200",horarios:"Lunes a Domingo: 8:00 AM - 10:00 PM"},items:[{id:"demo-1",name:"Hamburguesa Cl√°sica",description:"Deliciosa hamburguesa con carne, queso, lechuga y tomate",price:15e3,image:"https://picsum.photos/300?random=1",category:"Hamburguesas",available:!0,isSpecial:!0},{id:"demo-2",name:"Pizza Margarita",description:"Pizza tradicional con salsa de tomate, queso mozzarella y albahaca",price:25e3,image:"https://picsum.photos/300?random=2",category:"Pizzas",available:!0,isSpecial:!1},{id:"demo-3",name:"Ensalada C√©sar",description:"Ensalada fresca con lechuga, pollo, crutones y aderezo c√©sar",price:12e3,image:"https://picsum.photos/300?random=3",category:"Ensaladas",available:!0,isSpecial:!1}],businessInfo:{name:"Restaurante de Demostraci√≥n",description:"Este es un restaurante de demostraci√≥n para probar la aplicaci√≥n",contact:"123-456-7890",address:"Calle Principal #123",logo:"https://picsum.photos/200"}}}a.value=!1}catch(r){console.error("Error general al cargar el men√∫:",r),o.value="Error al cargar el men√∫. Por favor, intenta de nuevo.",a.value=!1}},f=(0,t.EW)((()=>{const e=s.value?.businessInfo?.paymentInfo;return!!e&&!!(e.qrImage&&R(e.qrImage)||e.qrTitle||e.nequiNumber||e.nequiImage&&R(e.nequiImage)||e.bankInfo||e.otherPaymentMethods)})),y=(0,t.EW)((()=>i.value.reduce(((e,a)=>e+a.quantity),0)));function g(e){if(isNaN(Number(e)))return"0,00";const a=Number(e).toFixed(2),[n,t]=a.split("."),o=n.replace(/\B(?=(\d{3})+(?!\d))/g,".");return`${o},${t}`}async function b(e){if(Number(e.availableQuantity)<=0)return void I(`Lo sentimos, "${e.name}" no est√° disponible actualmente. Intente m√°s tarde por favor.`,"error");const a=await w(e);if(!a)return;const n=i.value.find((a=>e.id&&a.id?a.id===e.id:a.name===e.name));n?n.quantity++:i.value.push({id:e.id||Date.now().toString(),name:e.name,price:e.price,quantity:1,availableQuantity:e.availableQuantity||0}),h(),A(),I(`${e.name} a√±adido al carrito`,"success")}function I(e,a="success",n=5e3){console.log(`[Toast] Mostrando notificaci√≥n: ${e} (${a})`),F.value.timeoutId&&clearTimeout(F.value.timeoutId),F.value.message=e,F.value.type=a,F.value.visible=!0,console.log(`[Toast] Estado: visible=${F.value.visible}, message=${F.value.message}`),F.value.timeoutId=setTimeout((()=>{console.log(`[Toast] Ocultando notificaci√≥n despu√©s de ${n}ms`),F.value.visible=!1}),n)}function h(){try{localStorage.setItem(`cart_${u.value}`,JSON.stringify(i.value))}catch(e){console.error("Error al guardar carrito en localStorage:",e)}}function k(e){const a=i.value[e],n=s.value.items?.find((e=>e.id===a.id));if(n){const e=n.availableQuantity||0;if(a.quantity>=e)return void I(`No hay m√°s unidades disponibles de "${a.name}"`,"warning")}a.quantity++,h(),A()}function L(e){i.value[e].quantity>1?(i.value[e].quantity--,h(),A()):E(e)}function E(e){i.value.splice(e,1),h(),A()}async function C(){try{if(0===i.value.length)return void I("No hay √≠tems en el pedido","error");if(!r.value.name||!r.value.phone)return void I("Por favor complete su nombre y tel√©fono","error");isProcessingOrder.value=!0,await q(),D(),I("¬°Pedido completado! Gracias por tu compra.","success"),setTimeout((()=>{i.value=[],localStorage.removeItem(`cart_${u.value}`),r.value={name:"",phone:"",email:"",address:""},c.value="",isProcessingOrder.value=!1}),2e3)}catch(o){console.error("Error al completar el pedido:",o),I("Error al procesar el pedido","error"),isProcessingOrder.value=!1}}function $(){0!==i.value.length?r.value.name&&r.value.phone?(D(),I("Pedido compartido por WhatsApp","success")):I("Por favor complete su nombre y tel√©fono","error"):I("No hay √≠tems en el pedido","error")}function D(){let e=`üõí *Pedido de ${r.value.name}*\n\n`;e+="üì¶ *Productos:*\n",i.value.forEach((a=>{const n=(a.price*a.quantity).toFixed(2);e+=`üçΩÔ∏è ${a.quantity}x ${a.name} = $${g(n)}\n`})),e+=`\nüíµ *Total:* $${g(p.value)}\n`,r.value.phone&&(e+=`üìû *Tel√©fono:* ${r.value.phone}\n`),r.value.email&&(e+=`‚úâÔ∏è *Email:* ${r.value.email}\n`),r.value.address&&(e+=`üìç *Direcci√≥n:* ${r.value.address}\n`),c.value&&(e+=`üìù *Notas adicionales:*\n${c.value}\n`);const a="qr"===l.value?"C√≥digo QR":"nequi"===l.value?"Nequi":"Contra entrega";e+=`\nüí≥ *Forma de pago:* ${a}`;const n=encodeURIComponent(e),t=`https://api.whatsapp.com/send?text=${n}`;window.open(t,"_blank")}function P(){const e=document.querySelector(".order-section");e&&e.scrollIntoView({behavior:"smooth"})}async function w(e){const a=Number(e.availableQuantity)||0;if(a<=0)return I(`Lo sentimos, "${e.name}" no est√° disponible actualmente. Intente m√°s tarde por favor.`,"error"),!1;const n=i.value.find((a=>a.id===e.id)),t=n?n.quantity:0,o=a-t;return o<=0?(I(`No hay m√°s unidades disponibles de "${e.name}"`,"warning"),!1):(o<=5&&I(`¬°Solo quedan ${o} unidades de "${e.name}"!`,"warning"),!0)}async function q(){try{if(!i.value||0===i.value.length)return void console.warn("Intentando actualizar inventario con carrito vac√≠o");console.log(`Iniciando actualizaci√≥n de inventario para ${i.value.length} productos...`);const o=await getMenuItems();if(!o||!Array.isArray(o))return console.error("No se pudo obtener el men√∫ actual"),!1;const s=JSON.parse(JSON.stringify(i.value)),r=[];let l=!1;const{getSoldItems:c,saveSoldItems:u}=await n.e(982).then(n.bind(n,8982));let d=[];try{d=await c()||[],Array.isArray(d)||(d=[]),console.log("Lista de elementos vendidos obtenida:",d.length)}catch(e){console.warn("Error al obtener elementos vendidos:",e),d=[]}for(let e=0;e<s.length;e++){const n=s[e];console.log(`Procesando item ${e+1}/${s.length}: ${n.name} (ID: ${n.id})`);try{const e=o.find((e=>e.id===n.id));if(!e){console.warn(`Elemento no encontrado en el men√∫: ${n.name} (ID: ${n.id})`),r.push({name:n.name,success:!1,error:"Elemento no encontrado en el men√∫"});continue}const a=parseInt(Number(e.availableQuantity||0),10),t=parseInt(Number(n.quantity||0),10);if(isNaN(a)||isNaN(t)){const a=`Cantidades inv√°lidas para ${n.name}: disponible=${e.availableQuantity}, vendido=${n.quantity}`;console.error(a),r.push({name:n.name,success:!1,error:a}),l=!0;continue}const s=Math.max(0,a-t);console.log(`Actualizando ${n.name}: ${a} - ${t} = ${s} (currentQuantity tipo: ${typeof a}, soldQuantity tipo: ${typeof t})`);const i=await updateItemAvailability(e.id,s);if(r.push({name:n.name,oldQuantity:a,soldQuantity:t,newQuantity:s,success:i,error:i?null:"Error al actualizar disponibilidad"}),i){const a=(new Date).toISOString(),o=d.find((e=>e.name===n.name));o?(o.quantity+=t,o.date=a):d.push({name:n.name,quantity:t,price:n.price,includesDrink:e.includesDrink||!1,date:a}),console.log(`Elemento registrado en lista de vendidos: ${n.name} x${t}`)}else l=!0}catch(a){console.error(`Error procesando ${n.name}:`,a),r.push({name:n.name,success:!1,error:a.message||"Error desconocido"}),l=!0}}try{await u(d),console.log(`Lista de elementos vendidos actualizada con ${d.length} elementos`)}catch(t){console.error("Error al guardar elementos vendidos:",t)}const m=r.filter((e=>e.success)).length;if(console.log(`Actualizaci√≥n de inventario completada. √âxitos: ${m}/${s.length}`),console.log("Detalles de actualizaci√≥n de inventario:",r),l){const e=r.filter((e=>!e.success)).map((e=>e.name)).join(", ");console.warn(`Algunos productos no se pudieron actualizar: ${e}`)}return m>0}catch(o){return console.error("Error general al actualizar inventario:",o),!1}}function A(){s.value?.items&&s.value.items.forEach((e=>{const a=i.value.find((a=>a.id===e.id)),n=a?a.quantity:0,t=Number(e.availableQuantity)||0;e.realAvailability=t-n,console.log(`Disponibilidad actualizada para ${e.name}: ${e.realAvailability} unidades (base: ${t}, carrito: ${n})`)}))}function R(e){return!!e&&(!(!e.startsWith("http://")&&!e.startsWith("https://"))||!!e.startsWith("data:image/"))}function X(e){return e?R(e)?e:e.includes("/9j/")&&!e.startsWith("data:image/")?`data:image/jpeg;base64,${e}`:"":""}const N=(0,ke.KR)(!1),Q=(0,ke.KR)(!1),_=(0,ke.KR)(!1),M=(0,ke.KR)(null),S=(0,ke.KR)({fullName:"",mobilePhone:"",landlinePhone:"",address:"",email:"",orderDate:T(),reservationDate:"",reservationTime:"",peopleCount:1,additionalNotes:""});function T(){const e=new Date,a=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),t=String(e.getDate()).padStart(2,"0");return`${a}-${n}-${t}`}async function x(){Q.value=!0,_.value=!1,M.value=null;try{const e=await saveReservation(S.value);if(!e.success)throw new Error(e.error||"Error al procesar la reserva");_.value=!0,I("¬°Reserva enviada con √©xito! Recibir√° un correo de confirmaci√≥n en breve.","success"),console.log("Enviando correo de confirmaci√≥n a:",S.value.email),setTimeout((()=>{U(),N.value=!1}),3e3)}catch(o){console.error("Error al enviar la reserva:",o),M.value="Ocurri√≥ un error al procesar su reserva. Por favor, intente nuevamente.",I("Error al procesar la reserva. Por favor, intente nuevamente.","error")}finally{Q.value=!1}}function z(){U(),N.value=!1}function U(){S.value.fullName="",S.value.mobilePhone="",S.value.landlinePhone="",S.value.address="",S.value.email="",S.value.orderDate=T(),S.value.reservationDate="",S.value.reservationTime="",S.value.peopleCount=1,S.value.additionalNotes="",_.value=!1,M.value=null}async function W(){try{const e=await fetchBusinessInfoFromBackend(!0);e&&(s.value.businessInfo=e,O.value=Date.now(),I("Informaci√≥n del negocio actualizada","success"))}catch(o){console.error("Error al refrescar informaci√≥n del negocio:",o),I("Error al actualizar informaci√≥n del negocio","error")}}const F=(0,ke.KR)({visible:!1,message:"",type:"success",timeoutId:null}),O=(0,ke.KR)(null);return(0,t.sV)((()=>{v()})),{restauranteId:u,isLoading:a,error:o,menuData:s,regularItems:d,specialItems:m,cartItems:i,cartTotal:p,totalItems:y,customerInfo:r,selectedPaymentMethod:l,additionalMessage:c,addToCart:b,removeFromCart:E,increaseQuantity:k,decreaseQuantity:L,formatPrice:g,completeOrder:C,shareOrderByWhatsApp:$,scrollToOrder:P,isValidImage:R,fixImageFormat:X,hasPaymentInfo:f,showReservationForm:N,reservationData:S,isProcessingReservation:Q,reservationSuccess:_,reservationError:M,submitReservation:x,cancelReservation:z,getCurrentDate:T,toast:F,refreshBusinessInfo:W,lastBusinessInfoUpdate:O}}},Ce=n(6262);const $e=(0,Ce.A)(Ee,[["render",he],["__scopeId","data-v-2ce18f45"]]);var De=$e},8237:function(e,a,n){var t=n(6518),o=n(2652),s=n(9306),i=n(8551),r=n(1767),l=TypeError;t({target:"Iterator",proto:!0,real:!0},{reduce:function(e){i(this),s(e);var a=r(this),n=arguments.length<2,t=n?void 0:arguments[1],c=0;if(o(a,(function(a){n?(n=!1,t=a):t=e(t,a,c),c++}),{IS_RECORD:!0}),n)throw new l("Reduce of empty iterator with no initial value");return t}})}}]);
//# sourceMappingURL=shared-menu.af7476e2.js.map