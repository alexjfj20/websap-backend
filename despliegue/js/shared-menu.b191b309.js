"use strict";(self["webpackChunkwebsap"]=self["webpackChunkwebsap"]||[]).push([[260],{2949:function(e,a,n){n.d(a,{Bg:function(){return f},D2:function(){return g},Jo:function(){return y},Vg:function(){return b},ag:function(){return p},qW:function(){return h},xr:function(){return v}});var o=n(133),t=n(8982),r=n(7051);const s=3e4,i=3e5;let l=null,c=0,u=0,d=null,m=!1;async function p(){try{const e=await(0,t.By)();if(!e||0===Object.keys(e).length)return console.log("No hay informaci√≥n del negocio para sincronizar"),{success:!1,message:"No hay informaci√≥n del negocio para sincronizar"};console.log("Sincronizando informaci√≥n del negocio con el backend:",e);const a=localStorage.getItem("token");a&&o["default"].setToken(a);const n=await o["default"].get("/auth/me");if(!n||!n.success||!n.user||!n.user.restaurante_id)return console.warn("No se pudo obtener el restaurante del usuario actual"),{success:!1,message:"No se pudo obtener el restaurante del usuario actual"};const s=n.user.restaurante_id,i={nombre:e.name,descripcion:e.description,direccion:e.address,telefono:e.contact,logo:e.logo,informacion_pago:JSON.stringify(e.paymentInfo||{})},l=await o["default"].put(`/restaurantes/${s}`,i);return l&&l.success?(console.log("Informaci√≥n del negocio sincronizada con √©xito"),c=Date.now(),r.A.emit("business-info-updated",e),{success:!0,message:"Informaci√≥n del negocio sincronizada con √©xito",timestamp:c}):(console.warn("Error al sincronizar informaci√≥n del negocio:",l),{success:!1,message:l.message||"Error al sincronizar informaci√≥n del negocio"})}catch(e){return console.error("Error al sincronizar informaci√≥n del negocio:",e),{success:!1,message:e.message||"Error al sincronizar informaci√≥n del negocio"}}}async function v(e=!1){try{const n=Date.now();if(d&&!e&&n-u<i)return console.log("Usando informaci√≥n de negocio en cach√©"),d;const s=localStorage.getItem("token");s&&o["default"].setToken(s);const l=await o["default"].get("/auth/me");if(!l||!l.success||!l.user||!l.user.restaurante_id)throw console.warn("No se pudo obtener el restaurante del usuario actual"),new Error("No se pudo obtener el restaurante del usuario actual");const c=l.user.restaurante_id,m=await o["default"].get(`/restaurantes/${c}`);if(m&&m.success&&m.restaurante){const e=m.restaurante;let o={};try{e.informacion_pago&&(o=JSON.parse(e.informacion_pago))}catch(a){console.warn("Error al parsear informaci√≥n de pago:",a)}const s={name:e.nombre,description:e.descripcion,address:e.direccion,contact:e.telefono,logo:e.logo,paymentInfo:o};return await(0,t.AU)(s),d=s,u=n,r.A.emit("business-info-updated",s),console.log("Informaci√≥n del negocio obtenida con √©xito:",s),s}throw console.warn("Error al obtener informaci√≥n del negocio:",m),new Error(m?.message||"Error al obtener informaci√≥n del negocio")}catch(n){console.error("Error al obtener informaci√≥n del negocio desde el backend:",n);try{const e=await(0,t.By)();if(e)return e}catch(s){console.error("Error al obtener informaci√≥n local:",s)}throw n}}async function f(){try{const e=await(0,t.By)(),a=await v(!0),n=JSON.stringify(e),o=JSON.stringify(a),s=n!==o;return s&&(console.log("Se detectaron cambios en la informaci√≥n del negocio"),await(0,t.AU)(a),r.A.emit("business-info-updated",a)),s}catch(e){return console.error("Error al verificar cambios en informaci√≥n del negocio:",e),!1}}function g(e=!1){e?console.log("Sincronizaci√≥n de informaci√≥n del negocio desactivada (modo vista compartida)"):(l&&clearInterval(l),m||(v().catch((e=>console.error("Error en sincronizaci√≥n inicial:",e))),m=!0),l=setInterval((()=>{f().catch((e=>console.error("Error en verificaci√≥n peri√≥dica:",e)))}),s),console.log("Verificaci√≥n peri√≥dica de informaci√≥n del negocio iniciada"))}function b(){l&&(clearInterval(l),l=null,console.log("Verificaci√≥n peri√≥dica de informaci√≥n del negocio detenida"))}async function y(){try{const e=localStorage.getItem("token");e&&o["default"].setToken(e);const a=await o["default"].get("/restaurantes/migrate/add-informacion-pago");return a&&a.success?(console.log("Migraci√≥n ejecutada con √©xito:",a.message),{success:!0,message:a.message||"Migraci√≥n ejecutada con √©xito"}):(console.warn("Error al ejecutar migraci√≥n:",a),{success:!1,message:a.message||"Error al ejecutar migraci√≥n"})}catch(e){return console.error("Error al ejecutar migraci√≥n:",e),{success:!1,message:e.message||"Error al ejecutar migraci√≥n"}}}function h(){d=null,u=0}},5244:function(e,a,n){n.r(a),n.d(a,{default:function(){return He}});var o=n(641),t=n(33),r=n(3751);const s=["id"],i={key:0,class:"loading"},l={key:1,class:"error"},c={key:2,class:"menu-content"},u={key:0,class:"business-info"},d=["src"],m={class:"description"},p={key:1,class:"contact-info"},v={key:0},f={key:1},g={class:"menu-list"},b={class:"menu-items"},y={class:"item-image-container"},h=["src"],k={key:1,src:"https://via.placeholder.com/150?text=Sin+Imagen",alt:"Sin imagen disponible",class:"item-image"},I={class:"item-details"},L={class:"item-description"},E={class:"item-price"},C={key:0,class:"includes-drink"},w=["onClick","disabled"],D={key:0,class:"btn-icon"},P={key:1,class:"btn-icon"},$={key:0,class:"menu-list special-menu-list"},N={class:"menu-items"},q={class:"item-image-container"},R=["src"],S={key:1,src:"https://via.placeholder.com/150?text=Sin+Imagen",alt:"Sin imagen disponible",class:"item-image"},A={class:"item-details"},Q={class:"item-description"},X={class:"item-price"},_={key:0,class:"includes-drink"},x=["onClick","disabled"],T={key:0,class:"btn-icon"},F={key:1,class:"btn-icon"},V={class:"order-section",ref:"orderSection"},M={key:0,class:"empty-cart"},z={key:1,class:"cart-items"},J={class:"cart-item-details"},W={class:"cart-item-actions"},U=["onClick"],O={class:"quantity-display"},K=["onClick"],j=["onClick"],B={class:"cart-total"},H={class:"customer-form"},Y={class:"form-row"},G={class:"form-row"},Z={class:"form-row"},ee={class:"form-row"},ae={class:"payment-methods-selection"},ne={class:"payment-options"},oe={class:"payment-option"},te={class:"payment-option"},re={class:"payment-option"},se={class:"form-row"},ie={class:"order-actions"},le={class:"cart-items-count"},ce={key:2,class:"payment-section"},ue={class:"payment-methods"},de={key:0,class:"payment-method"},me=["src"],pe={key:1,class:"payment-method"},ve=["src"],fe={key:1,class:"payment-detail"},ge={key:2,class:"payment-method"},be={class:"payment-detail"},ye={key:3,class:"payment-method"},he={class:"payment-detail"},ke={class:"reserva-section container mt-5"};function Ie(e,a,n,Ie,Le,Ee){const Ce=(0,o.g2)("ReservaForm");return(0,o.uX)(),(0,o.CE)("div",{class:"shared-menu-container",id:Ie.menuId},[Ie.isLoading?((0,o.uX)(),(0,o.CE)("div",i,a[10]||(a[10]=[(0,o.Lk)("div",{class:"spinner"},null,-1),(0,o.Lk)("p",null,"Cargando men√∫...",-1)]))):Ie.error?((0,o.uX)(),(0,o.CE)("div",l,[(0,o.Lk)("p",null,(0,t.v_)(Ie.error),1)])):((0,o.uX)(),(0,o.CE)("div",c,[Ie.menuData?.businessInfo?((0,o.uX)(),(0,o.CE)("div",u,[Ie.menuData.businessInfo.logo&&Ie.isValidImage(Ie.menuData.businessInfo.logo)?((0,o.uX)(),(0,o.CE)("img",{key:0,src:Ie.fixImageFormat(Ie.menuData.businessInfo.logo),alt:"Logo",class:"business-logo"},null,8,d)):(0,o.Q3)("",!0),(0,o.Lk)("h1",null,(0,t.v_)(Ie.menuData.businessInfo.name),1),(0,o.Lk)("p",m,(0,t.v_)(Ie.menuData.businessInfo.description),1),Ie.menuData.businessInfo.contact||Ie.menuData.businessInfo.address?((0,o.uX)(),(0,o.CE)("div",p,[Ie.menuData.businessInfo.contact?((0,o.uX)(),(0,o.CE)("p",v,[a[11]||(a[11]=(0,o.Lk)("strong",null,"Contacto:",-1)),(0,o.eW)(" "+(0,t.v_)(Ie.menuData.businessInfo.contact),1)])):(0,o.Q3)("",!0),Ie.menuData.businessInfo.address?((0,o.uX)(),(0,o.CE)("p",f,[a[12]||(a[12]=(0,o.Lk)("strong",null,"Direcci√≥n:",-1)),(0,o.eW)(" "+(0,t.v_)(Ie.menuData.businessInfo.address),1)])):(0,o.Q3)("",!0)])):(0,o.Q3)("",!0)])):(0,o.Q3)("",!0),(0,o.Lk)("div",null,[(0,o.Lk)("div",g,[a[13]||(a[13]=(0,o.Lk)("h2",null,"Nuestro Men√∫",-1)),(0,o.Lk)("div",b,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(Ie.regularItems,((e,a)=>((0,o.uX)(),(0,o.CE)("div",{key:a,class:"menu-item"},[(0,o.Lk)("div",y,[e.image&&Ie.isValidImage(e.image)?((0,o.uX)(),(0,o.CE)("img",{key:0,src:Ie.fixImageFormat(e.image),alt:"Imagen del producto",class:"item-image"},null,8,h)):((0,o.uX)(),(0,o.CE)("img",k))]),(0,o.Lk)("div",I,[(0,o.Lk)("h3",null,(0,t.v_)(e.name),1),(0,o.Lk)("p",L,(0,t.v_)(e.description),1),(0,o.Lk)("p",E,"$"+(0,t.v_)(Ie.formatPrice(e.price)),1),e.includesDrink?((0,o.uX)(),(0,o.CE)("p",C,"Incluye refresco")):(0,o.Q3)("",!0),(0,o.Lk)("button",{onClick:a=>Ie.addToCart(e),class:(0,t.C4)(["add-to-cart-btn",{"disabled-btn":!e.realAvailability||e.realAvailability<=0}]),disabled:!e.realAvailability||e.realAvailability<=0},[!e.realAvailability||e.realAvailability<=0?((0,o.uX)(),(0,o.CE)("span",D,"‚ùå")):((0,o.uX)(),(0,o.CE)("span",P,"üõí")),(0,o.eW)(" "+(0,t.v_)(!e.realAvailability||e.realAvailability<=0?"No disponible":"A√±adir al pedido"),1)],10,w)])])))),128))])]),Ie.specialItems.length>0?((0,o.uX)(),(0,o.CE)("div",$,[a[14]||(a[14]=(0,o.Lk)("h2",null,"Platos Especiales",-1)),(0,o.Lk)("div",N,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(Ie.specialItems,((e,a)=>((0,o.uX)(),(0,o.CE)("div",{key:a,class:"menu-item special-item"},[(0,o.Lk)("div",q,[e.image&&Ie.isValidImage(e.image)?((0,o.uX)(),(0,o.CE)("img",{key:0,src:Ie.fixImageFormat(e.image),alt:"Imagen del producto",class:"item-image"},null,8,R)):((0,o.uX)(),(0,o.CE)("img",S))]),(0,o.Lk)("div",A,[(0,o.Lk)("h3",null,(0,t.v_)(e.name),1),(0,o.Lk)("p",Q,(0,t.v_)(e.description),1),(0,o.Lk)("p",X,"$"+(0,t.v_)(Ie.formatPrice(e.price)),1),e.includesDrink?((0,o.uX)(),(0,o.CE)("p",_,"Incluye refresco")):(0,o.Q3)("",!0),(0,o.Lk)("button",{onClick:a=>Ie.addToCart(e),class:(0,t.C4)(["add-to-cart-btn special-button",{"disabled-btn":!e.realAvailability||e.realAvailability<=0}]),disabled:!e.realAvailability||e.realAvailability<=0},[!e.realAvailability||e.realAvailability<=0?((0,o.uX)(),(0,o.CE)("span",T,"‚ùå")):((0,o.uX)(),(0,o.CE)("span",F,"üõí")),(0,o.eW)(" "+(0,t.v_)(!e.realAvailability||e.realAvailability<=0?"No disponible":"A√±adir al pedido"),1)],10,x)])])))),128))])])):(0,o.Q3)("",!0),(0,o.Lk)("div",V,[a[23]||(a[23]=(0,o.Lk)("h2",null,"Tu Pedido",-1)),0===Ie.cartItems.length?((0,o.uX)(),(0,o.CE)("div",M,a[15]||(a[15]=[(0,o.Lk)("p",null,"Tu pedido est√° vac√≠o",-1),(0,o.Lk)("p",{class:"empty-cart-message"},"A√±ade productos del men√∫ para comenzar tu pedido",-1)]))):((0,o.uX)(),(0,o.CE)("div",z,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(Ie.cartItems,((e,n)=>((0,o.uX)(),(0,o.CE)("div",{key:n,class:"cart-item"},[(0,o.Lk)("div",J,[(0,o.Lk)("h3",null,(0,t.v_)(e.name),1),(0,o.Lk)("p",null,"$"+(0,t.v_)(Ie.formatPrice(e.price))+" x "+(0,t.v_)(e.quantity),1)]),(0,o.Lk)("div",W,[(0,o.Lk)("button",{onClick:e=>Ie.decreaseQuantity(n),class:"quantity-btn"},"-",8,U),(0,o.Lk)("span",O,(0,t.v_)(e.quantity),1),(0,o.Lk)("button",{onClick:e=>Ie.increaseQuantity(n),class:"quantity-btn"},"+",8,K),(0,o.Lk)("button",{onClick:e=>Ie.removeFromCart(n),class:"remove-btn"},a[16]||(a[16]=[(0,o.Lk)("span",{class:"btn-icon"},"üóëÔ∏è",-1)]),8,j)])])))),128)),(0,o.Lk)("div",B,[(0,o.Lk)("h3",null,"Total: $"+(0,t.v_)(Ie.formatPrice(Ie.cartTotal)),1),(0,o.Lk)("div",H,[a[21]||(a[21]=(0,o.Lk)("h4",null,"Datos del Cliente",-1)),(0,o.Lk)("div",Y,[(0,o.bo)((0,o.Lk)("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>Ie.customerInfo.name=e),placeholder:"Nombres completos",class:"form-input"},null,512),[[r.Jo,Ie.customerInfo.name]])]),(0,o.Lk)("div",G,[(0,o.bo)((0,o.Lk)("input",{type:"tel","onUpdate:modelValue":a[1]||(a[1]=e=>Ie.customerInfo.phone=e),placeholder:"Tel√©fono",class:"form-input"},null,512),[[r.Jo,Ie.customerInfo.phone]])]),(0,o.Lk)("div",Z,[(0,o.bo)((0,o.Lk)("input",{type:"email","onUpdate:modelValue":a[2]||(a[2]=e=>Ie.customerInfo.email=e),placeholder:"Correo electr√≥nico",class:"form-input"},null,512),[[r.Jo,Ie.customerInfo.email]])]),(0,o.Lk)("div",ee,[(0,o.bo)((0,o.Lk)("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=e=>Ie.customerInfo.address=e),placeholder:"Direcci√≥n de entrega",class:"form-input"},null,512),[[r.Jo,Ie.customerInfo.address]])]),(0,o.Lk)("div",ae,[a[20]||(a[20]=(0,o.Lk)("h4",null,"Forma de Pago",-1)),(0,o.Lk)("div",ne,[(0,o.Lk)("label",oe,[(0,o.bo)((0,o.Lk)("input",{type:"radio","onUpdate:modelValue":a[4]||(a[4]=e=>Ie.selectedPaymentMethod=e),value:"qr",name:"paymentMethod"},null,512),[[r.XL,Ie.selectedPaymentMethod]]),a[17]||(a[17]=(0,o.Lk)("span",{class:"payment-option-text"},"QR",-1))]),(0,o.Lk)("label",te,[(0,o.bo)((0,o.Lk)("input",{type:"radio","onUpdate:modelValue":a[5]||(a[5]=e=>Ie.selectedPaymentMethod=e),value:"nequi",name:"paymentMethod"},null,512),[[r.XL,Ie.selectedPaymentMethod]]),a[18]||(a[18]=(0,o.Lk)("span",{class:"payment-option-text"},"Nequi",-1))]),(0,o.Lk)("label",re,[(0,o.bo)((0,o.Lk)("input",{type:"radio","onUpdate:modelValue":a[6]||(a[6]=e=>Ie.selectedPaymentMethod=e),value:"cash",name:"paymentMethod"},null,512),[[r.XL,Ie.selectedPaymentMethod]]),a[19]||(a[19]=(0,o.Lk)("span",{class:"payment-option-text"},"Contra entrega",-1))])])]),(0,o.Lk)("div",se,[(0,o.bo)((0,o.Lk)("textarea",{"onUpdate:modelValue":a[7]||(a[7]=e=>Ie.additionalMessage=e),placeholder:"Mensaje o instrucciones adicionales",class:"form-textarea"},null,512),[[r.Jo,Ie.additionalMessage]])])]),(0,o.Lk)("div",ie,[(0,o.Lk)("button",{onClick:a[8]||(a[8]=(...e)=>Ie.completeOrder&&Ie.completeOrder(...e)),class:"complete-order-btn"},a[22]||(a[22]=[(0,o.Lk)("span",{class:"btn-icon"},"üì±",-1),(0,o.eW)(" Enviar por WhatsApp ")]))])])]))],512),Ie.cartItems.length>0?((0,o.uX)(),(0,o.CE)("div",{key:1,class:"floating-cart-button",onClick:a[9]||(a[9]=(...e)=>Ie.scrollToOrder&&Ie.scrollToOrder(...e))},[(0,o.Lk)("span",le,(0,t.v_)(Ie.totalItems),1),a[24]||(a[24]=(0,o.Lk)("span",null,"Ver Pedido",-1))])):(0,o.Q3)("",!0),Ie.hasPaymentInfo?((0,o.uX)(),(0,o.CE)("div",ce,[a[31]||(a[31]=(0,o.Lk)("h2",null,"Forma de Pago",-1)),(0,o.Lk)("div",ue,[Ie.menuData?.businessInfo?.paymentInfo?.qrImage?((0,o.uX)(),(0,o.CE)("div",de,[(0,o.Lk)("h3",null,(0,t.v_)(Ie.menuData?.businessInfo?.paymentInfo?.qrTitle||"C√≥digo QR de Pago"),1),Ie.menuData?.businessInfo?.paymentInfo?.qrImage&&Ie.isValidImage(Ie.menuData?.businessInfo?.paymentInfo?.qrImage)?((0,o.uX)(),(0,o.CE)("img",{key:0,src:Ie.fixImageFormat(Ie.menuData?.businessInfo?.paymentInfo?.qrImage),alt:"QR de Pago",class:"payment-image"},null,8,me)):(0,o.Q3)("",!0)])):(0,o.Q3)("",!0),Ie.menuData?.businessInfo?.paymentInfo?.nequiNumber||Ie.menuData?.businessInfo?.paymentInfo?.nequiImage?((0,o.uX)(),(0,o.CE)("div",pe,[a[26]||(a[26]=(0,o.Lk)("h3",null,"Pago con Nequi",-1)),Ie.menuData?.businessInfo?.paymentInfo?.nequiImage&&Ie.isValidImage(Ie.menuData?.businessInfo?.paymentInfo?.nequiImage)?((0,o.uX)(),(0,o.CE)("img",{key:0,src:Ie.fixImageFormat(Ie.menuData?.businessInfo?.paymentInfo?.nequiImage),alt:"Nequi",class:"payment-image"},null,8,ve)):(0,o.Q3)("",!0),Ie.menuData?.businessInfo?.paymentInfo?.nequiNumber?((0,o.uX)(),(0,o.CE)("p",fe,[a[25]||(a[25]=(0,o.Lk)("strong",null,"N√∫mero:",-1)),(0,o.eW)(" "+(0,t.v_)(Ie.menuData?.businessInfo?.paymentInfo?.nequiNumber),1)])):(0,o.Q3)("",!0)])):(0,o.Q3)("",!0),Ie.menuData?.businessInfo?.paymentInfo?.bankInfo?((0,o.uX)(),(0,o.CE)("div",ge,[a[28]||(a[28]=(0,o.Lk)("h3",null,"Pago Bancario",-1)),(0,o.Lk)("p",be,[a[27]||(a[27]=(0,o.Lk)("strong",null,"Informaci√≥n Bancaria:",-1)),(0,o.eW)(" "+(0,t.v_)(Ie.menuData?.businessInfo?.paymentInfo?.bankInfo),1)])])):(0,o.Q3)("",!0),Ie.menuData?.businessInfo?.paymentInfo?.otherPaymentMethods?((0,o.uX)(),(0,o.CE)("div",ye,[a[30]||(a[30]=(0,o.Lk)("h3",null,"Otras Formas de Pago",-1)),(0,o.Lk)("p",he,[a[29]||(a[29]=(0,o.Lk)("strong",null,"M√©todos Adicionales:",-1)),(0,o.eW)(" "+(0,t.v_)(Ie.menuData?.businessInfo?.paymentInfo?.otherPaymentMethods),1)])])):(0,o.Q3)("",!0)])])):(0,o.Q3)("",!0),(0,o.Lk)("div",ke,[a[32]||(a[32]=(0,o.Lk)("h3",{class:"text-center mb-4"},"¬øQuieres hacer una reserva?",-1)),(0,o.bF)(Ce)]),Ie.toast.visible?((0,o.uX)(),(0,o.CE)("div",{key:3,class:(0,t.C4)(["toast-notification",Ie.toast.type])},(0,t.v_)(Ie.toast.message),3)):(0,o.Q3)("",!0)])]))],8,s)}n(4114),n(8111),n(2489),n(116),n(7588),n(1701),n(8237);var Le=n(953),Ee=n(5220),Ce=n(5226),we=n(6429),De=n(8982);const Pe={class:"reservas-section"},$e={key:0,class:"reserva-form-container"},Ne={class:"form-group"},qe={class:"form-group"},Re={class:"form-group"},Se={class:"form-group"},Ae={class:"form-group"},Qe={class:"form-group"},Xe={class:"form-group"},_e={class:"form-group"},xe={class:"form-group"},Te={class:"form-actions"},Fe=["disabled"],Ve=["disabled"];function Me(e,a,n,s,i,l){return(0,o.uX)(),(0,o.CE)("div",Pe,[(0,o.Lk)("button",{onClick:a[0]||(a[0]=(...e)=>s.toggleReservaForm&&s.toggleReservaForm(...e)),class:"toggle-reserva-button"},(0,t.v_)(s.showReservaForm?"Ocultar Formulario de Reserva":"Hacer una Reserva"),1),s.showReservaForm?((0,o.uX)(),(0,o.CE)("div",$e,[a[21]||(a[21]=(0,o.Lk)("h3",null,"Reserva tu Mesa",-1)),(0,o.Lk)("form",{onSubmit:a[11]||(a[11]=(0,r.D$)(((...e)=>s.processReservation&&s.processReservation(...e)),["prevent"])),class:"reserva-form"},[(0,o.Lk)("div",Ne,[a[12]||(a[12]=(0,o.Lk)("label",{for:"fullName"},"Nombre Completo *",-1)),(0,o.bo)((0,o.Lk)("input",{type:"text",id:"fullName","onUpdate:modelValue":a[1]||(a[1]=e=>s.reservationData.fullName=e),placeholder:"Ingresa tu nombre completo",required:""},null,512),[[r.Jo,s.reservationData.fullName]])]),(0,o.Lk)("div",qe,[a[13]||(a[13]=(0,o.Lk)("label",{for:"mobilePhone"},"Tel√©fono M√≥vil *",-1)),(0,o.bo)((0,o.Lk)("input",{type:"tel",id:"mobilePhone","onUpdate:modelValue":a[2]||(a[2]=e=>s.reservationData.mobilePhone=e),placeholder:"Ej. 612345678",required:""},null,512),[[r.Jo,s.reservationData.mobilePhone]])]),(0,o.Lk)("div",Re,[a[14]||(a[14]=(0,o.Lk)("label",{for:"landlinePhone"},"Tel√©fono Fijo",-1)),(0,o.bo)((0,o.Lk)("input",{type:"tel",id:"landlinePhone","onUpdate:modelValue":a[3]||(a[3]=e=>s.reservationData.landlinePhone=e),placeholder:"Opcional"},null,512),[[r.Jo,s.reservationData.landlinePhone]])]),(0,o.Lk)("div",Se,[a[15]||(a[15]=(0,o.Lk)("label",{for:"address"},"Direcci√≥n",-1)),(0,o.bo)((0,o.Lk)("input",{type:"text",id:"address","onUpdate:modelValue":a[4]||(a[4]=e=>s.reservationData.address=e),placeholder:"Tu direcci√≥n (opcional)"},null,512),[[r.Jo,s.reservationData.address]])]),(0,o.Lk)("div",Ae,[a[16]||(a[16]=(0,o.Lk)("label",{for:"email"},"Correo Electr√≥nico",-1)),(0,o.bo)((0,o.Lk)("input",{type:"email",id:"email","onUpdate:modelValue":a[5]||(a[5]=e=>s.reservationData.email=e),placeholder:"ejemplo@correo.com (opcional)"},null,512),[[r.Jo,s.reservationData.email]])]),(0,o.Lk)("div",Qe,[a[17]||(a[17]=(0,o.Lk)("label",{for:"reservationDate"},"Fecha de Reserva *",-1)),(0,o.bo)((0,o.Lk)("input",{type:"date",id:"reservationDate","onUpdate:modelValue":a[6]||(a[6]=e=>s.reservationData.date=e),required:""},null,512),[[r.Jo,s.reservationData.date]])]),(0,o.Lk)("div",Xe,[a[18]||(a[18]=(0,o.Lk)("label",{for:"reservationTime"},"Hora de Reserva *",-1)),(0,o.bo)((0,o.Lk)("input",{type:"time",id:"reservationTime","onUpdate:modelValue":a[7]||(a[7]=e=>s.reservationData.time=e),required:""},null,512),[[r.Jo,s.reservationData.time]])]),(0,o.Lk)("div",_e,[a[19]||(a[19]=(0,o.Lk)("label",{for:"peopleCount"},"N√∫mero de Personas *",-1)),(0,o.bo)((0,o.Lk)("input",{type:"number",id:"peopleCount","onUpdate:modelValue":a[8]||(a[8]=e=>s.reservationData.peopleCount=e),min:"1",max:"20",required:""},null,512),[[r.Jo,s.reservationData.peopleCount]])]),(0,o.Lk)("div",xe,[a[20]||(a[20]=(0,o.Lk)("label",{for:"specialNotes"},"Notas Adicionales",-1)),(0,o.bo)((0,o.Lk)("textarea",{id:"specialNotes","onUpdate:modelValue":a[9]||(a[9]=e=>s.reservationData.notes=e),placeholder:"Instrucciones especiales, preferencias, etc.",rows:"3"},null,512),[[r.Jo,s.reservationData.notes]])]),(0,o.Lk)("div",Te,[(0,o.Lk)("button",{type:"submit",class:"submit-button",disabled:s.isProcessing},(0,t.v_)(s.isProcessing?"Procesando...":"Reservar Mesa"),9,Fe),(0,o.Lk)("button",{type:"button",class:"clear-button",onClick:a[10]||(a[10]=(...e)=>s.clearForm&&s.clearForm(...e)),disabled:s.isProcessing}," Limpiar ",8,Ve)])],32)])):(0,o.Q3)("",!0),s.toast.show?((0,o.uX)(),(0,o.CE)("div",{key:1,class:(0,t.C4)(["toast-notification",s.toast.type])},(0,t.v_)(s.toast.message),3)):(0,o.Q3)("",!0)])}var ze=n(7051),Je={name:"ReservaForm",setup(){console.log("ReservaForm montado");const e=(0,Le.KR)(!1),a=(0,Le.Kh)({fullName:"",mobilePhone:"",landlinePhone:"",address:"",email:"",date:"",time:"",peopleCount:1,notes:""}),n=(0,Le.KR)(!1),o=(0,Le.Kh)({show:!1,message:"",type:"info"}),t=()=>{e.value=!e.value},r=(e,a="info")=>{o.message=e,o.type=a,o.show=!0,setTimeout((()=>{o.show=!1}),5e3)},s=()=>a.fullName.trim()?a.mobilePhone.trim()?a.date?a.time?!(!a.peopleCount||a.peopleCount<1)||(r("Por favor, indica el n√∫mero de personas","error"),!1):(r("Por favor, selecciona una hora para la reserva","error"),!1):(r("Por favor, selecciona una fecha para la reserva","error"),!1):(r("Por favor, ingresa un n√∫mero de tel√©fono m√≥vil","error"),!1):(r("Por favor, ingresa tu nombre completo","error"),!1),i=async()=>{if(s())try{n.value=!0;const e={fullName:a.fullName,mobilePhone:a.mobilePhone,landlinePhone:a.landlinePhone||"",email:a.email||"",address:a.address||"",date:a.date,time:a.time,peopleCount:a.peopleCount,notes:a.notes||"",status:"pending",source:"menu"};console.log("Enviando reserva al sistema:",e);const o={nombre:a.fullName,telefono:a.mobilePhone,email:a.email||"",fecha:a.date,hora:a.time,personas:a.peopleCount,notas:`Reserva desde men√∫ compartido: ${a.notes||"Sin notas adicionales"}`};console.log("Enviando reserva como mensaje de WhatsApp:",o);const t=await(0,we.sb)(o);if(console.log("Resultado de env√≠o como WhatsApp:",t),!t.success)throw new Error(t.error||"Error al guardar la reserva");const s=`\nüìÖ *NUEVA RESERVA DE MESA*\n---------------------------\nüë§ *Nombre:* ${a.fullName}\nüì± *Tel√©fono m√≥vil:* ${a.mobilePhone}\n${a.landlinePhone?`‚òéÔ∏è *Tel√©fono fijo:* ${a.landlinePhone}`:""}\n${a.email?`‚úâÔ∏è *Email:* ${a.email}`:""}\nüìÜ *Fecha:* ${a.date}\n‚è∞ *Hora:* ${a.time}\nüë• *Personas:* ${a.peopleCount}\n${a.notes?`üìù *Notas:* ${a.notes}`:""}\n---------------------------\nüåê Esta reserva fue realizada a trav√©s del sistema de reservas online.\n`,i=encodeURIComponent(s),c=`https://api.whatsapp.com/send?text=${i}`;window.open(c,"_blank"),r("¬°Reserva enviada correctamente! Tambi√©n puedes confirmarla por WhatsApp.","success"),l()}catch(e){console.error("Error al procesar la reserva:",e),r("Hubo un error al procesar tu reserva. Por favor, intenta nuevamente.","error")}finally{n.value=!1}},l=()=>{a.fullName="",a.mobilePhone="",a.landlinePhone="",a.address="",a.email="",a.date="",a.time="",a.peopleCount=1,a.notes=""};return{showReservaForm:e,reservationData:a,isProcessing:n,toast:o,toggleReservaForm:t,processReservation:i,clearForm:l}}},We=n(6262);const Ue=(0,We.A)(Je,[["render",Me],["__scopeId","data-v-732333be"]]);var Oe=Ue,Ke=n(2949),je={name:"SharedMenuView",components:{ReservaForm:Oe},props:{id:{type:String,default:""}},setup(e){const a=(0,Ee.lq)(),t=(0,o.EW)((()=>e.id||a.params.id)),r=(0,Le.KR)({items:[],businessInfo:{name:"Restaurante WebSAP",description:"Deliciosa comida para todos los gustos",contact:"info@websap.com",address:"Calle Principal #123",logo:null,paymentInfo:{qrImage:null,qrTitle:"Escanea para pagar",nequiNumber:null,nequiImage:null,bankInfo:"Banco XYZ - Cuenta 123456789",otherPaymentMethods:"Aceptamos efectivo y tarjetas"}}}),s=(0,Le.KR)(!0),i=(0,Le.KR)(null),l=(0,Le.KR)([]),c=((0,Le.KR)(null),(0,Le.KR)(!1)),u=(0,Le.KR)(null);console.log("SharedMenuView montado, ID del men√∫:",a.params.id);const d=(0,Le.KR)({visible:!1,message:"",type:"success",timeoutId:null});(0,o.sV)((()=>{p(),ze.A.on("business-info-updated",m),(0,Ke.D2)(!0)})),(0,o.hi)((()=>{ze.A.off("business-info-updated",m),(0,Ke.Vg)(),d.value.timeoutId&&clearTimeout(d.value.timeoutId)}));const m=e=>{console.log("Nueva informaci√≥n del negocio recibida en SharedMenuView:",e),e&&(r.value.businessInfo={...e},u.value=Date.now(),h("Informaci√≥n del negocio actualizada","info"))};async function p(){try{if(s.value=!0,i.value=null,console.log("Cargando men√∫ con ID:",a.params.id),!a.params.id)return i.value="ID de men√∫ no especificado",void(s.value=!1);const d=localStorage.getItem(`cart_${a.params.id}`);if(d)try{l.value=JSON.parse(d),console.log("Carrito recuperado de localStorage:",l.value)}catch(e){console.error("Error al parsear carrito de localStorage:",e)}try{const e=await(0,Ce.rJ)(a.params.id);if(!e||!e.items)throw new Error("Datos de men√∫ no v√°lidos");r.value.items=e.items;try{const e=await(0,Ke.xr)();e&&(r.value.businessInfo=e,u.value=Date.now(),console.log("Informaci√≥n del negocio cargada del backend:",e))}catch(n){console.warn("No se pudo cargar informaci√≥n del negocio desde backend:",n),e.businessInfo&&(r.value.businessInfo=e.businessInfo)}console.log("Men√∫ cargado con √©xito:",r.value),r.value.items.forEach((e=>{e.availableQuantity=void 0!==e.availableQuantity?Number(e.availableQuantity):0,e.realAvailability=e.availableQuantity})),q();try{localStorage.setItem(`menu_${a.params.id}`,JSON.stringify(r.value))}catch(o){console.warn("No se pudo guardar el men√∫ en localStorage:",o)}}catch(t){console.error("Error al cargar el men√∫ desde la API:",t);try{const e=localStorage.getItem(`menu_${a.params.id}`);if(!e)throw new Error("No se encontr√≥ el men√∫ en cach√©");if(r.value=JSON.parse(e),console.log("Men√∫ recuperado desde localStorage:",r.value),!r.value||!r.value.items)throw new Error("Datos de men√∫ en cach√© no v√°lidos");r.value.items.forEach((e=>{e.availableQuantity=void 0!==e.availableQuantity?Number(e.availableQuantity):0,e.realAvailability=e.availableQuantity})),q(),h("Usando datos almacenados localmente. Algunas funciones pueden estar limitadas.","warning")}catch(c){console.error("Error al recuperar men√∫ desde cach√©:",c),i.value="No se encontr√≥ el men√∫ solicitado. Por favor, verifica el enlace o intenta m√°s tarde."}}}catch(e){console.error("Error general al cargar el men√∫:",e),i.value=e.message||"Error al cargar el men√∫"}finally{s.value=!1}}const v=(0,o.EW)((()=>{const e=r.value?.businessInfo?.paymentInfo;return!!e&&!!(e.qrImage&&R(e.qrImage)||e.qrTitle||e.nequiNumber||e.nequiImage&&R(e.nequiImage)||e.bankInfo||e.otherPaymentMethods)})),f=(0,o.EW)((()=>l.value.reduce(((e,a)=>e+a.quantity),0))),g=(0,o.EW)((()=>l.value.reduce(((e,a)=>e+a.price*a.quantity),0)));function b(e){if(isNaN(Number(e)))return"0,00";const a=Number(e).toFixed(2),[n,o]=a.split("."),t=n.replace(/\B(?=(\d{3})+(?!\d))/g,".");return`${t},${o}`}async function y(e){if(Number(e.availableQuantity)<=0)return void h(`Lo sentimos, "${e.name}" no est√° disponible actualmente. Intente m√°s tarde por favor.`,"error");const a=await $(e);if(!a)return;const n=l.value.find((a=>e.id&&a.id?a.id===e.id:a.name===e.name));n?n.quantity++:l.value.push({id:e.id||Date.now().toString(),name:e.name,price:e.price,quantity:1,availableQuantity:e.availableQuantity||0}),k(),q(),h(`${e.name} a√±adido al carrito`,"success")}function h(e,a="success",n=5e3){console.log(`[Toast] Mostrando notificaci√≥n: ${e} (${a})`),d.value.timeoutId&&clearTimeout(d.value.timeoutId),d.value.message=e,d.value.type=a,d.value.visible=!0,console.log(`[Toast] Estado: visible=${d.value.visible}, message=${d.value.message}`),d.value.timeoutId=setTimeout((()=>{console.log(`[Toast] Ocultando notificaci√≥n despu√©s de ${n}ms`),d.value.visible=!1}),n)}function k(){try{localStorage.setItem(`cart_${a.params.id}`,JSON.stringify(l.value))}catch(e){console.error("Error al guardar carrito en localStorage:",e)}}function I(e){const a=l.value[e],n=r.value.items?.find((e=>e.id===a.id));if(n){const e=n.availableQuantity||0;if(a.quantity>=e)return void h(`No hay m√°s unidades disponibles de "${a.name}"`,"warning")}a.quantity++,k(),q()}function L(e){l.value[e].quantity>1?(l.value[e].quantity--,k(),q()):E(e)}function E(e){l.value.splice(e,1),k(),q()}async function C(){try{if(0===l.value.length)return void h("No hay √≠tems en el pedido","error");if(!A.value.name||!A.value.phone)return void h("Por favor complete su nombre y tel√©fono","error");c.value=!0,await N(),D(),h("¬°Pedido completado! Gracias por tu compra.","success"),setTimeout((()=>{l.value=[],localStorage.removeItem(`cart_${a.params.id}`),A.value={name:"",phone:"",email:"",address:""},X.value="",c.value=!1}),2e3)}catch(i){console.error("Error al completar el pedido:",i),h("Error al procesar el pedido","error"),c.value=!1}}function w(){0!==l.value.length?A.value.name&&A.value.phone?(D(),h("Pedido compartido por WhatsApp","success")):h("Por favor complete su nombre y tel√©fono","error"):h("No hay √≠tems en el pedido","error")}function D(){let e=`üõí *Pedido de ${A.value.name}*\n\n`;e+="üì¶ *Productos:*\n",l.value.forEach((a=>{const n=(a.price*a.quantity).toFixed(2);e+=`üçΩÔ∏è ${a.quantity}x ${a.name} = $${b(n)}\n`})),e+=`\nüíµ *Total:* $${b(g.value)}\n`,A.value.phone&&(e+=`üìû *Tel√©fono:* ${A.value.phone}\n`),A.value.email&&(e+=`‚úâÔ∏è *Email:* ${A.value.email}\n`),A.value.address&&(e+=`üìç *Direcci√≥n:* ${A.value.address}\n`),X.value&&(e+=`üìù *Notas adicionales:*\n${X.value}\n`);const a="qr"===Q.value?"C√≥digo QR":"nequi"===Q.value?"Nequi":"Contra entrega";e+=`\nüí≥ *Forma de pago:* ${a}`;const n=encodeURIComponent(e),o=`https://api.whatsapp.com/send?text=${n}`;window.open(o,"_blank")}function P(){const e=document.querySelector(".order-section");e&&e.scrollIntoView({behavior:"smooth"})}async function $(e){const a=Number(e.availableQuantity)||0;if(a<=0)return h(`Lo sentimos, "${e.name}" no est√° disponible actualmente. Intente m√°s tarde por favor.`,"error"),!1;const n=l.value.find((a=>a.id===e.id)),o=n?n.quantity:0,t=a-o;return t<=0?(h(`No hay m√°s unidades disponibles de "${e.name}"`,"warning"),!1):(t<=5&&h(`¬°Solo quedan ${t} unidades de "${e.name}"!`,"warning"),!0)}async function N(){try{if(!l.value||0===l.value.length)return void console.warn("Intentando actualizar inventario con carrito vac√≠o");console.log(`Iniciando actualizaci√≥n de inventario para ${l.value.length} productos...`);const t=await(0,De.gL)();if(!t||!Array.isArray(t))return console.error("No se pudo obtener el men√∫ actual"),!1;const r=JSON.parse(JSON.stringify(l.value)),s=[];let i=!1;const{getSoldItems:c,saveSoldItems:u}=await Promise.resolve().then(n.bind(n,8982));let d=[];try{d=await c()||[],Array.isArray(d)||(d=[]),console.log("Lista de elementos vendidos obtenida:",d.length)}catch(e){console.warn("Error al obtener elementos vendidos:",e),d=[]}for(let e=0;e<r.length;e++){const n=r[e];console.log(`Procesando item ${e+1}/${r.length}: ${n.name} (ID: ${n.id})`);try{const e=t.find((e=>e.id===n.id));if(!e){console.warn(`Elemento no encontrado en el men√∫: ${n.name} (ID: ${n.id})`),s.push({name:n.name,success:!1,error:"Elemento no encontrado en el men√∫"});continue}const a=parseInt(Number(e.availableQuantity||0),10),o=parseInt(Number(n.quantity||0),10);if(isNaN(a)||isNaN(o)){const a=`Cantidades inv√°lidas para ${n.name}: disponible=${e.availableQuantity}, vendido=${n.quantity}`;console.error(a),s.push({name:n.name,success:!1,error:a}),i=!0;continue}const r=Math.max(0,a-o);console.log(`Actualizando ${n.name}: ${a} - ${o} = ${r} (currentQuantity tipo: ${typeof a}, soldQuantity tipo: ${typeof o})`);const l=await(0,De.eq)(e.id,r);if(s.push({name:n.name,oldQuantity:a,soldQuantity:o,newQuantity:r,success:l,error:l?null:"Error al actualizar disponibilidad"}),l){const a=(new Date).toISOString(),t=d.find((e=>e.name===n.name));t?(t.quantity+=o,t.date=a):d.push({name:n.name,quantity:o,price:n.price,includesDrink:e.includesDrink||!1,date:a}),console.log(`Elemento registrado en lista de vendidos: ${n.name} x${o}`)}else i=!0}catch(a){console.error(`Error procesando ${n.name}:`,a),s.push({name:n.name,success:!1,error:a.message||"Error desconocido"}),i=!0}}try{await u(d),console.log(`Lista de elementos vendidos actualizada con ${d.length} elementos`)}catch(o){console.error("Error al guardar elementos vendidos:",o)}const m=s.filter((e=>e.success)).length;if(console.log(`Actualizaci√≥n de inventario completada. √âxitos: ${m}/${r.length}`),console.log("Detalles de actualizaci√≥n de inventario:",s),i){const e=s.filter((e=>!e.success)).map((e=>e.name)).join(", ");console.warn(`Algunos productos no se pudieron actualizar: ${e}`)}return m>0}catch(i){return console.error("Error general al actualizar inventario:",i),!1}}function q(){r.value?.items&&r.value.items.forEach((e=>{const a=l.value.find((a=>a.id===e.id)),n=a?a.quantity:0,o=Number(e.availableQuantity)||0;e.realAvailability=o-n,console.log(`Disponibilidad actualizada para ${e.name}: ${e.realAvailability} unidades (base: ${o}, carrito: ${n})`)}))}function R(e){return!!e&&(!(!e.startsWith("http://")&&!e.startsWith("https://"))||!!e.startsWith("data:image/"))}function S(e){return e?R(e)?e:e.includes("/9j/")&&!e.startsWith("data:image/")?`data:image/jpeg;base64,${e}`:"":""}const A=(0,Le.KR)({name:"",phone:"",email:"",address:""}),Q=(0,Le.KR)("cash"),X=(0,Le.KR)(""),_=(0,o.EW)((()=>{if(!r.value||!r.value.items)return[];const e=r.value.items.filter((e=>!e.isSpecial));return console.log("Platos regulares:",e.length,e.map((e=>e.name))),e})),x=(0,o.EW)((()=>{if(!r.value||!r.value.items)return[];const e=r.value.items.filter((e=>!0===e.isSpecial));return console.log("Platos especiales:",e.length,e.map((e=>e.name))),e})),T=(0,Le.KR)(!1),F=(0,Le.KR)(!1),V=(0,Le.KR)(!1),M=(0,Le.KR)(null),z=(0,Le.KR)({fullName:"",mobilePhone:"",landlinePhone:"",address:"",email:"",orderDate:J(),reservationDate:"",reservationTime:"",peopleCount:1,additionalNotes:""});function J(){const e=new Date,a=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${a}-${n}-${o}`}async function W(){F.value=!0,V.value=!1,M.value=null;try{const e=await(0,we.S1)(z.value);if(!e.success)throw new Error(e.error||"Error al procesar la reserva");V.value=!0,h("¬°Reserva enviada con √©xito! Recibir√° un correo de confirmaci√≥n en breve.","success"),console.log("Enviando correo de confirmaci√≥n a:",z.value.email),setTimeout((()=>{O(),T.value=!1}),3e3)}catch(i){console.error("Error al enviar la reserva:",i),M.value="Ocurri√≥ un error al procesar su reserva. Por favor, intente nuevamente.",h("Error al procesar la reserva. Por favor, intente nuevamente.","error")}finally{F.value=!1}}function U(){O(),T.value=!1}function O(){z.value.fullName="",z.value.mobilePhone="",z.value.landlinePhone="",z.value.address="",z.value.email="",z.value.orderDate=J(),z.value.reservationDate="",z.value.reservationTime="",z.value.peopleCount=1,z.value.additionalNotes="",V.value=!1,M.value=null}async function K(){try{const e=await(0,Ke.xr)(!0);e&&(r.value.businessInfo=e,u.value=Date.now(),h("Informaci√≥n del negocio actualizada","success"))}catch(i){console.error("Error al refrescar informaci√≥n del negocio:",i),h("Error al actualizar informaci√≥n del negocio","error")}}return{menuId:t,isLoading:s,error:i,menuData:r,regularItems:_,specialItems:x,cartItems:l,cartTotal:g,totalItems:f,customerInfo:A,selectedPaymentMethod:Q,additionalMessage:X,addToCart:y,removeFromCart:E,increaseQuantity:I,decreaseQuantity:L,formatPrice:b,completeOrder:C,shareOrderByWhatsApp:w,scrollToOrder:P,isValidImage:R,fixImageFormat:S,hasPaymentInfo:v,showReservationForm:T,reservationData:z,isProcessingReservation:F,reservationSuccess:V,reservationError:M,submitReservation:W,cancelReservation:U,getCurrentDate:J,toast:d,refreshBusinessInfo:K,lastBusinessInfoUpdate:u}}};const Be=(0,We.A)(je,[["render",Ie],["__scopeId","data-v-50a3da36"]]);var He=Be}}]);
//# sourceMappingURL=shared-menu.b191b309.js.map