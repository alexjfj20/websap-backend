"use strict";(self["webpackChunkwebsap"]=self["webpackChunkwebsap"]||[]).push([[563],{1874:function(e,a,s){s.d(a,{A:function(){return T}});var t=s(641),o=s(33),r=s(3751);const l={class:"backups-container"},n={class:"backups-actions"},i=["disabled"],c={key:0},d={key:1},u={key:0,class:"loading-container"},m={key:1,class:"empty-state"},v={key:2,class:"backups-grid"},p={class:"backup-info"},k={class:"backup-date"},g={class:"backup-size"},b={class:"backup-actions"},h=["onClick","disabled"],y={key:0},L={key:1},f=["onClick"],w=["onClick","disabled"],E={key:0},C={key:1},D={class:"modal-container"},S={class:"modal-header"},A={class:"modal-footer"};function I(e,a,s,I,U,R){return(0,t.uX)(),(0,t.CE)("div",l,[a[12]||(a[12]=(0,t.Lk)("h2",{class:"section-title"},"Gesti√≥n de Respaldos",-1)),(0,t.Lk)("div",n,[(0,t.Lk)("button",{onClick:a[0]||(a[0]=(...e)=>I.createNewBackup&&I.createNewBackup(...e)),class:"create-backup-btn",disabled:I.creating},[I.creating?((0,t.uX)(),(0,t.CE)("span",c,a[5]||(a[5]=[(0,t.Lk)("span",{class:"loading-spinner"},null,-1),(0,t.eW)(" Creando respaldo... ")]))):((0,t.uX)(),(0,t.CE)("span",d,a[6]||(a[6]=[(0,t.Lk)("span",{class:"action-icon"},"üíæ",-1),(0,t.eW)(" Crear respaldo ahora ")])))],8,i)]),I.loading?((0,t.uX)(),(0,t.CE)("div",u,a[7]||(a[7]=[(0,t.Lk)("div",{class:"spinner"},null,-1),(0,t.Lk)("p",null,"Cargando respaldos...",-1)]))):0===I.backups.length?((0,t.uX)(),(0,t.CE)("div",m,a[8]||(a[8]=[(0,t.Lk)("div",{class:"empty-icon"},"üìÇ",-1),(0,t.Lk)("p",null,"No hay respaldos disponibles",-1),(0,t.Lk)("p",{class:"empty-desc"},'Crea tu primer respaldo haciendo clic en el bot√≥n "Crear respaldo ahora"',-1)]))):((0,t.uX)(),(0,t.CE)("div",v,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(I.backups,(e=>((0,t.uX)(),(0,t.CE)("div",{key:e.id,class:"backup-card"},[a[9]||(a[9]=(0,t.Lk)("div",{class:"backup-icon"},"üíæ",-1)),(0,t.Lk)("div",p,[(0,t.Lk)("h3",null,(0,o.v_)(e.archivo),1),(0,t.Lk)("p",k,"Fecha: "+(0,o.v_)(I.formatDate(e.fecha)),1),(0,t.Lk)("p",g,"Tama√±o: "+(0,o.v_)(e.tamano),1)]),(0,t.Lk)("div",b,[(0,t.Lk)("button",{onClick:a=>I.restoreBackup(e),class:"restore-btn",disabled:I.restoring===e.id},[I.restoring===e.id?((0,t.uX)(),(0,t.CE)("span",y,"Restaurando...")):((0,t.uX)(),(0,t.CE)("span",L,"Restaurar"))],8,h),(0,t.Lk)("button",{onClick:a=>I.downloadBackup(e),class:"download-btn"},"Descargar",8,f),(0,t.Lk)("button",{onClick:a=>I.deleteBackup(e),class:"delete-btn",disabled:I.deleting===e.id},[I.deleting===e.id?((0,t.uX)(),(0,t.CE)("span",E,"Eliminando...")):((0,t.uX)(),(0,t.CE)("span",C,"Eliminar"))],8,w)])])))),128))])),I.showRestoreModal?((0,t.uX)(),(0,t.CE)("div",{key:3,class:"modal-overlay",onClick:a[4]||(a[4]=(0,r.D$)(((...e)=>I.cancelRestore&&I.cancelRestore(...e)),["self"]))},[(0,t.Lk)("div",D,[(0,t.Lk)("div",S,[a[10]||(a[10]=(0,t.Lk)("h3",null,"Confirmar restauraci√≥n",-1)),(0,t.Lk)("button",{onClick:a[1]||(a[1]=(...e)=>I.cancelRestore&&I.cancelRestore(...e)),class:"close-btn"},"√ó")]),a[11]||(a[11]=(0,t.Lk)("div",{class:"modal-body"},[(0,t.Lk)("p",{class:"warning-text"},[(0,t.Lk)("span",{class:"warning-icon"},"‚ö†Ô∏è"),(0,t.eW)(" Est√°s a punto de restaurar el sistema a partir del respaldo seleccionado. Esta acci√≥n sobrescribir√° los datos actuales. ")]),(0,t.Lk)("p",null,"¬øEst√°s seguro de que deseas continuar?")],-1)),(0,t.Lk)("div",A,[(0,t.Lk)("button",{onClick:a[2]||(a[2]=(...e)=>I.cancelRestore&&I.cancelRestore(...e)),class:"cancel-btn"},"Cancelar"),(0,t.Lk)("button",{onClick:a[3]||(a[3]=(...e)=>I.confirmRestore&&I.confirmRestore(...e)),class:"confirm-btn"},"Confirmar restauraci√≥n")])])])):(0,t.Q3)("",!0)])}s(8111),s(2489);var U=s(953);async function R(){return new Promise((e=>{setTimeout((()=>{e({success:!0,data:[{id:1,fecha:(new Date).toISOString(),archivo:"backup_"+F(new Date)+".zip",tamano:"2.5 MB"},{id:2,fecha:new Date(Date.now()-864e5).toISOString(),archivo:"backup_"+F(new Date(Date.now()-864e5))+".zip",tamano:"2.3 MB"},{id:3,fecha:new Date(Date.now()-6048e5).toISOString(),archivo:"backup_"+F(new Date(Date.now()-6048e5))+".zip",tamano:"2.1 MB"}]})}),1e3)}))}async function x(){return new Promise((e=>{setTimeout((()=>{const a=new Date;e({success:!0,data:{id:Date.now(),fecha:a.toISOString(),archivo:"backup_"+F(a)+".zip",tamano:"2.4 MB"},message:"Respaldo creado exitosamente"})}),2e3)}))}async function _(e){return new Promise((e=>{setTimeout((()=>{e({success:!0,message:"Respaldo eliminado exitosamente"})}),1e3)}))}function F(e){const a=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),t=String(e.getDate()).padStart(2,"0"),o=String(e.getHours()).padStart(2,"0"),r=String(e.getMinutes()).padStart(2,"0"),l=String(e.getSeconds()).padStart(2,"0");return`${a}${s}${t}_${o}${r}${l}`}var X=s(4887),M={name:"AdminBackups",setup(){const e=(0,U.KR)([]),a=(0,U.KR)(!0),s=(0,U.KR)(!1),o=(0,U.KR)(null),r=(0,U.KR)(null),l=(0,U.KR)(null),n=(0,U.KR)(!1);(0,t.sV)((async()=>{await i()}));const i=async()=>{try{a.value=!0;const s=await R();if(!s||!s.success)throw new Error("Error al cargar respaldos");e.value=s.data||[],e.value.sort(((e,a)=>new Date(a.fecha)-new Date(e.fecha)))}catch(s){console.error("Error al obtener respaldos:",s),await(0,X.xE)("Error al cargar los respaldos: "+(s.message||"Error desconocido"))}finally{a.value=!1}},c=e=>{if(!e)return"N/A";try{const a=new Date(e);return isNaN(a.getTime())?"Fecha inv√°lida":new Intl.DateTimeFormat("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(a)}catch(a){return"Fecha inv√°lida"}},d=async()=>{try{s.value=!0;const a=await x();if(!a||!a.success)throw new Error("Error al crear el respaldo");e.value.unshift(a.data),await(0,X.xE)("Respaldo creado correctamente")}catch(a){console.error("Error al crear respaldo:",a),await(0,X.xE)("Error al crear respaldo: "+(a.message||"Error desconocido"))}finally{s.value=!1}},u=e=>{l.value=e,n.value=!0},m=()=>{n.value=!1,l.value=null},v=async()=>{try{if(!l.value)return;n.value=!1,o.value=l.value.id;const e=await u(l.value.id);if(!e||!e.success)throw new Error("Error al restaurar el respaldo");await(0,X.xE)("Respaldo restaurado correctamente. Se recargar√° la p√°gina para aplicar los cambios."),window.location.reload()}catch(e){console.error("Error al restaurar respaldo:",e),await(0,X.xE)("Error al restaurar respaldo: "+(e.message||"Error desconocido"))}finally{o.value=null,l.value=null}},p=async e=>{try{const a=document.createElement("a");a.setAttribute("href","data:application/zip;charset=utf-8,"+encodeURIComponent("Contenido simulado de respaldo")),a.setAttribute("download",e.archivo),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),await(0,X.xE)("Respaldo descargado correctamente")}catch(a){console.error("Error al descargar respaldo:",a),await(0,X.xE)("Error al descargar respaldo: "+(a.message||"Error desconocido"))}},k=async a=>{try{const s=await(0,X.lJ)(`¬øEst√°s seguro de eliminar el respaldo "${a.archivo}"?`,{title:"Confirmar eliminaci√≥n",confirmText:"Eliminar",cancelText:"Cancelar"});if(s){r.value=a.id;const s=await _(a.id);if(!s||!s.success)throw new Error("Error al eliminar el respaldo");e.value=e.value.filter((e=>e.id!==a.id)),await(0,X.xE)("Respaldo eliminado correctamente")}}catch(s){console.error("Error al eliminar respaldo:",s),await(0,X.xE)("Error al eliminar respaldo: "+(s.message||"Error desconocido"))}finally{r.value=null}};return{backups:e,loading:a,creating:s,restoring:o,deleting:r,selectedBackup:l,showRestoreModal:n,formatDate:c,createNewBackup:d,restoreBackup:u,cancelRestore:m,confirmRestore:v,downloadBackup:p,deleteBackup:k}}},P=s(6262);const $=(0,P.A)(M,[["render",I],["__scopeId","data-v-1ca49867"]]);var T=$},2346:function(e,a,s){s.d(a,{A:function(){return G}});var t=s(641),o=s(3751),r=s(33);const l={class:"inventory-container"},n={class:"inventory-controls"},i={class:"search-container"},c={class:"filters"},d={class:"actions"},u={key:0,class:"loading-container"},m={key:1,class:"error-container"},v={class:"error-message"},p={key:2,class:"empty-state"},k={key:3,class:"inventory-table-container"},g={class:"inventory-table"},b={class:"actions-cell"},h=["onClick"],y=["onClick"],L={key:4,class:"modal-overlay"},f={class:"modal-container"},w={class:"modal-header"},E={class:"modal-body"},C={class:"form-group"},D={class:"form-group"},S={class:"modal-footer"},A=["disabled"],I={key:0},U={key:1},R={key:5,class:"modal-overlay"},x={class:"modal-container history-modal"},_={class:"modal-header"},F={class:"modal-body"},X={key:0,class:"empty-history"},M={key:1,class:"history-list"},P={class:"history-date"},$={class:"history-details"},T={class:"history-quantity"},K={class:"history-stock"},z={class:"history-reason"},N={class:"history-user"},Q={class:"modal-footer"};function V(e,a,s,V,j,B){return(0,t.uX)(),(0,t.CE)("div",l,[a[27]||(a[27]=(0,t.Lk)("h2",{class:"section-title"},"Gesti√≥n de Inventario",-1)),(0,t.Lk)("div",n,[(0,t.Lk)("div",i,[(0,t.bo)((0,t.Lk)("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>V.searchTerm=e),placeholder:"Buscar producto...",class:"search-input",onInput:a[1]||(a[1]=(...e)=>V.handleSearchInput&&V.handleSearchInput(...e))},null,544),[[o.Jo,V.searchTerm]])]),(0,t.Lk)("div",c,[(0,t.bo)((0,t.Lk)("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>V.stockFilter=e),onChange:a[3]||(a[3]=(...e)=>V.applyFilters&&V.applyFilters(...e)),class:"filter-select"},a[15]||(a[15]=[(0,t.Lk)("option",{value:"all"},"Todos los productos",-1),(0,t.Lk)("option",{value:"low"},"Stock bajo",-1),(0,t.Lk)("option",{value:"out"},"Sin stock",-1)]),544),[[o.u1,V.stockFilter]]),(0,t.bo)((0,t.Lk)("select",{"onUpdate:modelValue":a[4]||(a[4]=e=>V.categoryFilter=e),onChange:a[5]||(a[5]=(...e)=>V.applyFilters&&V.applyFilters(...e)),class:"filter-select"},a[16]||(a[16]=[(0,t.Lk)("option",{value:""},"Todas las categor√≠as",-1),(0,t.Lk)("option",{value:"con_refresco"},"Con refresco",-1),(0,t.Lk)("option",{value:"sin_refresco"},"Sin refresco",-1)]),544),[[o.u1,V.categoryFilter]])]),(0,t.Lk)("div",d,[(0,t.Lk)("button",{onClick:a[6]||(a[6]=(...e)=>V.refreshInventory&&V.refreshInventory(...e)),class:"refresh-btn"},a[17]||(a[17]=[(0,t.Lk)("span",{class:"btn-icon"},"üîÑ",-1),(0,t.eW)(" Actualizar ")]))])]),V.loading?((0,t.uX)(),(0,t.CE)("div",u,a[18]||(a[18]=[(0,t.Lk)("div",{class:"spinner"},null,-1),(0,t.Lk)("p",null,"Cargando inventario...",-1)]))):V.error?((0,t.uX)(),(0,t.CE)("div",m,[(0,t.Lk)("p",v,(0,r.v_)(V.error),1),(0,t.Lk)("button",{onClick:a[7]||(a[7]=(...e)=>V.loadInventory&&V.loadInventory(...e)),class:"retry-btn"},"Reintentar")])):0===V.filteredProducts.length?((0,t.uX)(),(0,t.CE)("div",p,a[19]||(a[19]=[(0,t.Lk)("div",{class:"empty-icon"},"üì¶",-1),(0,t.Lk)("p",null,"No se encontraron productos",-1),(0,t.Lk)("p",{class:"empty-desc"},"Intenta cambiar los filtros de b√∫squeda o agrega nuevos productos al inventario",-1)]))):((0,t.uX)(),(0,t.CE)("div",k,[(0,t.Lk)("table",g,[a[20]||(a[20]=(0,t.Lk)("thead",null,[(0,t.Lk)("tr",null,[(0,t.Lk)("th",null,"Nombre"),(0,t.Lk)("th",null,"Categor√≠a"),(0,t.Lk)("th",null,"Stock Actual"),(0,t.Lk)("th",null,"Estado"),(0,t.Lk)("th",null,"√öltima Actualizaci√≥n"),(0,t.Lk)("th",null,"Acciones")])],-1)),(0,t.Lk)("tbody",null,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(V.filteredProducts,(e=>((0,t.uX)(),(0,t.CE)("tr",{key:e.id,class:(0,r.C4)(V.getRowClass(e))},[(0,t.Lk)("td",null,(0,r.v_)(e.name),1),(0,t.Lk)("td",null,(0,r.v_)(e.includesDrink?"Con refresco":"Sin refresco"),1),(0,t.Lk)("td",null,(0,r.v_)(e.availableQuantity),1),(0,t.Lk)("td",null,[(0,t.Lk)("span",{class:(0,r.C4)(V.getStatusClass(e))},(0,r.v_)(V.getStatusText(e)),3)]),(0,t.Lk)("td",null,(0,r.v_)(V.formatDate(e.lastUpdated)),1),(0,t.Lk)("td",b,[(0,t.Lk)("button",{onClick:a=>V.openUpdateStockModal(e),class:"update-btn",title:"Actualizar stock"}," üìù ",8,h),(0,t.Lk)("button",{onClick:a=>V.openHistoryModal(e),class:"history-btn",title:"Ver historial"}," üìã ",8,y)])],2)))),128))])])])),V.showUpdateModal?((0,t.uX)(),(0,t.CE)("div",L,[(0,t.Lk)("div",f,[(0,t.Lk)("div",w,[a[21]||(a[21]=(0,t.Lk)("h3",null,"Actualizar Stock",-1)),(0,t.Lk)("button",{onClick:a[8]||(a[8]=(...e)=>V.closeUpdateModal&&V.closeUpdateModal(...e)),class:"close-btn"},"√ó")]),(0,t.Lk)("div",E,[(0,t.Lk)("p",null,[a[22]||(a[22]=(0,t.Lk)("strong",null,"Producto:",-1)),(0,t.eW)(" "+(0,r.v_)(V.selectedProduct?.name),1)]),(0,t.Lk)("p",null,[a[23]||(a[23]=(0,t.Lk)("strong",null,"Stock actual:",-1)),(0,t.eW)(" "+(0,r.v_)(V.selectedProduct?.availableQuantity||0),1)]),(0,t.Lk)("div",C,[a[24]||(a[24]=(0,t.Lk)("label",{for:"newStock"},"Nuevo stock:",-1)),(0,t.bo)((0,t.Lk)("input",{type:"number",id:"newStock","onUpdate:modelValue":a[9]||(a[9]=e=>V.updateStockForm.newQuantity=e),min:"0",class:"form-input"},null,512),[[o.Jo,V.updateStockForm.newQuantity]])]),(0,t.Lk)("div",D,[a[25]||(a[25]=(0,t.Lk)("label",{for:"reason"},"Motivo del ajuste:",-1)),(0,t.bo)((0,t.Lk)("textarea",{id:"reason","onUpdate:modelValue":a[10]||(a[10]=e=>V.updateStockForm.reason=e),class:"form-textarea",placeholder:"Explique el motivo del ajuste de inventario"},null,512),[[o.Jo,V.updateStockForm.reason]])])]),(0,t.Lk)("div",S,[(0,t.Lk)("button",{onClick:a[11]||(a[11]=(...e)=>V.closeUpdateModal&&V.closeUpdateModal(...e)),class:"cancel-btn"},"Cancelar"),(0,t.Lk)("button",{onClick:a[12]||(a[12]=(...e)=>V.updateStock&&V.updateStock(...e)),class:"save-btn",disabled:V.updateStockForm.isUpdating},[V.updateStockForm.isUpdating?((0,t.uX)(),(0,t.CE)("span",I,"Actualizando...")):((0,t.uX)(),(0,t.CE)("span",U,"Guardar Cambios"))],8,A)])])])):(0,t.Q3)("",!0),V.showHistoryModal?((0,t.uX)(),(0,t.CE)("div",R,[(0,t.Lk)("div",x,[(0,t.Lk)("div",_,[(0,t.Lk)("h3",null,"Historial de "+(0,r.v_)(V.selectedProduct?.name),1),(0,t.Lk)("button",{onClick:a[13]||(a[13]=(...e)=>V.closeHistoryModal&&V.closeHistoryModal(...e)),class:"close-btn"},"√ó")]),(0,t.Lk)("div",F,[0===V.productHistory.length?((0,t.uX)(),(0,t.CE)("div",X,a[26]||(a[26]=[(0,t.Lk)("p",null,"No hay registros de movimientos para este producto.",-1)]))):((0,t.uX)(),(0,t.CE)("div",M,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(V.productHistory,((e,a)=>((0,t.uX)(),(0,t.CE)("div",{key:a,class:"history-item"},[(0,t.Lk)("div",P,(0,r.v_)(V.formatDate(e.date)),1),(0,t.Lk)("div",$,[(0,t.Lk)("span",{class:(0,r.C4)(["history-type",e.type])},(0,r.v_)("increase"===e.type?"Incremento":"decrease"===e.type?"Reducci√≥n":"Ajuste"),3),(0,t.Lk)("span",T,(0,r.v_)("increase"===e.type?"+":"")+(0,r.v_)(e.change),1),(0,t.Lk)("span",K," Stock resultante: "+(0,r.v_)(e.newQuantity),1)]),(0,t.Lk)("div",z,(0,r.v_)(e.reason||"Sin motivo especificado"),1),(0,t.Lk)("div",N," Por: "+(0,r.v_)(e.userName||"Sistema"),1)])))),128))]))]),(0,t.Lk)("div",Q,[(0,t.Lk)("button",{onClick:a[14]||(a[14]=(...e)=>V.closeHistoryModal&&V.closeHistoryModal(...e)),class:"cancel-btn"},"Cerrar")])])])):(0,t.Q3)("",!0)])}s(4114),s(8111),s(2489),s(1701);var j=s(953),B=s(3444),O=s(4887),H=s(981),J={name:"AdminInventory",setup(){const e=(0,j.KR)([]),a=(0,j.KR)(!0),s=(0,j.KR)(null),o=(0,j.KR)(""),r=(0,j.KR)("all"),l=(0,j.KR)(""),n=(0,j.KR)(!1),i=(0,j.KR)(!1),c=(0,j.KR)(null),d=(0,j.KR)([]),u=(0,j.KR)({newQuantity:0,reason:"",isUpdating:!1});(0,t.sV)((()=>{m()}));const m=async()=>{try{a.value=!0,s.value=null;const t=await(0,B.gL)();if(!t.success)throw new Error(t.message||"Error al cargar el inventario");e.value=t.data.map((e=>({...e,availableQuantity:e.availableQuantity||0,lastUpdated:e.lastUpdated||(new Date).toISOString(),stockHistory:e.stockHistory||[]}))),console.log("Inventario cargado:",e.value)}catch(t){console.error("Error al cargar inventario:",t),s.value=`Error al cargar inventario: ${t.message||"Error desconocido"}`}finally{a.value=!1}},v=()=>{m()},p=()=>{},k=()=>{},g=(0,t.EW)((()=>{let a=[...e.value];if(o.value){const e=o.value.toLowerCase();a=a.filter((a=>a.name?.toLowerCase().includes(e)))}return"all"!==r.value&&("low"===r.value?a=a.filter((e=>e.availableQuantity>0&&e.availableQuantity<=5)):"out"===r.value&&(a=a.filter((e=>0===e.availableQuantity)))),l.value&&("con_refresco"===l.value?a=a.filter((e=>e.includesDrink)):"sin_refresco"===l.value&&(a=a.filter((e=>!e.includesDrink)))),a})),b=e=>0===e.availableQuantity?"out-of-stock-row":e.availableQuantity<=5?"low-stock-row":"",h=e=>0===e.availableQuantity?"status-badge out-of-stock":e.availableQuantity<=5?"status-badge low-stock":"status-badge in-stock",y=e=>0===e.availableQuantity?"Sin stock":e.availableQuantity<=5?"Stock bajo":"Disponible",L=e=>{if(!e)return"N/A";try{const a=new Date(e);return new Intl.DateTimeFormat("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(a)}catch(a){return console.error("Error al formatear fecha:",a),"Fecha inv√°lida"}},f=e=>{c.value={...e},u.value={newQuantity:e.availableQuantity,reason:"",isUpdating:!1},n.value=!0},w=()=>{n.value=!1,c.value=null},E=async()=>{if(c.value)if(isNaN(u.value.newQuantity)||u.value.newQuantity<0)await(0,O.xE)("Por favor ingrese una cantidad v√°lida (mayor o igual a 0)");else if(u.value.reason.trim())try{u.value.isUpdating=!0;const a=c.value.availableQuantity,s=parseInt(u.value.newQuantity),t=s-a,o=t>0?"increase":t<0?"decrease":"adjustment",r=(0,H.HW)(),l={date:(new Date).toISOString(),type:o,change:Math.abs(t),previousQuantity:a,newQuantity:s,reason:u.value.reason,userId:r?.id,userName:r?.nombre||"Usuario"};await(0,B.NT)(c.value.id,s,l);const n=e.value.findIndex((e=>e.id===c.value.id));-1!==n&&(e.value[n].availableQuantity=s,e.value[n].lastUpdated=(new Date).toISOString(),e.value[n].stockHistory||(e.value[n].stockHistory=[]),e.value[n].stockHistory.push(l)),await(0,O.xE)("Stock actualizado correctamente",{title:"Actualizaci√≥n Exitosa"}),w()}catch(a){console.error("Error al actualizar stock:",a),await(0,O.xE)(`Error al actualizar stock: ${a.message||"Error desconocido"}`)}finally{u.value.isUpdating=!1}else await(0,O.xE)("Por favor ingrese un motivo para el ajuste de inventario")},C=e=>{c.value={...e},d.value=e.stockHistory||[],i.value=!0},D=()=>{i.value=!1,c.value=null,d.value=[]};return{products:e,loading:a,error:s,searchTerm:o,stockFilter:r,categoryFilter:l,filteredProducts:g,showUpdateModal:n,showHistoryModal:i,selectedProduct:c,productHistory:d,updateStockForm:u,loadInventory:m,refreshInventory:v,handleSearchInput:p,applyFilters:k,getRowClass:b,getStatusClass:h,getStatusText:y,formatDate:L,openUpdateStockModal:f,closeUpdateModal:w,updateStock:E,openHistoryModal:C,closeHistoryModal:D}}},W=s(6262);const q=(0,W.A)(J,[["render",V],["__scopeId","data-v-55f4fd9a"]]);var G=q},3444:function(e,a,s){s.d(a,{NT:function(){return i},Um:function(){return n},ao:function(){return l},gL:function(){return r}});s(4114),s(8111),s(2489),s(116),s(1701);var t=s(8982),o=s(133);async function r(){try{0;try{const e=await o["default"].get("/admin/menu-items");return e}catch(e){console.warn("Error al conectar con la API remota, utilizando datos locales como fallback:",e);const a=await t.gL();return{success:!0,data:a,fromLocalStorage:!0}}}catch(a){return console.error("Error al obtener elementos del men√∫:",a),{success:!1,error:a.message||"Error al obtener elementos del men√∫"}}}async function l(){return new Promise((e=>{setTimeout((()=>{e({success:!0,data:[{id:1,timestamp:(new Date).toISOString(),type:"info",user:"Admin",message:"Inicio de sesi√≥n exitoso",details:{ip:"192.168.1.1",userAgent:"Chrome/96.0"}},{id:2,timestamp:new Date(Date.now()-36e5).toISOString(),type:"warning",user:"Sistema",message:"Intento de acceso fallido",details:{ip:"203.0.113.1",userAgent:"Edge/96.0",attempts:3}},{id:3,timestamp:new Date(Date.now()-72e5).toISOString(),type:"error",user:"Sistema",message:"Error en la creaci√≥n de backup",details:{error:"Espacio insuficiente",code:"E0023"}},{id:4,timestamp:new Date(Date.now()-864e5).toISOString(),type:"success",user:"Juan P√©rez",message:"Nuevo usuario creado",details:{newUser:"carlos@ejemplo.com"}}]})}),500)}))}async function n(){try{const e=await l();if(!e.success||!Array.isArray(e.data))throw new Error("No se pudieron obtener los logs para descargar");const a=e.data,s=["ID","Fecha","Tipo","Usuario","Mensaje","Detalles"],t=a.map((e=>[e.id||"",e.timestamp||"",e.type||"",e.user||"Sistema",e.message||"",e.details?JSON.stringify(e.details):""])),o=[s.join(","),...t.map((e=>e.map((e=>`"${String(e).replace(/"/g,'""')}"`)).join(",")))].join("\n");return{success:!0,data:o,message:"Logs descargados correctamente"}}catch(e){return console.error("Error al descargar logs en CSV:",e),{success:!1,message:e.message||"Error al descargar logs"}}}async function i(e,a){try{const s=await o["default"].put(`/admin/menu-items/${e}/stock`,{stock:a});if(s&&s.success)return{success:!0,message:"Stock actualizado correctamente",data:s.data};throw new Error(s?.message||"Error al actualizar stock")}catch(s){return console.error("Error al actualizar stock:",s),{success:!1,message:s.message||"Error al actualizar stock"}}}},4592:function(e,a,s){s.d(a,{A:function(){return H}});var t=s(641),o=s(33);const r={class:"admin-dashboard"},l={key:0,class:"loading-panel"},n={key:1,class:"error-panel"},i={class:"error-message"},c={key:2,class:"dashboard-content"},d={class:"stats-cards"},u={class:"stat-card"},m={class:"stat-value"},v={class:"stat-card"},p={class:"stat-value"},k={class:"stat-card"},g={class:"stat-value"},b={class:"stat-card"},h={class:"stat-value"},y={class:"chart-panel"},L={class:"chart-container"},f={class:"chart"},w={class:"chart-tooltip"},E={class:"chart-labels"},C={class:"lower-panels"},D={class:"panel"},S={class:"restaurant-list"},A={class:"restaurant-rank"},I={class:"restaurant-info"},U={class:"restaurant-name"},R={class:"restaurant-orders"},x={class:"panel"},_={class:"user-list"},F={class:"user-avatar"},X={class:"user-info"},M={class:"user-name"},P={class:"user-role"},$={class:"user-access"},T={class:"access-date"},K={class:"dashboard-footer"},z={class:"data-updated"},N={key:3,class:"no-data"};function Q(e,a,s,Q,V,j){return(0,t.uX)(),(0,t.CE)("div",r,[a[15]||(a[15]=(0,t.Lk)("h2",null,"Panel de Control",-1)),V.loading?((0,t.uX)(),(0,t.CE)("div",l,a[2]||(a[2]=[(0,t.Lk)("div",{class:"spinner"},null,-1),(0,t.Lk)("p",null,"Cargando estad√≠sticas del dashboard...",-1)]))):V.error?((0,t.uX)(),(0,t.CE)("div",n,[(0,t.Lk)("p",i,(0,o.v_)(V.error),1),(0,t.Lk)("button",{onClick:a[0]||(a[0]=(...a)=>e.cargarDatos&&e.cargarDatos(...a)),class:"btn btn-retry"},"Reintentar")])):V.dashboardData?((0,t.uX)(),(0,t.CE)("div",c,[(0,t.Lk)("div",d,[(0,t.Lk)("div",u,[a[3]||(a[3]=(0,t.Lk)("div",{class:"stat-icon"},"üë§",-1)),(0,t.Lk)("div",m,(0,o.v_)(V.dashboardData.estadisticas.totalUsuarios),1),a[4]||(a[4]=(0,t.Lk)("div",{class:"stat-label"},"Usuarios",-1))]),(0,t.Lk)("div",v,[a[5]||(a[5]=(0,t.Lk)("div",{class:"stat-icon"},"üçΩÔ∏è",-1)),(0,t.Lk)("div",p,(0,o.v_)(V.dashboardData.estadisticas.totalRestaurantes),1),a[6]||(a[6]=(0,t.Lk)("div",{class:"stat-label"},"Restaurantes",-1))]),(0,t.Lk)("div",k,[a[7]||(a[7]=(0,t.Lk)("div",{class:"stat-icon"},"üìù",-1)),(0,t.Lk)("div",g,(0,o.v_)(V.dashboardData.estadisticas.totalPedidos),1),a[8]||(a[8]=(0,t.Lk)("div",{class:"stat-label"},"Pedidos",-1))]),(0,t.Lk)("div",b,[a[9]||(a[9]=(0,t.Lk)("div",{class:"stat-icon"},"üí∞",-1)),(0,t.Lk)("div",h,(0,o.v_)(j.formatCurrency(V.dashboardData.estadisticas.totalVentas)),1),a[10]||(a[10]=(0,t.Lk)("div",{class:"stat-label"},"Ventas",-1))])]),(0,t.Lk)("div",y,[a[11]||(a[11]=(0,t.Lk)("h3",null,"Ventas Mensuales",-1)),(0,t.Lk)("div",L,[(0,t.Lk)("div",f,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(V.dashboardData.graficoVentas,((e,a)=>((0,t.uX)(),(0,t.CE)("div",{key:`venta-${a}`,class:"chart-bar",style:(0,o.Tr)({height:j.calcBarHeight(e.ventas)+"%"})},[(0,t.Lk)("span",w,(0,o.v_)(j.formatCurrency(e.ventas)),1)],4)))),128))]),(0,t.Lk)("div",E,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(V.dashboardData.graficoVentas,((e,a)=>((0,t.uX)(),(0,t.CE)("span",{key:`label-${a}`,class:"chart-label"},(0,o.v_)(e.mes),1)))),128))])])]),(0,t.Lk)("div",C,[(0,t.Lk)("div",D,[a[12]||(a[12]=(0,t.Lk)("h3",null,"Restaurantes Populares",-1)),(0,t.Lk)("div",S,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(V.dashboardData.restaurantesPopulares,((e,a)=>((0,t.uX)(),(0,t.CE)("div",{key:`rest-${a}`,class:"restaurant-item"},[(0,t.Lk)("div",A,(0,o.v_)(a+1),1),(0,t.Lk)("div",I,[(0,t.Lk)("div",U,(0,o.v_)(e.nombre),1),(0,t.Lk)("div",R,(0,o.v_)(e.pedidos)+" pedidos",1)])])))),128))])]),(0,t.Lk)("div",x,[a[13]||(a[13]=(0,t.Lk)("h3",null,"Usuarios Activos",-1)),(0,t.Lk)("div",_,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(V.dashboardData.usuariosActivos,((e,a)=>((0,t.uX)(),(0,t.CE)("div",{key:`user-${a}`,class:"user-item"},[(0,t.Lk)("div",F,(0,o.v_)(j.getInitials(e.nombre)),1),(0,t.Lk)("div",X,[(0,t.Lk)("div",M,(0,o.v_)(e.nombre),1),(0,t.Lk)("div",P,(0,o.v_)(e.rol),1)]),(0,t.Lk)("div",$,[(0,t.Lk)("span",T,(0,o.v_)(j.formatDate(e.ultimoAcceso)),1)])])))),128))])])]),(0,t.Lk)("div",K,[(0,t.Lk)("div",z," Datos actualizados: "+(0,o.v_)(e.fechaActualizacion),1)])])):((0,t.uX)(),(0,t.CE)("div",N,[a[14]||(a[14]=(0,t.Lk)("p",null,"No hay datos disponibles para mostrar.",-1)),(0,t.Lk)("button",{onClick:a[1]||(a[1]=(...a)=>e.cargarDatos&&e.cargarDatos(...a)),class:"btn btn-retry"},"Cargar datos")]))])}s(8111),s(1701);var V=s(9984),j={name:"AdminDashboard",data(){return{dashboardData:{estadisticas:{totalUsuarios:0,totalRestaurantes:0,totalPedidos:0,totalVentas:0},graficoVentas:[],restaurantesPopulares:[],usuariosActivos:[]},loading:!0,error:null}},async created(){await this.cargarDatosDashboard()},methods:{async cargarDatosDashboard(){try{console.log("Cargando estad√≠sticas del dashboard..."),this.loading=!0;const e=await(0,V.$J)();e&&e.success&&e.data?(this.dashboardData=e.data,console.log("Datos del dashboard cargados correctamente")):console.warn("Respuesta incorrecta del API de dashboard")}catch(e){console.error("Error al cargar datos del dashboard:",e)}finally{this.loading=!1}},formatCurrency(e){return new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(e)},formatDate(e){try{const a=new Date(e);return a.toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(a){return e}},getInitials(e){return e.split(" ").map((e=>e[0])).join("").toUpperCase().substring(0,2)},calcBarHeight(e){if(!this.dashboardData||!this.dashboardData.graficoVentas)return 0;const a=Math.max(...this.dashboardData.graficoVentas.map((e=>e.ventas)));return e/a*80}}},B=s(6262);const O=(0,B.A)(j,[["render",Q],["__scopeId","data-v-0d384ca6"]]);var H=O},5425:function(e,a,s){s.d(a,{A:function(){return q}});var t=s(641),o=s(3751),r=s(33);const l={class:"users-container"},n={class:"users-controls"},i={class:"search-container"},c={class:"filters"},d=["value"],u={class:"actions"},m={key:0,class:"loading-container"},v={key:1,class:"error-container"},p={class:"error-message"},k={key:2,class:"empty-state"},g={key:3,class:"users-table-container"},b={class:"users-table"},h={class:"roles-list"},y={class:"action-buttons"},L=["onClick"],f=["onClick"],w=["onClick"],E=["onClick"],C={class:"modal-container"},D={class:"modal-header"},S={class:"modal-body"},A={key:0,class:"alert alert-danger mb-3"},I={class:"form-group"},U={class:"form-group"},R=["disabled"],x={class:"form-group"},_={class:"form-group"},F={for:"password"},X=["required"],M={class:"form-group"},P={class:"roles-checkboxes"},$=["id","value"],T=["for"],K={key:0,class:"form-group"},z={class:"form-buttons"},N={type:"submit",class:"save-btn"};function Q(e,a,s,Q,V,j){return(0,t.uX)(),(0,t.CE)("div",l,[a[37]||(a[37]=(0,t.Lk)("h2",{class:"section-title"},"Gesti√≥n de Usuarios",-1)),(0,t.Lk)("div",n,[(0,t.Lk)("div",i,[(0,t.bo)((0,t.Lk)("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>Q.searchTerm=e),placeholder:"Buscar usuario...",class:"search-input",onInput:a[1]||(a[1]=(...e)=>Q.handleSearchInput&&Q.handleSearchInput(...e))},null,544),[[o.Jo,Q.searchTerm]])]),(0,t.Lk)("div",c,[(0,t.bo)((0,t.Lk)("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>Q.roleFilter=e),onChange:a[3]||(a[3]=(...e)=>Q.fetchUsers&&Q.fetchUsers(...e)),class:"filter-select"},[a[19]||(a[19]=(0,t.Lk)("option",{value:""},"Todos los roles",-1)),((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(Q.roles,(e=>((0,t.uX)(),(0,t.CE)("option",{key:e.id,value:e.nombre},(0,r.v_)(e.nombre),9,d)))),128))],544),[[o.u1,Q.roleFilter]]),(0,t.bo)((0,t.Lk)("select",{"onUpdate:modelValue":a[4]||(a[4]=e=>Q.statusFilter=e),onChange:a[5]||(a[5]=(...e)=>Q.fetchUsers&&Q.fetchUsers(...e)),class:"filter-select"},a[20]||(a[20]=[(0,t.Lk)("option",{value:""},"Todos los estados",-1),(0,t.Lk)("option",{value:"activo"},"Activos",-1),(0,t.Lk)("option",{value:"inactivo"},"Inactivos",-1)]),544),[[o.u1,Q.statusFilter]])]),(0,t.Lk)("div",u,[(0,t.Lk)("button",{onClick:a[6]||(a[6]=(...e)=>Q.showCreateForm&&Q.showCreateForm(...e)),class:"create-user-btn"},a[21]||(a[21]=[(0,t.Lk)("span",{class:"btn-icon"},"‚ûï",-1),(0,t.eW)(" Nuevo Usuario ")]))])]),Q.loading?((0,t.uX)(),(0,t.CE)("div",m,a[22]||(a[22]=[(0,t.Lk)("div",{class:"spinner"},null,-1),(0,t.Lk)("p",null,"Cargando usuarios...",-1)]))):Q.error?((0,t.uX)(),(0,t.CE)("div",v,[(0,t.Lk)("p",p,(0,r.v_)(Q.error),1),(0,t.Lk)("button",{onClick:a[7]||(a[7]=(...e)=>Q.fetchUsers&&Q.fetchUsers(...e)),class:"retry-btn"},"Reintentar")])):0===Q.users.length?((0,t.uX)(),(0,t.CE)("div",k,[a[23]||(a[23]=(0,t.Lk)("div",{class:"empty-icon"},"üë•",-1)),a[24]||(a[24]=(0,t.Lk)("p",{class:"empty-title"},"No se encontraron usuarios",-1)),a[25]||(a[25]=(0,t.Lk)("p",{class:"empty-description"},"No hay usuarios que coincidan con los criterios de b√∫squeda",-1)),(0,t.Lk)("button",{onClick:a[8]||(a[8]=(...e)=>Q.resetFilters&&Q.resetFilters(...e)),class:"reset-filters-btn"},"Limpiar filtros")])):((0,t.uX)(),(0,t.CE)("div",g,[(0,t.Lk)("table",b,[a[30]||(a[30]=(0,t.Lk)("thead",null,[(0,t.Lk)("tr",null,[(0,t.Lk)("th",null,"Nombre"),(0,t.Lk)("th",null,"Email"),(0,t.Lk)("th",null,"Tel√©fono"),(0,t.Lk)("th",null,"Rol"),(0,t.Lk)("th",null,"Estado"),(0,t.Lk)("th",null,"Fecha de registro"),(0,t.Lk)("th",null,"Acciones")])],-1)),(0,t.Lk)("tbody",null,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(Q.users,(e=>((0,t.uX)(),(0,t.CE)("tr",{key:e.id,class:(0,r.C4)({"inactive-user":"inactivo"===e.estado})},[(0,t.Lk)("td",null,(0,r.v_)(e.nombre),1),(0,t.Lk)("td",null,(0,r.v_)(e.email),1),(0,t.Lk)("td",null,(0,r.v_)(e.telefono||"-"),1),(0,t.Lk)("td",null,[(0,t.Lk)("div",h,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(e.roles,((e,a)=>((0,t.uX)(),(0,t.CE)("span",{key:a,class:(0,r.C4)(["role-badge",{"admin-role":"Administrador"===e,"superadmin-role":"Superadministrador"===e}])},(0,r.v_)(e),3)))),128))])]),(0,t.Lk)("td",null,[(0,t.Lk)("span",{class:(0,r.C4)(["status-badge","activo"===e.estado?"active-status":"inactive-status"])},(0,r.v_)("activo"===e.estado?"Activo":"Inactivo"),3)]),(0,t.Lk)("td",null,(0,r.v_)(Q.formatDate(e.fecha_creacion)),1),(0,t.Lk)("td",null,[(0,t.Lk)("div",y,[(0,t.Lk)("button",{onClick:a=>Q.editUser(e),class:"edit-btn",title:"Editar"},a[26]||(a[26]=[(0,t.Lk)("span",{class:"btn-icon"},"‚úèÔ∏è",-1)]),8,L),"activo"===e.estado?((0,t.uX)(),(0,t.CE)("button",{key:0,onClick:a=>Q.deactivateUser(e),class:"deactivate-btn",title:"Desactivar"},a[27]||(a[27]=[(0,t.Lk)("span",{class:"btn-icon"},"üî¥",-1)]),8,f)):((0,t.uX)(),(0,t.CE)("button",{key:1,onClick:a=>Q.activateUser(e),class:"activate-btn",title:"Activar"},a[28]||(a[28]=[(0,t.Lk)("span",{class:"btn-icon"},"üü¢",-1)]),8,w)),(0,t.Lk)("button",{onClick:a=>Q.deleteUser(e),class:"delete-btn",title:"Eliminar"},a[29]||(a[29]=[(0,t.Lk)("span",{class:"btn-icon"},"‚ùå",-1)]),8,E)])])],2)))),128))])])])),Q.showModal?((0,t.uX)(),(0,t.CE)("div",{key:4,class:"modal-overlay",onClick:a[18]||(a[18]=(0,o.D$)(((...e)=>Q.closeModal&&Q.closeModal(...e)),["self"]))},[(0,t.Lk)("div",C,[(0,t.Lk)("div",D,[(0,t.Lk)("h3",null,(0,r.v_)(Q.isEditing?"Editar Usuario":"Crear Nuevo Usuario"),1),(0,t.Lk)("button",{onClick:a[9]||(a[9]=(...e)=>Q.closeModal&&Q.closeModal(...e)),class:"close-btn"},"√ó")]),(0,t.Lk)("div",S,[Q.error?((0,t.uX)(),(0,t.CE)("div",A,(0,r.v_)(Q.error),1)):(0,t.Q3)("",!0),(0,t.Lk)("form",{onSubmit:a[17]||(a[17]=(0,o.D$)(((...e)=>Q.saveUser&&Q.saveUser(...e)),["prevent"])),class:"user-form"},[(0,t.Lk)("div",I,[a[31]||(a[31]=(0,t.Lk)("label",{for:"nombre"},"Nombre completo",-1)),(0,t.bo)((0,t.Lk)("input",{type:"text",id:"nombre","onUpdate:modelValue":a[10]||(a[10]=e=>Q.formData.nombre=e),required:"",placeholder:"Ej: Juan P√©rez"},null,512),[[o.Jo,Q.formData.nombre]])]),(0,t.Lk)("div",U,[a[32]||(a[32]=(0,t.Lk)("label",{for:"email"},"Correo electr√≥nico",-1)),(0,t.bo)((0,t.Lk)("input",{type:"email",id:"email","onUpdate:modelValue":a[11]||(a[11]=e=>Q.formData.email=e),required:"",placeholder:"ejemplo@correo.com",disabled:Q.isEditing},null,8,R),[[o.Jo,Q.formData.email]])]),(0,t.Lk)("div",x,[a[33]||(a[33]=(0,t.Lk)("label",{for:"telefono"},"Tel√©fono",-1)),(0,t.bo)((0,t.Lk)("input",{type:"tel",id:"telefono","onUpdate:modelValue":a[12]||(a[12]=e=>Q.formData.telefono=e),placeholder:"Ej: 3001234567"},null,512),[[o.Jo,Q.formData.telefono]])]),(0,t.Lk)("div",_,[(0,t.Lk)("label",F,"Contrase√±a "+(0,r.v_)(Q.isEditing?"(dejar en blanco para mantener actual)":""),1),(0,t.bo)((0,t.Lk)("input",{type:"password",id:"password","onUpdate:modelValue":a[13]||(a[13]=e=>Q.formData.password=e),required:!Q.isEditing,placeholder:"Contrase√±a segura",autocomplete:"new-password"},null,8,X),[[o.Jo,Q.formData.password]])]),(0,t.Lk)("div",M,[a[34]||(a[34]=(0,t.Lk)("label",null,"Roles",-1)),(0,t.Lk)("div",P,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(Q.availableRoles,(e=>((0,t.uX)(),(0,t.CE)("div",{key:e.id,class:"role-checkbox"},[(0,t.bo)((0,t.Lk)("input",{type:"checkbox",id:"role-"+e.id,value:e.nombre,"onUpdate:modelValue":a[14]||(a[14]=e=>Q.formData.roles=e)},null,8,$),[[o.lH,Q.formData.roles]]),(0,t.Lk)("label",{for:"role-"+e.id},(0,r.v_)(e.nombre),9,T)])))),128))])]),Q.isEditing?((0,t.uX)(),(0,t.CE)("div",K,[a[36]||(a[36]=(0,t.Lk)("label",{for:"estado"},"Estado",-1)),(0,t.bo)((0,t.Lk)("select",{id:"estado","onUpdate:modelValue":a[15]||(a[15]=e=>Q.formData.estado=e)},a[35]||(a[35]=[(0,t.Lk)("option",{value:"activo"},"Activo",-1),(0,t.Lk)("option",{value:"inactivo"},"Inactivo",-1)]),512),[[o.u1,Q.formData.estado]])])):(0,t.Q3)("",!0),(0,t.Lk)("div",z,[(0,t.Lk)("button",{type:"button",onClick:a[16]||(a[16]=(...e)=>Q.closeModal&&Q.closeModal(...e)),class:"cancel-btn"},"Cancelar"),(0,t.Lk)("button",N,(0,r.v_)(Q.isEditing?"Actualizar":"Crear"),1)])],32)])])])):(0,t.Q3)("",!0)])}s(8111),s(2489);var V=s(9984),j=s(953),B=s(981),O=s(4887),H={name:"AdminUsers",emits:["user-created"],setup(e,{emit:a}){const s=(0,j.KR)([]),o=(0,j.KR)([]),r=(0,j.KR)([]),l=(0,j.KR)(!0),n=(0,j.KR)(null),i=(0,j.KR)(""),c=(0,j.KR)(""),d=(0,j.KR)(""),u=(0,j.KR)(!1),m=(0,j.KR)(!1),v=(0,j.KR)({id:null,nombre:"",email:"",telefono:"",password:"",roles:[],estado:"activo"}),{getUsers:p,getRoles:k,createUser:g,updateUser:b,cambiarEstadoUsuario:h,deleteUser:y}=V.Ay;let L=null;const f=(0,t.EW)((()=>(0,B.hf)("Administrador")&&!(0,B.hf)("Superadministrador"))),w=(0,t.EW)((()=>(0,B.hf)("Superadministrador"))),E=(0,t.EW)((()=>f.value?r.value.filter((e=>"Empleado"===e.nombre)):r.value)),C=(0,t.EW)((()=>{const e=(0,B.HW)();return s.value.filter((a=>{if(e&&a.email===e.email)return!0;if("superadmin@example.com"===a.email&&!w.value)return!1;if(f.value&&a.roles&&Array.isArray(a.roles)&&a.roles.includes("Superadministrador"))return!1;if(c.value&&(!a.roles||!a.roles.includes(c.value)))return!1;if(d.value&&a.estado!==d.value)return!1;if(i.value&&i.value.length>=2){const e=i.value.toLowerCase(),s=a.nombre&&a.nombre.toLowerCase().includes(e),t=a.email&&a.email.toLowerCase().includes(e);return s||t}return!0}))}));(0,t.sV)((async()=>{try{console.log("AdminUsers componente montado - inicializando..."),s.value=[],o.value=[],await Promise.all([D(),S()]),console.log("Inicializaci√≥n completa, usuarios cargados:",o.value.length)}catch(e){console.error("Error durante la inicializaci√≥n:",e),n.value=`Error durante la inicializaci√≥n: ${e.message}`}}));const D=async()=>{try{l.value=!0,n.value="",s.value=[],o.value=[];try{console.log("Obteniendo usuarios con filtros:",{searchTerm:i.value,role:c.value,status:d.value});const e=await p({searchTerm:i.value,role:c.value,status:d.value});if(e&&e.success)return console.log(`Recibidos ${e.data.length} usuarios de la API`),s.value=e.data,void(o.value=C.value);throw console.warn("Respuesta no exitosa de la API o formato incorrecto:",e),new Error(e?.message||"Error al cargar usuarios")}catch(e){throw console.error("Error al llamar a la API:",e),e}}catch(a){console.error("Error general al cargar usuarios:",a),n.value=`Error al cargar usuarios: ${a.message||"Error desconocido"}`,s.value=[],o.value=[]}finally{l.value=!1}},S=async()=>{try{try{const e=await k();if(e&&e.success)return void(r.value=Array.isArray(e.data)?e.data:[]);throw console.warn("Respuesta no exitosa de la API de roles:",e),new Error(e?.message||"Error al cargar roles")}catch(e){console.error("Error al llamar a la API de roles:",e),r.value=[{id:1,nombre:"Superadministrador",descripcion:"Control total del sistema"},{id:2,nombre:"Administrador",descripcion:"Gesti√≥n de usuarios y configuraci√≥n"},{id:3,nombre:"Empleado",descripcion:"Operaciones b√°sicas"}],console.log("Usando roles b√°sicos para mantener la funcionalidad:",r.value.length)}}catch(a){console.error("Error general al cargar roles:",a),r.value=[{id:1,nombre:"Superadministrador"},{id:2,nombre:"Administrador"},{id:3,nombre:"Empleado"}]}},A=()=>{clearTimeout(L),L=setTimeout((()=>{(""===i.value||i.value.length>=2)&&D()}),300)},I=()=>{i.value="",c.value="",d.value="",D()},U=()=>{m.value=!1,v.value={id:null,nombre:"",email:"",telefono:"",password:"",roles:["Empleado"],estado:"activo"},u.value=!0},R=e=>{f.value&&e.roles&&Array.isArray(e.roles)&&e.roles.includes("Superadministrador")?(0,O.xE)("No tienes permisos para editar usuarios con rol de Superadministrador"):(m.value=!0,v.value={id:e.id,nombre:e.nombre,email:e.email,telefono:e.telefono||"",password:"",roles:[...e.roles],estado:e.estado},u.value=!0)},x=async()=>{try{if(l.value=!0,n.value="",!v.value.roles.length)return await(0,O.xE)("Debe seleccionar al menos un rol para el usuario"),void(l.value=!1);if(f.value&&(v.value.roles=v.value.roles.filter((e=>"Empleado"===e)),0===v.value.roles.length&&(v.value.roles=["Empleado"])),m.value){const e={nombre:v.value.nombre,telefono:v.value.telefono,roles:v.value.roles,estado:v.value.estado};v.value.password&&(e.password=v.value.password);const a=await b(v.value.id,e);if(!a||!a.success)throw new Error(a?.message||"Error al actualizar usuario");{await(0,O.xE)(a.message||"Usuario actualizado exitosamente");const t=s.value.findIndex((e=>e.id===v.value.id));-1!==t?(s.value[t]={...s.value[t],...e},o.value=C.value):await D()}}else{const t={nombre:v.value.nombre,email:v.value.email,password:v.value.password,telefono:v.value.telefono,roles:v.value.roles,fecha_creacion:(new Date).toISOString()};try{console.log("Llamando a createUser con:",t);const e=await g(t);if(!e||!e.success)throw new Error(e?.message||"Error al crear usuario");if(await(0,O.xE)(e.message||"Usuario creado exitosamente"),u.value=!1,e.data){const a={...e.data,fecha_creacion:e.data.fecha_creacion||(new Date).toISOString()};s.value=[a,...s.value],o.value=C.value}else await D();a("user-created")}catch(e){console.error("Error al crear usuario:",e),n.value=e.message||"Error al crear usuario"}}}catch(t){console.error("Error al guardar el usuario:",t),n.value=t.message||"Error al guardar el usuario"}finally{l.value=!1}},_=async e=>{if(f.value&&e.roles&&Array.isArray(e.roles)&&e.roles.includes("Superadministrador"))(0,O.xE)("No tienes permisos para modificar usuarios con rol de Superadministrador");else try{const a=await(0,O.lJ)(`¬øEst√°s seguro de que deseas activar el usuario ${e.nombre}?`,{title:"Confirmar activaci√≥n",confirmText:"Activar",cancelText:"Cancelar"});if(a){l.value=!0,console.log(`Activando usuario con ID: ${e.id}`);const a=await h(e.id,"activo");if(!a||!a.success)throw new Error(a?.message||"Error al activar usuario");{await(0,O.xE)(a.message||"Usuario activado exitosamente");const t=s.value.findIndex((a=>a.id===e.id));-1!==t&&(s.value[t].estado="activo",o.value=C.value)}}}catch(a){console.error("Error al activar usuario:",a),await(0,O.xE)(`Error al activar usuario: ${a.message||"Error desconocido"}`)}finally{l.value=!1}},F=async e=>{if(f.value&&e.roles&&Array.isArray(e.roles)&&e.roles.includes("Superadministrador"))(0,O.xE)("No tienes permisos para modificar usuarios con rol de Superadministrador");else try{const a=await(0,O.lJ)(`¬øEst√°s seguro de que deseas desactivar el usuario ${e.nombre}? No podr√° acceder al sistema mientras est√© inactivo.`,{title:"Confirmar desactivaci√≥n"});if(a){l.value=!0,console.log(`Desactivando usuario con ID: ${e.id}`);const a=await h(e.id,"inactivo");if(!a||!a.success)throw new Error(a?.message||"Error al desactivar usuario");{await(0,O.xE)(a.message||"Usuario desactivado exitosamente");const t=s.value.findIndex((a=>a.id===e.id));-1!==t&&(s.value[t].estado="inactivo",o.value=C.value)}}}catch(a){console.error("Error al desactivar usuario:",a),await(0,O.xE)(`Error al desactivar usuario: ${a.message||"Error desconocido"}`)}finally{l.value=!1}},X=async e=>{if(f.value&&e.roles&&Array.isArray(e.roles)&&e.roles.includes("Superadministrador"))(0,O.xE)("No tienes permisos para eliminar usuarios con rol de Superadministrador");else try{const a=await(0,O.lJ)(`¬øEst√°s seguro de que deseas eliminar permanentemente el usuario ${e.nombre}? Esta acci√≥n no se puede deshacer.`,{title:"Confirmar eliminaci√≥n",confirmText:"Eliminar",cancelText:"Cancelar"});if(a){l.value=!0,console.log(`Eliminando usuario con ID: ${e.id}`);const a=await y(e.id);if(!a||!a.success)throw new Error(a?.message||"Error al eliminar usuario");await(0,O.xE)(a.message||"Usuario eliminado exitosamente"),s.value=s.value.filter((a=>a.id!==e.id)),o.value=C.value}}catch(a){console.error("Error al eliminar usuario:",a),await(0,O.xE)(`Error al eliminar usuario: ${a.message||"Error desconocido"}`)}finally{l.value=!1}},M=()=>{u.value=!1},P=e=>{e||(e=(new Date).toISOString());try{const a=new Date(e);return isNaN(a.getTime())?"Fecha inv√°lida":new Intl.DateTimeFormat("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(a)}catch(a){return"Fecha inv√°lida"}};return{users:o,roles:r,loading:l,error:n,searchTerm:i,roleFilter:c,statusFilter:d,showModal:u,isEditing:m,formData:v,fetchUsers:D,handleSearchInput:A,resetFilters:I,showCreateForm:U,editUser:R,saveUser:x,activateUser:_,deactivateUser:F,deleteUser:X,closeModal:M,formatDate:P,availableRoles:E,isOnlyAdmin:f,filteredUsers:C}}},J=s(6262);const W=(0,J.A)(H,[["render",Q],["__scopeId","data-v-611eb710"]]);var q=W},7469:function(e,a,s){s.d(a,{A:function(){return V}});var t=s(641),o=s(3751),r=s(33);const l={class:"logs-container"},n={class:"logs-controls"},i={class:"search-box"},c={class:"filters"},d={class:"actions"},u={key:0,class:"loading-container"},m={key:1,class:"empty-state"},v={key:2,class:"logs-table-wrapper"},p={class:"logs-table"},k={class:"message-cell"},g=["onClick"],b={key:3,class:"pagination"},h=["disabled"],y={class:"page-numbers"},L=["onClick"],f=["disabled"],w={class:"modal-container"},E={class:"modal-header"},C={class:"modal-body"},D={class:"log-detail-item"},S={class:"detail-value"},A={class:"log-detail-item"},I={class:"detail-value"},U={class:"log-detail-item"},R={class:"detail-value"},x={class:"log-detail-item"},_={class:"detail-value"},F={class:"log-detail-item"},X={class:"detail-value detail-json"},M={class:"modal-footer"};function P(e,a,s,P,$,T){return(0,t.uX)(),(0,t.CE)("div",l,[a[28]||(a[28]=(0,t.Lk)("h2",{class:"section-title"},"Registros del Sistema",-1)),(0,t.Lk)("div",n,[(0,t.Lk)("div",i,[(0,t.bo)((0,t.Lk)("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>P.searchTerm=e),placeholder:"Buscar en registros...",class:"search-input",onInput:a[1]||(a[1]=(...e)=>P.debounceSearch&&P.debounceSearch(...e))},null,544),[[o.Jo,P.searchTerm]]),a[13]||(a[13]=(0,t.Lk)("button",{class:"search-btn"},"üîç",-1))]),(0,t.Lk)("div",c,[(0,t.bo)((0,t.Lk)("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>P.typeFilter=e),class:"filter-select",onChange:a[3]||(a[3]=(...e)=>P.applyFilters&&P.applyFilters(...e))},a[14]||(a[14]=[(0,t.Fv)('<option value="" data-v-4dbe11f6>Todos los tipos</option><option value="info" data-v-4dbe11f6>Informaci√≥n</option><option value="warning" data-v-4dbe11f6>Advertencia</option><option value="error" data-v-4dbe11f6>Error</option><option value="success" data-v-4dbe11f6>√âxito</option>',5)]),544),[[o.u1,P.typeFilter]]),(0,t.bo)((0,t.Lk)("select",{"onUpdate:modelValue":a[4]||(a[4]=e=>P.dateFilter=e),class:"filter-select",onChange:a[5]||(a[5]=(...e)=>P.applyFilters&&P.applyFilters(...e))},a[15]||(a[15]=[(0,t.Fv)('<option value="" data-v-4dbe11f6>Todas las fechas</option><option value="today" data-v-4dbe11f6>Hoy</option><option value="yesterday" data-v-4dbe11f6>Ayer</option><option value="week" data-v-4dbe11f6>Esta semana</option><option value="month" data-v-4dbe11f6>Este mes</option>',5)]),544),[[o.u1,P.dateFilter]])]),(0,t.Lk)("div",d,[(0,t.Lk)("button",{onClick:a[6]||(a[6]=(...e)=>P.refreshLogs&&P.refreshLogs(...e)),class:"refresh-btn"},a[16]||(a[16]=[(0,t.Lk)("span",{class:"btn-icon"},"üîÑ",-1),(0,t.eW)(" Actualizar ")])),(0,t.Lk)("button",{onClick:a[7]||(a[7]=(...e)=>P.downloadLogs&&P.downloadLogs(...e)),class:"download-btn"},a[17]||(a[17]=[(0,t.Lk)("span",{class:"btn-icon"},"‚¨áÔ∏è",-1),(0,t.eW)(" Descargar ")]))])]),P.loading?((0,t.uX)(),(0,t.CE)("div",u,a[18]||(a[18]=[(0,t.Lk)("div",{class:"spinner"},null,-1),(0,t.Lk)("p",null,"Cargando registros...",-1)]))):0===P.filteredLogs.length?((0,t.uX)(),(0,t.CE)("div",m,a[19]||(a[19]=[(0,t.Lk)("div",{class:"empty-icon"},"üìù",-1),(0,t.Lk)("p",null,"No se encontraron registros",-1)]))):((0,t.uX)(),(0,t.CE)("div",v,[(0,t.Lk)("table",p,[a[21]||(a[21]=(0,t.Lk)("thead",null,[(0,t.Lk)("tr",null,[(0,t.Lk)("th",{class:"timestamp-col"},"Fecha y Hora"),(0,t.Lk)("th",{class:"type-col"},"Tipo"),(0,t.Lk)("th",{class:"user-col"},"Usuario"),(0,t.Lk)("th",{class:"message-col"},"Mensaje"),(0,t.Lk)("th",{class:"actions-col"},"Acciones")])],-1)),(0,t.Lk)("tbody",null,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(P.filteredLogs,(e=>((0,t.uX)(),(0,t.CE)("tr",{key:e.id,class:(0,r.C4)("log-row "+e.type)},[(0,t.Lk)("td",null,(0,r.v_)(P.formatDate(e.timestamp)),1),(0,t.Lk)("td",null,[(0,t.Lk)("span",{class:(0,r.C4)(["log-type",e.type])},(0,r.v_)(P.getTypeLabel(e.type)),3)]),(0,t.Lk)("td",null,(0,r.v_)(e.user||"Sistema"),1),(0,t.Lk)("td",k,(0,r.v_)(e.message),1),(0,t.Lk)("td",null,[(0,t.Lk)("button",{onClick:a=>P.viewLogDetails(e),class:"detail-btn"},a[20]||(a[20]=[(0,t.Lk)("span",null,"üëÅÔ∏è",-1)]),8,g)])],2)))),128))])])])),P.filteredLogs.length>0?((0,t.uX)(),(0,t.CE)("div",b,[(0,t.Lk)("button",{onClick:a[8]||(a[8]=e=>P.changePage(P.currentPage-1)),disabled:1===P.currentPage,class:"pagination-btn"}," < Anterior ",8,h),(0,t.Lk)("div",y,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(P.displayedPages,(e=>((0,t.uX)(),(0,t.CE)("button",{key:e,onClick:a=>P.changePage(e),class:(0,r.C4)(["page-number",{active:P.currentPage===e}])},(0,r.v_)(e),11,L)))),128))]),(0,t.Lk)("button",{onClick:a[9]||(a[9]=e=>P.changePage(P.currentPage+1)),disabled:P.currentPage===P.totalPages,class:"pagination-btn"}," Siguiente > ",8,f)])):(0,t.Q3)("",!0),P.showModal?((0,t.uX)(),(0,t.CE)("div",{key:4,class:"modal-overlay",onClick:a[12]||(a[12]=(0,o.D$)(((...e)=>P.closeModal&&P.closeModal(...e)),["self"]))},[(0,t.Lk)("div",w,[(0,t.Lk)("div",E,[a[22]||(a[22]=(0,t.Lk)("h3",null,"Detalles del Registro",-1)),(0,t.Lk)("button",{onClick:a[10]||(a[10]=(...e)=>P.closeModal&&P.closeModal(...e)),class:"close-btn"},"√ó")]),(0,t.Lk)("div",C,[(0,t.Lk)("div",D,[a[23]||(a[23]=(0,t.Lk)("span",{class:"detail-label"},"Fecha y Hora:",-1)),(0,t.Lk)("span",S,(0,r.v_)(P.formatDate(P.selectedLog.timestamp)),1)]),(0,t.Lk)("div",A,[a[24]||(a[24]=(0,t.Lk)("span",{class:"detail-label"},"Tipo:",-1)),(0,t.Lk)("span",I,[(0,t.Lk)("span",{class:(0,r.C4)(["log-type",P.selectedLog.type])},(0,r.v_)(P.getTypeLabel(P.selectedLog.type)),3)])]),(0,t.Lk)("div",U,[a[25]||(a[25]=(0,t.Lk)("span",{class:"detail-label"},"Usuario:",-1)),(0,t.Lk)("span",R,(0,r.v_)(P.selectedLog.user||"Sistema"),1)]),(0,t.Lk)("div",x,[a[26]||(a[26]=(0,t.Lk)("span",{class:"detail-label"},"Mensaje:",-1)),(0,t.Lk)("span",_,(0,r.v_)(P.selectedLog.message),1)]),(0,t.Lk)("div",F,[a[27]||(a[27]=(0,t.Lk)("span",{class:"detail-label"},"Detalles adicionales:",-1)),(0,t.Lk)("pre",X,(0,r.v_)(JSON.stringify(P.selectedLog.details,null,2)),1)])]),(0,t.Lk)("div",M,[(0,t.Lk)("button",{onClick:a[11]||(a[11]=(...e)=>P.closeModal&&P.closeModal(...e)),class:"close-btn"},"Cerrar")])])])):(0,t.Q3)("",!0)])}s(4114),s(8111),s(2489),s(4603),s(7566),s(8721);var $=s(953),T=s(3444),K=s(4887),z={name:"AdminLogs",setup(){const e=(0,$.KR)([]),a=(0,$.KR)(!0),s=(0,$.KR)(""),o=(0,$.KR)(""),r=(0,$.KR)(""),l=(0,$.KR)(1),n=(0,$.KR)(10),i=(0,$.KR)(!1),c=(0,$.KR)({});let d=null;(0,t.sV)((async()=>{await u()}));const u=async()=>{try{a.value=!0;const s=await(0,T.ao)();if(!s||!s.success)throw new Error("Error al cargar logs");e.value=s.data||[]}catch(s){console.error("Error al obtener logs:",s),await(0,K.xE)("Error al cargar los logs: "+(s.message||"Error desconocido"))}finally{a.value=!1}},m=e=>{if(!e)return"N/A";try{const a=new Date(e);return isNaN(a.getTime())?"Fecha inv√°lida":new Intl.DateTimeFormat("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(a)}catch(a){return"Fecha inv√°lida"}},v=e=>{switch(e){case"info":return"Informaci√≥n";case"warning":return"Advertencia";case"error":return"Error";case"success":return"√âxito";default:return e}},p=(0,t.EW)((()=>{let a=[...e.value];if(s.value){const e=s.value.toLowerCase();a=a.filter((a=>a.message&&a.message.toLowerCase().includes(e)||a.user&&a.user.toLowerCase().includes(e)))}if(o.value&&(a=a.filter((e=>e.type===o.value))),r.value){const e=new Date,s=new Date(e.getFullYear(),e.getMonth(),e.getDate());switch(r.value){case"today":a=a.filter((e=>{const a=new Date(e.timestamp);return a>=s}));break;case"yesterday":const e=new Date(s);e.setDate(e.getDate()-1),a=a.filter((a=>{const t=new Date(a.timestamp);return t>=e&&t<s}));break;case"week":const t=new Date(s);t.setDate(t.getDate()-7),a=a.filter((e=>{const a=new Date(e.timestamp);return a>=t}));break;case"month":const o=new Date(s);o.setMonth(o.getMonth()-1),a=a.filter((e=>{const a=new Date(e.timestamp);return a>=o}));break}}return a})),k=(0,t.EW)((()=>Math.ceil(p.value.length/n.value))),g=(0,t.EW)((()=>{const e=[],a=5;if(k.value<=a)for(let s=1;s<=k.value;s++)e.push(s);else{let s=Math.max(1,l.value-Math.floor(a/2));const t=Math.min(k.value,s+a-1);t-s+1<a&&(s=Math.max(1,t-a+1));for(let a=s;a<=t;a++)e.push(a)}return e})),b=((0,t.EW)((()=>{const e=(l.value-1)*n.value;return p.value.slice(e,e+n.value)})),e=>{e>=1&&e<=k.value&&(l.value=e)}),h=()=>{clearTimeout(d),d=setTimeout((()=>{l.value=1}),300)},y=()=>{l.value=1},L=async()=>{await u(),await(0,K.xE)("Registros actualizados correctamente")},f=async()=>{try{a.value=!0;const e=await(0,T.Um)();if(!e||!e.success)throw new Error("Error al descargar logs");{const a=new Blob([e.data],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),t=URL.createObjectURL(a);s.setAttribute("href",t),s.setAttribute("download",`logs_${(new Date).toISOString().split("T")[0]}.csv`),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),await(0,K.xE)("Logs descargados correctamente")}}catch(e){console.error("Error al descargar logs:",e),await(0,K.xE)("Error al descargar logs: "+(e.message||"Error desconocido"))}finally{a.value=!1}},w=e=>{c.value=e,i.value=!0},E=()=>{i.value=!1};return{logs:e,loading:a,searchTerm:s,typeFilter:o,dateFilter:r,currentPage:l,totalPages:k,displayedPages:g,filteredLogs:p,showModal:i,selectedLog:c,formatDate:m,getTypeLabel:v,debounceSearch:h,applyFilters:y,refreshLogs:L,downloadLogs:f,changePage:b,viewLogDetails:w,closeModal:E}}},N=s(6262);const Q=(0,N.A)(z,[["render",P],["__scopeId","data-v-4dbe11f6"]]);var V=Q},9984:function(e,a,s){s.d(a,{$J:function(){return C}});s(8111),s(2489);var t=s(4335),o=s(4640);const r=o.A.API_URL;let l=0,n=null;const i="websap-admin-db",c=1,d="users",u="roles",m=[{id:1,nombre:"Administrador",email:"admin@example.com",roles:["Superadministrador"],estado:"activo",fecha_creacion:(new Date).toISOString()},{id:2,nombre:"Juan P√©rez",email:"juan@example.com",telefono:"3001234567",roles:["Administrador"],estado:"activo",fecha_creacion:(new Date).toISOString()},{id:3,nombre:"Mar√≠a L√≥pez",email:"maria@example.com",telefono:"3112345678",roles:["Empleado"],estado:"activo",fecha_creacion:(new Date).toISOString()},{id:4,nombre:"Carlos Rodr√≠guez",email:"carlos@example.com",roles:["Empleado"],estado:"inactivo",fecha_creacion:(new Date).toISOString()}],v=[{id:1,nombre:"Superadministrador",descripcion:"Control total del sistema"},{id:2,nombre:"Administrador",descripcion:"Gesti√≥n de usuarios y configuraci√≥n"},{id:3,nombre:"Empleado",descripcion:"Operaciones b√°sicas"}],p=()=>new Promise(((e,a)=>{const s=indexedDB.open(i,c);s.onupgradeneeded=e=>{const a=e.target.result;a.objectStoreNames.contains(d)||a.createObjectStore(d,{keyPath:"id"}),a.objectStoreNames.contains(u)||a.createObjectStore(u,{keyPath:"id"})},s.onsuccess=a=>{const s=a.target.result;e(s)},s.onerror=e=>{console.error("Error al abrir IndexedDB:",e.target.error),a(e.target.error)}})),k=async(e,a)=>{try{const s=await p(),t=s.transaction(e,"readwrite"),o=t.objectStore(e);if(Array.isArray(a))for(const e of a)o.put(e);else o.put(a);return new Promise(((a,s)=>{t.oncomplete=()=>{console.log(`Datos guardados en ${e}`),a(!0)},t.onerror=a=>{console.error(`Error al guardar en ${e}:`,a.target.error),s(a.target.error)}}))}catch(s){return console.error(`Error general al guardar en ${e}:`,s),!1}},g=async e=>{try{const a=await p(),s=a.transaction(e,"readonly"),t=s.objectStore(e);return new Promise(((a,s)=>{const o=t.getAll();o.onsuccess=()=>{const s=o.result;console.log(`Recuperados ${s.length} elementos de ${e}`),a(s)},o.onerror=a=>{console.error(`Error al leer de ${e}:`,a.target.error),s(a.target.error)}}))}catch(a){return console.error(`Error general al leer de ${e}:`,a),null}},b=async(e={})=>{try{console.log("Intentando obtener usuarios de la API...");const a=`${r}/admin/usuarios`;console.log(`Conectando a URL: ${a}`);const s=await t.A.get(a,{params:e,timeout:8e3});if(s.data&&Array.isArray(s.data.data))return await k(d,s.data.data),l=s.data.data.length,n=new Date,console.log(`Contador de usuarios actualizado: ${l}`),{success:!0,message:"Usuarios cargados desde API",data:s.data.data};throw new Error("Formato de respuesta inv√°lido")}catch(a){console.warn("Error al obtener usuarios de la API:",a.message);try{console.log("Intentando obtener usuarios de IndexedDB...");const a=await g(d);if(a&&a.length>0){console.log(`Recuperados ${a.length} usuarios de IndexedDB`);let s=[...a];if(e.searchTerm){const a=e.searchTerm.toLowerCase();s=s.filter((e=>e.nombre&&e.nombre.toLowerCase().includes(a)||e.email&&e.email.toLowerCase().includes(a)))}return e.role&&(s=s.filter((a=>a.roles&&Array.isArray(a.roles)&&a.roles.includes(e.role)))),e.status&&(s=s.filter((a=>a.estado===e.status))),{success:!0,message:"Usuarios cargados desde almacenamiento local",data:s,source:"indexeddb"}}throw new Error("No hay datos en almacenamiento local")}catch(s){console.warn("Error al obtener usuarios de IndexedDB:",s.message),console.log("Usando datos dummy para usuarios");let a=[...m];if(e.searchTerm){const s=e.searchTerm.toLowerCase();a=a.filter((e=>e.nombre&&e.nombre.toLowerCase().includes(s)||e.email&&e.email.toLowerCase().includes(s)))}return e.role&&(a=a.filter((a=>a.roles&&Array.isArray(a.roles)&&a.roles.includes(e.role)))),e.status&&(a=a.filter((a=>a.estado===e.status))),{success:!0,message:"Usando datos de ejemplo",data:a,source:"dummy"}}}},h=async()=>{try{if(l>0&&n){const e=new Date(Date.now()-3e5);if(n>e)return console.log(`Devolviendo conteo en cach√©: ${l} usuarios`),{success:!0,count:l,source:"cached"}}const e=await b();return e.success&&Array.isArray(e.data)?(l=e.data.length,n=new Date,console.log(`Conteo actualizado: ${l} usuarios`),{success:!0,count:l,source:e.source||"api"}):{success:!1,count:0,message:"No se pudo obtener el conteo de usuarios"}}catch(e){return console.error("Error al obtener conteo de usuarios:",e),{success:!1,count:0,message:"Error al obtener conteo de usuarios"}}},y=async()=>{try{console.log("Intentando obtener roles de la API...");const e=`${r}/admin/roles`;console.log(`Conectando a URL: ${e}`);const a=await t.A.get(e,{timeout:8e3});if(a.data&&Array.isArray(a.data.data))return await k(u,a.data.data),{success:!0,message:"Roles cargados desde API",data:a.data.data};throw new Error("Formato de respuesta inv√°lido")}catch(e){console.warn("Error al obtener roles de la API:",e.message);try{console.log("Intentando obtener roles de IndexedDB...");const e=await g(u);if(e&&e.length>0)return console.log(`Recuperados ${e.length} roles de IndexedDB`),{success:!0,message:"Roles cargados desde almacenamiento local",data:e,source:"indexeddb"};throw new Error("No hay datos en almacenamiento local")}catch(a){return console.warn("Error al obtener roles de IndexedDB:",a.message),console.log("Usando datos dummy para roles"),{success:!0,message:"Usando datos de ejemplo",data:v,source:"dummy"}}}},L=async e=>{try{const a=`${r}/admin/usuarios`;console.log(`Conectando a URL: ${a}`);const s=await t.A.post(a,e);if(s.data&&s.data.success)return s.data.data&&await k(d,s.data.data),s.data;throw new Error(s.data?.message||"Error al crear usuario")}catch(a){throw console.error("Error al crear usuario:",a),a}},f=async(e,a)=>{try{const o=`${r}/admin/usuarios/${e}`;console.log(`Conectando a URL: ${o}`);const l=await t.A.put(o,a);if(l.data&&l.data.success){try{const s=await p(),t=s.transaction(d,"readwrite"),o=t.objectStore(d),r=o.get(e);r.onsuccess=()=>{const e=r.result;if(e){const s={...e,...a};o.put(s)}}}catch(s){console.warn("Error al actualizar usuario en IndexedDB:",s)}return l.data}throw new Error(l.data?.message||"Error al actualizar usuario")}catch(o){throw console.error("Error al actualizar usuario:",o),o}},w=async(e,a)=>{try{const o=`${r}/admin/usuarios/${e}/estado`;console.log(`Conectando a URL: ${o}`);const l=await t.A.patch(o,{estado:a});if(l.data&&l.data.success){try{const s=await p(),t=s.transaction(d,"readwrite"),o=t.objectStore(d),r=o.get(e);r.onsuccess=()=>{const e=r.result;e&&(e.estado=a,o.put(e))}}catch(s){console.warn("Error al actualizar estado de usuario en IndexedDB:",s)}return l.data}throw new Error(l.data?.message||"Error al cambiar estado del usuario")}catch(o){throw console.error("Error al cambiar estado de usuario:",o),o}},E=async e=>{try{const s=`${r}/admin/usuarios/${e}`;console.log(`Conectando a URL: ${s}`);const o=await t.A.delete(s);if(o.data&&o.data.success){try{const a=await p(),s=a.transaction(d,"readwrite"),t=s.objectStore(d);t.delete(e)}catch(a){console.warn("Error al eliminar usuario de IndexedDB:",a)}return o.data}throw new Error(o.data?.message||"Error al eliminar usuario")}catch(s){throw console.error("Error al eliminar usuario:",s),s}},C=async()=>{try{console.log("Obteniendo datos para el dashboard...");const e=await h(),a=e.success?e.count:0;return console.log(`Dashboard utilizando conteo de usuarios: ${a}`),{success:!0,data:{estadisticas:{totalUsuarios:a,totalRestaurantes:35,totalPedidos:128,totalVentas:475e4},graficoVentas:[{mes:"Ene",ventas:45e4},{mes:"Feb",ventas:52e4},{mes:"Mar",ventas:48e4},{mes:"Abr",ventas:62e4},{mes:"May",ventas:58e4},{mes:"Jun",ventas:63e4}],restaurantesPopulares:[{nombre:"Restaurante A",pedidos:42},{nombre:"Restaurante B",pedidos:38},{nombre:"Restaurante C",pedidos:27},{nombre:"Restaurante D",pedidos:21},{nombre:"Restaurante E",pedidos:18}],usuariosActivos:[{nombre:"Juan P√©rez",rol:"Administrador",ultimoAcceso:(new Date).toISOString()},{nombre:"Mar√≠a L√≥pez",rol:"Empleado",ultimoAcceso:(new Date).toISOString()},{nombre:"Carlos Rodr√≠guez",rol:"Empleado",ultimoAcceso:(new Date).toISOString()}],fechaActualizacion:(new Date).toISOString()},message:"Datos del dashboard obtenidos correctamente"}}catch(e){return console.error("Error al obtener datos del dashboard:",e),{success:!1,message:"Error al obtener datos del dashboard",error:e.message}}},D={getUsers:b,getRoles:y,createUser:L,updateUser:f,cambiarEstadoUsuario:w,deleteUser:E};a.Ay=D}}]);
//# sourceMappingURL=563.ca773b5e.js.map