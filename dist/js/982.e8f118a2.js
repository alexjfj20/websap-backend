"use strict";(self["webpackChunkwebsap"]=self["webpackChunkwebsap"]||[]).push([[982],{507:function(r,e,n){var o=n(9565);r.exports=function(r,e,n){var t,a,s=n?r:r.iterator,i=r.next;while(!(t=o(i,s)).done)if(a=e(t.value),void 0!==a)return a}},1698:function(r,e,n){var o=n(6518),t=n(4204),a=n(4916);o({target:"Set",proto:!0,real:!0,forced:!a("union")},{union:t})},2475:function(r,e,n){var o=n(6518),t=n(8527),a=n(4916),s=!a("isSupersetOf",(function(r){return!r}));o({target:"Set",proto:!0,real:!0,forced:s},{isSupersetOf:t})},3440:function(r,e,n){var o=n(7080),t=n(4402),a=n(9286),s=n(5170),i=n(3789),c=n(8469),u=n(507),l=t.has,d=t.remove;r.exports=function(r){var e=o(this),n=i(r),t=a(e);return s(e)<=n.size?c(e,(function(r){n.includes(r)&&d(t,r)})):u(n.getIterator(),(function(r){l(e,r)&&d(t,r)})),t}},3650:function(r,e,n){var o=n(7080),t=n(4402),a=n(9286),s=n(3789),i=n(507),c=t.add,u=t.has,l=t.remove;r.exports=function(r){var e=o(this),n=s(r).getIterator(),t=a(e);return i(n,(function(r){u(e,r)?l(t,r):c(t,r)})),t}},3789:function(r,e,n){var o=n(9306),t=n(8551),a=n(9565),s=n(1291),i=n(1767),c="Invalid size",u=RangeError,l=TypeError,d=Math.max,f=function(r,e){this.set=r,this.size=d(e,0),this.has=o(r.has),this.keys=o(r.keys)};f.prototype={getIterator:function(){return i(t(a(this.keys,this.set)))},includes:function(r){return a(this.has,this.set,r)}},r.exports=function(r){t(r);var e=+r.size;if(e!==e)throw new l(c);var n=s(e);if(n<0)throw new u(c);return new f(r,n)}},3838:function(r,e,n){var o=n(7080),t=n(5170),a=n(8469),s=n(3789);r.exports=function(r){var e=o(this),n=s(r);return!(t(e)>n.size)&&!1!==a(e,(function(r){if(!n.includes(r))return!1}),!0)}},3853:function(r,e,n){var o=n(6518),t=n(4449),a=n(4916),s=!a("isDisjointFrom",(function(r){return!r}));o({target:"Set",proto:!0,real:!0,forced:s},{isDisjointFrom:t})},4204:function(r,e,n){var o=n(7080),t=n(4402).add,a=n(9286),s=n(3789),i=n(507);r.exports=function(r){var e=o(this),n=s(r).getIterator(),c=a(e);return i(n,(function(r){t(c,r)})),c}},4402:function(r,e,n){var o=n(9504),t=Set.prototype;r.exports={Set:Set,add:o(t.add),has:o(t.has),remove:o(t["delete"]),proto:t}},4449:function(r,e,n){var o=n(7080),t=n(4402).has,a=n(5170),s=n(3789),i=n(8469),c=n(507),u=n(9539);r.exports=function(r){var e=o(this),n=s(r);if(a(e)<=n.size)return!1!==i(e,(function(r){if(n.includes(r))return!1}),!0);var l=n.getIterator();return!1!==c(l,(function(r){if(t(e,r))return u(l,"normal",!1)}))}},4916:function(r,e,n){var o=n(7751),t=function(r){return{size:r,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}},a=function(r){return{size:r,has:function(){return!0},keys:function(){throw new Error("e")}}};r.exports=function(r,e){var n=o("Set");try{(new n)[r](t(0));try{return(new n)[r](t(-1)),!1}catch(i){if(!e)return!0;try{return(new n)[r](a(-1/0)),!1}catch(c){var s=new n;return s.add(1),s.add(2),e(s[r](a(1/0)))}}}catch(c){return!1}}},5024:function(r,e,n){var o=n(6518),t=n(3650),a=n(4916);o({target:"Set",proto:!0,real:!0,forced:!a("symmetricDifference")},{symmetricDifference:t})},5170:function(r,e,n){var o=n(6706),t=n(4402);r.exports=o(t.proto,"size","get")||function(r){return r.size}},5876:function(r,e,n){var o=n(6518),t=n(3838),a=n(4916),s=!a("isSubsetOf",(function(r){return r}));o({target:"Set",proto:!0,real:!0,forced:s},{isSubsetOf:t})},7080:function(r,e,n){var o=n(4402).has;r.exports=function(r){return o(r),r}},7642:function(r,e,n){var o=n(6518),t=n(3440),a=n(4916),s=!a("difference",(function(r){return 0===r.size}));o({target:"Set",proto:!0,real:!0,forced:s},{difference:t})},8004:function(r,e,n){var o=n(6518),t=n(9039),a=n(8750),s=n(4916),i=!s("intersection",(function(r){return 2===r.size&&r.has(1)&&r.has(2)}))||t((function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))}));o({target:"Set",proto:!0,real:!0,forced:i},{intersection:a})},8469:function(r,e,n){var o=n(9504),t=n(507),a=n(4402),s=a.Set,i=a.proto,c=o(i.forEach),u=o(i.keys),l=u(new s).next;r.exports=function(r,e,n){return n?t({iterator:u(r),next:l},e):c(r,e)}},8527:function(r,e,n){var o=n(7080),t=n(4402).has,a=n(5170),s=n(3789),i=n(507),c=n(9539);r.exports=function(r){var e=o(this),n=s(r);if(a(e)<n.size)return!1;var u=n.getIterator();return!1!==i(u,(function(r){if(!t(e,r))return c(u,"normal",!1)}))}},8750:function(r,e,n){var o=n(7080),t=n(4402),a=n(5170),s=n(3789),i=n(8469),c=n(507),u=t.Set,l=t.add,d=t.has;r.exports=function(r){var e=o(this),n=s(r),t=new u;return a(e)>n.size?c(n.getIterator(),(function(r){d(e,r)&&l(t,r)})):i(e,(function(r){n.includes(r)&&l(t,r)})),t}},8982:function(r,e,n){n.d(e,{AU:function(){return y},By:function(){return b},Re:function(){return f},cQ:function(){return S},eq:function(){return E},gL:function(){return g},getSoldItems:function(){return v},k1:function(){return h},saveSoldItems:function(){return w},w4:function(){return I}});n(4114),n(8111),n(1701),n(7642),n(8004),n(3853),n(5876),n(2475),n(5024),n(1698);const o="websapDatabase",t=3,a="menuItems",s="menuImages",i="soldItems",c="businessInfo",u="users",l="sharedMenus";function d(){return new Promise(((r,e)=>{try{console.log("Intentando abrir la base de datos con versión:",t);const n=indexedDB.open(o,t);n.onerror=r=>{console.error("Error al abrir la base de datos:",r.target.error),e("Error al abrir la base de datos: "+r.target.errorCode)},n.onsuccess=e=>{const n=e.target.result;console.log("Base de datos abierta con éxito, versión:",n.version);const o=Array.from(n.objectStoreNames);console.log("Almacenes existentes:",o),r(n)},n.onupgradeneeded=r=>{console.log("Actualizando estructura de la base de datos a versión:",r.newVersion);const e=r.target.result,n=[{name:u,keyPath:"id"},{name:a,keyPath:"id"},{name:s,keyPath:"id"},{name:i,keyPath:"id"},{name:c,keyPath:"id"},{name:l,keyPath:"id"}];n.forEach((r=>{e.objectStoreNames.contains(r.name)||(console.log(`Creando almacén: ${r.name}`),e.createObjectStore(r.name,{keyPath:r.keyPath}))}))}}catch(n){console.error("Error crítico en IndexedDB:",n),e(n)}}))}async function f(r,e=!1){try{const e=[];for(const a of r){const r={...a};if(r.id||(r.id=Date.now()+Math.random().toString(36).substring(2,10)),r.isSpecial=a.isSpecial||!1,r.image&&"string"===typeof r.image&&r.image.length>0)try{await m(r.id,r.image),r.image=null,r.hasStoredImage=!0}catch(n){console.warn("Error al guardar imagen, continuando sin imagen:",n),r.image=null,r.hasStoredImage=!1}e.push(r)}const o=await d(),t=o.transaction([a],"readwrite"),s=t.objectStore(a),i=e.map((r=>new Promise(((e,n)=>{const o=s.put(r);o.onsuccess=()=>e(),o.onerror=r=>n(r.target.error)}))));return await Promise.all(i),new Promise(((r,e)=>{t.oncomplete=()=>r(!0),t.onerror=r=>e(r.target.error)}))}catch(o){throw console.error("Error al guardar elementos del menú:",o),o}}async function m(r,e){try{const n=await d(),o=n.transaction([s],"readwrite"),t=o.objectStore(s);return t.put({id:r,data:e}),new Promise(((r,e)=>{o.oncomplete=()=>r(!0),o.onerror=r=>e(r.target.error)}))}catch(n){throw console.error("Error al guardar imagen:",n),n}}async function g(){try{const r=await d();if(!Array.from(r.objectStoreNames).includes(a))return console.error(`El almacén ${a} no existe en la base de datos`),[];const e=r.transaction([a],"readonly"),n=e.objectStore(a),o=n.getAll();return new Promise(((r,e)=>{o.onsuccess=async()=>{let e=o.result;const n=[],t=new Set;for(const r of e)r.id&&!t.has(r.id)||(r.id=Date.now()+"-"+Math.random().toString(36).substring(2,10)),t.add(r.id),n.push(r);for(const r of n)r.hasStoredImage&&(r.image=await p(r.id));r(n)},o.onerror=r=>e(r.target.error)}))}catch(r){return console.error("Error al obtener elementos del menú:",r),[]}}async function h(r){try{console.log(`Intentando eliminar elemento con ID: ${r}`);const e=await d(),n=e.transaction([a,s],"readwrite"),o=n.objectStore(a),t=n.objectStore(s),i=o.get(r);return new Promise(((e,n)=>{i.onsuccess=()=>{if(!i.result)return console.warn(`No se encontró el elemento con ID: ${r}`),void e(!0);const a=o.delete(r);a.onsuccess=()=>{console.log(`Elemento con ID ${r} eliminado correctamente`);const n=t.delete(r);n.onsuccess=()=>{console.log(`Imagen para elemento ${r} eliminada (si existía)`),e(!0)},n.onerror=n=>{console.warn(`Error al eliminar imagen para ${r}:`,n.target.error),e(!0)}},a.onerror=e=>{console.error(`Error al eliminar elemento ${r}:`,e.target.error),n(e.target.error)}},i.onerror=e=>{console.error(`Error al verificar existencia del elemento ${r}:`,e.target.error),n(e.target.error)}}))}catch(e){throw console.error("Error al eliminar elemento del menú:",e),e}}async function p(r){try{const e=await d(),n=e.transaction([s],"readonly"),o=n.objectStore(s),t=o.get(r);return new Promise(((r,e)=>{t.onsuccess=()=>{t.result?r(t.result.data):r(null)},t.onerror=r=>e(r.target.error)}))}catch(e){throw console.error("Error al obtener imagen:",e),e}}async function y(r){try{const n=await d(),o=n.transaction(["businessInfo"],"readwrite"),t=o.objectStore("businessInfo"),a={id:r.id||"business_info_1",name:r.name||"",description:r.description||"",contact:r.contact||"",address:r.address||"",logo:r.logo||""};r.paymentInfo&&(a.paymentInfo={qrTitle:r.paymentInfo.qrTitle||"",qrImage:r.paymentInfo.qrImage||"",nequiNumber:r.paymentInfo.nequiNumber||"",nequiImage:r.paymentInfo.nequiImage||"",bankInfo:r.paymentInfo.bankInfo||"",otherPaymentMethods:r.paymentInfo.otherPaymentMethods||""});try{JSON.stringify(a)}catch(e){throw console.error("El objeto businessInfo no es serializable:",e),new Error("El objeto businessInfo no es serializable")}const s=t.put(a);return new Promise(((r,e)=>{s.onsuccess=()=>r(!0),s.onerror=r=>{console.error("Error específico al guardar businessInfo:",r.target.error),e(r.target.error)}}))}catch(n){throw console.error("Error al guardar información del negocio:",n),n}}async function b(){try{const r=await d();if(!Array.from(r.objectStoreNames).includes(c))return console.error(`El almacén ${c} no existe en la base de datos`),{};const e=r.transaction([c],"readonly"),n=e.objectStore(c),o=n.get("business_info_1");return new Promise(((r,e)=>{o.onsuccess=()=>{r(o.result||{})},o.onerror=r=>{console.error("Error en request:",r.target.error),e(r.target.error)}}))}catch(r){return console.error("Error al obtener información del negocio:",r),{}}}async function w(r){try{Array.isArray(r)||(console.warn("saveSoldItems recibió un valor que no es array:",r),r=[]);const n=r.map((r=>r&&"object"===typeof r?{name:String(r.name||"Producto desconocido"),quantity:Number(r.quantity)||1,price:Number(r.price)||0,includesDrink:Boolean(r.includesDrink)}:{name:"Producto desconocido",quantity:1,price:0,includesDrink:!1})),o=await d(),t=o.transaction([i],"readwrite"),a=t.objectStore(i),s={id:"sold_items_1",items:n};try{JSON.stringify(s)}catch(e){throw console.error("El objeto soldItems no es serializable:",e),new Error("El objeto soldItems no es serializable")}const c=a.put(s);return new Promise(((r,e)=>{c.onsuccess=()=>r(!0),c.onerror=r=>{console.error("Error específico al guardar soldItems:",r.target.error),e(r.target.error)}}))}catch(n){throw console.error("Error al guardar elementos vendidos:",n),n}}async function v(){try{const r=await d();if(!Array.from(r.objectStoreNames).includes(i))return console.error(`El almacén ${i} no existe en la base de datos`),[];const e=r.transaction([i],"readonly"),n=e.objectStore(i),o=n.get("sold_items_1");return new Promise(((r,e)=>{o.onsuccess=()=>{o.result?r(o.result.items):r([])},o.onerror=r=>e(r.target.error)}))}catch(r){return console.error("Error al obtener elementos vendidos:",r),[]}}async function S(){return console.log("Función migrateFromLocalStorage en desuso - no se utilizará localStorage"),!0}function I(r,e=800,n=600,o=.7){return new Promise((t=>{const a=new Image;a.onload=()=>{const r=document.createElement("canvas");let s=a.width,i=a.height;s>i?s>e&&(i=Math.round(i*e/s),s=e):i>n&&(s=Math.round(s*n/i),i=n),r.width=s,r.height=i;const c=r.getContext("2d");c.drawImage(a,0,0,s,i);const u=r.toDataURL("image/jpeg",o);t(u)},a.src=r}))}async function E(r,e){try{if(!r)return console.error("Error: ID del item no proporcionado"),!1;const n=parseInt(Number(e),10);if(isNaN(n))return console.error(`Error: Cantidad inválida proporcionada: ${e} (${typeof e})`),!1;console.log(`Actualizando disponibilidad para item ${r} a ${n} unidades (valor original: ${e}, tipo: ${typeof e})`);const o=await d(),t=o.transaction([a],"readwrite"),s=t.objectStore(a);return new Promise(((e,o)=>{const a=s.get(r);a.onsuccess=t=>{const a=t.target.result;if(!a)return console.error(`No se encontró el elemento con ID: ${r}`),void e(!1);const i=parseInt(Number(a.availableQuantity)||0,10);a.availableQuantity=n;const c=s.put(a);c.onsuccess=()=>{console.log(`Disponibilidad actualizada para ${a.name} (ID: ${r}): ${i} → ${n} (diferencia: ${i-n})`);try{fetch("http://localhost:3000/actualizar-disponibilidad",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:r,availableQuantity:n})}).catch((r=>{console.warn("Error al sincronizar con backend:",r)}))}catch(o){console.warn("Error al sincronizar con el backend:",o)}e(!0)},c.onerror=e=>{console.error(`Error al actualizar disponibilidad para ${r}:`,e),o(e)}},a.onerror=e=>{console.error(`Error al obtener elemento ${r}:`,e),o(e)},t.onerror=r=>{console.error("Error en transacción de actualización:",r),o(r)}}))}catch(n){return console.error("Error al actualizar disponibilidad:",n),!1}}},9286:function(r,e,n){var o=n(4402),t=n(8469),a=o.Set,s=o.add;r.exports=function(r){var e=new a;return t(r,(function(r){s(e,r)})),e}}}]);
//# sourceMappingURL=982.e8f118a2.js.map