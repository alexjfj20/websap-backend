(function(){"use strict";var e={133:function(e,o,n){n.r(o);var a=n(4640);const t=a.A.API_URL;let r=localStorage.getItem("token")||"";const s=e=>{r=e,e?localStorage.setItem("token",e):localStorage.removeItem("token")},i=async(e,o={})=>{try{const n={"Content-Type":"application/json",...r&&{Authorization:`Bearer ${r}`},...o.headers||{}},a=await fetch(`${t}${e}`,{method:"GET",headers:n,...o});if("blob"===o.responseType)return a.blob();const s=a.headers.get("content-type");if(!s||!s.includes("application/json")){const e=await a.text();return{success:a.ok,data:e,status:a.status}}const i=await a.json();if(401!==a.status&&403!==a.status||console.warn(`Error de autenticaci√≥n en ${e}:`,i),!a.ok)throw new Error(i.message||"Error en la petici√≥n");return i}catch(n){throw console.error(`Error en GET ${e}:`,n),n}},c=async(e,o={},n={})=>{try{const a={"Content-Type":"application/json",...r&&{Authorization:`Bearer ${r}`},...n.headers||{}},s=await fetch(`${t}${e}`,{method:"POST",headers:a,body:JSON.stringify(o),...n}),i=await s.json();if(!s.ok)throw new Error(i.message||"Error en la petici√≥n");return i}catch(a){throw console.error(`Error en POST ${e}:`,a),a}},l=async(e,o={},n={})=>{try{const a={"Content-Type":"application/json",...r&&{Authorization:`Bearer ${r}`},...n.headers||{}},s=await fetch(`${t}${e}`,{method:"PUT",headers:a,body:JSON.stringify(o),...n}),i=await s.json();if(!s.ok)throw new Error(i.message||"Error en la petici√≥n");return i}catch(a){throw console.error(`Error en PUT ${e}:`,a),a}},d=async(e,o={})=>{try{const n={"Content-Type":"application/json",...r&&{Authorization:`Bearer ${r}`},...o.headers||{}},a=await fetch(`${t}${e}`,{method:"DELETE",headers:n,...o}),s=await a.json();if(!a.ok)throw new Error(s.message||"Error en la petici√≥n");return s}catch(n){throw console.error(`Error en DELETE ${e}:`,n),n}};o["default"]={setToken:s,get:i,post:c,put:l,delete:d}},532:function(e,o,n){e.exports=n.p+"img/sun.ef46db37.svg"},981:function(e,o,n){n.d(o,{HW:function(){return p},eF:function(){return c},hf:function(){return g},iD:function(){return d},ri:function(){return u},wR:function(){return m}});n(4979);var a=n(4335),t=n(4640);const r=t.A.API_URL,s=e=>{localStorage.setItem("token",e)},i=()=>localStorage.getItem("token"),c=()=>{localStorage.removeItem("token")},l=()=>{a.A.interceptors.request.use((e=>{const o=i();return o&&(e.headers.Authorization=`Bearer ${o}`),e}),(e=>Promise.reject(e))),a.A.interceptors.response.use((e=>e),(e=>(e.response&&401===e.response.status&&(c(),"/login"!==window.location.pathname&&(window.location.href="/login")),Promise.reject(e))))};async function d(e,o){console.log("Intentando iniciar sesi√≥n con:",e);try{c(),localStorage.removeItem("user"),localStorage.removeItem("isLoggedIn"),console.log("Enviando solicitud al backend:",`${r}/auth/login`);const t=await a.A.post(`${r}/auth/login`,{email:e,password:o},{headers:{"Content-Type":"application/json"},withCredentials:!1,timeout:1e4});if(console.log("Respuesta del backend:",t.status,t.data),200===t.status&&t.data.success){console.log("Login exitoso con el backend");const e=t.data.data.token;return s(e),Promise.resolve().then(n.bind(n,133)).then((o=>{console.log("Actualizando token en apiService"),o.default.setToken(e)})),localStorage.setItem("user",JSON.stringify(t.data.data.user)),localStorage.setItem("isLoggedIn","true"),{success:!0,user:t.data.data.user}}throw console.error("Respuesta inesperada del servidor:",t.data),new Error("Respuesta inesperada del servidor")}catch(t){if(t.response){if(console.error("Error de respuesta del servidor:",t.response.status,t.response.data),t.response.data&&t.response.data.message&&t.response.data.message.includes("desactivado"))throw new Error(t.response.data.message)}else t.request?console.error("No se recibi√≥ respuesta del servidor:",t.request):console.error("Error al configurar la solicitud:",t.message);console.log("Fallback a autenticaci√≥n local...");const a=[{id:1,email:"superadmin@example.com",password:"123456",nombre:"Super Administrador",roles:["Superadministrador"]},{id:2,email:"admin@example.com",password:"123456",nombre:"Administrador",roles:["Administrador"]},{id:3,email:"empleado@example.com",password:"123456",nombre:"Empleado",roles:["Empleado"]},{id:5,email:"alex@gmail.com",password:"password",nombre:"alex",roles:["Empleado"]}],r=a.find((n=>n.email===e&&n.password===o));if(r){console.log("Login exitoso con usuario local:",r.email),localStorage.setItem("isLoggedIn","true");const e=`local_${btoa(JSON.stringify(r))}`;return s(e),Promise.resolve().then(n.bind(n,133)).then((o=>{console.log("Actualizando token en apiService (local)"),o.default.setToken(e)})),localStorage.setItem("user",JSON.stringify({id:r.id,email:r.email,nombre:r.nombre,roles:r.roles})),{success:!0,user:{id:r.id,email:r.email,nombre:r.nombre,roles:r.roles}}}throw new Error("Credenciales incorrectas")}}l();const u=()=>{c(),localStorage.removeItem("user"),localStorage.removeItem("isLoggedIn")},m=()=>{const e=i(),o="true"===localStorage.getItem("isLoggedIn");return!!e&&o},p=()=>{try{const e=localStorage.getItem("user");if(!e)return console.log("No hay usuario en localStorage"),null;const o=JSON.parse(e);return console.log("Usuario actual obtenido de localStorage:",o.email),o}catch(e){return console.error("Error al obtener el usuario actual:",e),null}},g=e=>{const o=p();return o&&o.roles&&o.roles.includes(e)}},4216:function(e,o,n){n.d(o,{Dh:function(){return l},Ds:function(){return k},Fk:function(){return d},Hk:function(){return p},VI:function(){return v},rM:function(){return u},vh:function(){return g}});n(8111),n(2489),n(116);var a=n(602),t=n(4640);t.A.API_DOMAIN;const r="restauranteAppDB",s=4,i="platos",c="syncQueue",l=async()=>{try{console.log("Obteniendo todos los platos de IndexedDB...");const e=await(0,a.P2)();return new Promise(((o,n)=>{const a=e.transaction([i],"readonly"),t=a.objectStore(i),r=t.getAll();r.onsuccess=e=>{const n=e.target.result;console.log(`Obtenidos ${n.length} platos totales de IndexedDB`);const a=n.filter((e=>!e.deleted));console.log(`Filtrando platos eliminados: ${n.length-a.length} platos ocultos, ${a.length} platos activos`),o(a)},r.onerror=e=>{console.error("Error al obtener platos de IndexedDB:",e),n("Error al obtener platos localmente")}}))}catch(e){throw console.error("Error en getAllPlatos:",e),e}},d=async()=>{try{console.log("Buscando platos pendientes de sincronizaci√≥n...");const e=await(0,a.P2)();return new Promise(((o,n)=>{const a=e.transaction([i],"readonly"),t=a.objectStore(i),r=t.index("syncStatus"),s=r.getAll("pending");s.onsuccess=e=>{const n=e.target.result;console.log(`Encontrados ${n.length} platos pendientes de sincronizaci√≥n`),o(n)},s.onerror=e=>{console.error("Error al obtener platos pendientes:",e),n("Error al obtener platos pendientes")}}))}catch(e){throw console.error("Error en getPendingPlatos:",e),e}},u=async(e,o)=>{console.log(`Actualizando estado de sincronizaci√≥n del plato ID ${e} a "${o}"...`);let n=o;"boolean"===typeof o&&(n=!0===o?"synced":"pending",console.log(`Convertido estado booleano ${o} a "${n}"`));const a=["pending","synced","pending_deletion"];if(!a.includes(n))throw new Error(`Estado inv√°lido: ${o}. Debe ser uno de: ${a.join(", ")}`);return new Promise(((o,a)=>{const t=indexedDB.open(r,s);t.onerror=e=>{console.error("Error al abrir la base de datos:",e.target.error),a(new Error("No se pudo abrir la base de datos para actualizar el estado."))},t.onsuccess=t=>{const r=t.target.result;try{const t=r.transaction([i],"readwrite"),s=t.objectStore(i),c=s.get(e);c.onerror=o=>{console.error(`Error al obtener plato ID ${e}:`,o.target.error),a(new Error(`No se pudo obtener el plato ID ${e}.`))},c.onsuccess=t=>{const r=t.target.result;if(!r)return console.error(`No se encontr√≥ plato con ID ${e}.`),void a(new Error(`No se encontr√≥ plato con ID ${e}.`));r.syncStatus=n,"pending_deletion"===n&&(r.is_available=!1);const i=s.put(r);i.onerror=o=>{console.error(`Error al actualizar plato ID ${e}:`,o.target.error),a(new Error(`No se pudo actualizar el estado del plato ID ${e}.`))},i.onsuccess=()=>{console.log(`Estado de sincronizaci√≥n del plato ID ${e} actualizado a "${n}".`),o(!0)}},t.oncomplete=()=>{r.close()}}catch(s){console.error("Error en la transacci√≥n:",s),a(s)}}}))},m=async e=>{try{console.log("Agregando elemento a la cola de sincronizaci√≥n:",e);const o=await(0,a.P2)();return new Promise(((n,a)=>{const t=o.transaction([c],"readwrite"),r=t.objectStore(c),s=r.add(e);s.onsuccess=e=>{console.log("Elemento agregado a la cola de sincronizaci√≥n"),n(e.target.result)},s.onerror=e=>{console.error("Error al agregar a la cola de sincronizaci√≥n:",e),a("Error al agregar a la cola de sincronizaci√≥n")}}))}catch(o){throw console.error("Error en addToSyncQueue:",o),o}},p=async()=>{try{console.log("Obteniendo cola de sincronizaci√≥n...");const e=await(0,a.P2)();return new Promise(((o,n)=>{const a=e.transaction([c],"readonly"),t=a.objectStore(c),r=t.getAll();r.onsuccess=e=>{const n=e.target.result;console.log(`Obtenidos ${n.length} elementos de la cola de sincronizaci√≥n`),o(n)},r.onerror=e=>{console.error("Error al obtener cola de sincronizaci√≥n:",e),n("Error al obtener cola de sincronizaci√≥n")}}))}catch(e){throw console.error("Error en getSyncQueue:",e),e}},g=async e=>{try{console.log(`Eliminando elemento ${e} de la cola de sincronizaci√≥n...`);const o=await(0,a.P2)();return new Promise(((n,a)=>{const t=o.transaction([c],"readwrite"),r=t.objectStore(c),s=r.delete(e);s.onsuccess=()=>{console.log(`Elemento ${e} eliminado de la cola de sincronizaci√≥n`),n(!0)},s.onerror=e=>{console.error("Error al eliminar de la cola de sincronizaci√≥n:",e),a("Error al eliminar de la cola de sincronizaci√≥n")}}))}catch(o){throw console.error("Error en removeFromSyncQueue:",o),o}},h=async()=>{const e=await(0,a.P2)();console.log("Bases de datos disponibles:",e.name,"versi√≥n:",e.version),console.log("Almacenes disponibles:",Array.from(e.objectStoreNames))};setInterval(h,1e4);const f=async e=>{try{console.log(`Verificando almacenamiento del plato ID ${e}...`);const o=await(0,a.P2)();return new Promise(((n,a)=>{const t=o.transaction([i],"readonly"),r=t.objectStore(i),s=r.get(e);s.onsuccess=o=>{const a=o.target.result;a?(console.log(`Verificaci√≥n exitosa: Plato ID ${e} encontrado en IndexedDB:`,a),n(a)):(console.error(`Verificaci√≥n fallida: Plato ID ${e} NO encontrado en IndexedDB`),n(null))},s.onerror=o=>{console.error(`Error al verificar plato ID ${e}:`,o.target.error),a(new Error(`Error al verificar plato ID ${e}: ${o.target.error.message}`))},t.oncomplete=()=>{console.log("Transacci√≥n de verificaci√≥n completada")}}))}catch(o){throw console.error("Error en verifyPlatoStorage:",o),o}};async function v(e){console.log("üçΩÔ∏è INICIO - Creando nuevo plato en IndexedDB:",e);try{if(!e||"object"!==typeof e)throw console.error("‚ùå ERROR: El plato debe ser un objeto v√°lido",e),new Error("El plato debe ser un objeto v√°lido");if(!e.name||""===e.name.trim())throw console.error("‚ùå ERROR: El plato debe tener un nombre v√°lido",e),new Error("El plato debe tener un nombre v√°lido");console.log("‚úÖ Validaci√≥n inicial del plato exitosa"),console.log("üîÑ Abriendo base de datos...");const o=await(0,a.P2)();return console.log("‚úÖ Base de datos abierta correctamente"),new Promise(((n,a)=>{console.log("üîÑ Iniciando transacci√≥n para guardar plato...");try{const t=o.transaction([i],"readwrite");console.log("‚úÖ Transacci√≥n creada correctamente");const r=t.objectStore(i);console.log("‚úÖ Almac√©n obtenido correctamente");const s={...e,createdAt:e.createdAt||(new Date).toISOString(),updatedAt:(new Date).toISOString(),syncStatus:"pending",localTimestamp:(new Date).getTime()};s.id||(s.id=`plato_${Date.now()}_${Math.floor(1e4*Math.random())}`,console.log(`üÜî Generando ID para el plato: ${s.id}`)),console.log("üì¶ Intentando guardar plato con datos:",s);const c=r.put(s);c.onsuccess=async e=>{const o=s.id;console.log(`‚úÖ √âXITO: Plato guardado con ID: ${o}`);const a={...s};try{console.log("üîÑ Agregando plato a cola de sincronizaci√≥n..."),await m({type:"create",entityType:"plato",entityId:o,data:a,timestamp:(new Date).getTime()}),console.log("‚úÖ Plato agregado a la cola de sincronizaci√≥n correctamente")}catch(t){console.warn("‚ö†Ô∏è Error al agregar a cola de sincronizaci√≥n:",t)}console.log("üîç Verificando inmediatamente el almacenamiento del plato...");try{const e=await l();console.log(`üìä Total de platos en BD: ${e.length}`),console.log("üìã Lista de platos:",e);const n=e.find((e=>e.id===o));n?console.log("‚úÖ VERIFICACI√ìN EXITOSA: Plato encontrado en la lista completa"):console.error("‚ùå VERIFICACI√ìN FALLIDA: Plato NO encontrado en la lista completa")}catch(r){console.error("‚ùå Error al listar platos para verificaci√≥n:",r)}setTimeout((async()=>{try{console.log(`üîç Verificando persistencia del plato ID ${o}...`);const e=await f(o);e?console.log("‚úÖ VERIFICACI√ìN POSTERIOR: Plato confirmado en base de datos"):console.error("‚ùå VERIFICACI√ìN POSTERIOR FALLIDA: Plato no encontrado en verificaci√≥n")}catch(e){console.error("‚ùå Error en verificaci√≥n posterior:",e)}}),1e3),console.log("üèÅ Finalizando creaci√≥n del plato con √©xito"),n(a)},c.onerror=e=>{console.error("‚ùå ERROR al crear plato:",e.target.error),a(new Error(`Error al crear plato: ${e.target.error.message}`))},t.onerror=e=>{console.error("‚ùå ERROR en transacci√≥n:",e.target.error),a(new Error(`Error en transacci√≥n: ${e.target.error.message}`))},t.oncomplete=()=>{console.log("‚úÖ Transacci√≥n completada correctamente")}}catch(t){console.error("‚ùå ERROR al crear transacci√≥n:",t),a(new Error(`Error al crear transacci√≥n: ${t.message}`))}}))}catch(o){throw console.error("‚ùå ERROR GENERAL en createPlato:",o),o}}async function b(){console.log("üîç INICIANDO DEPURACI√ìN DE INDEXEDDB...");try{const e=await window.indexedDB.databases();console.log("üìä Bases de datos disponibles:",e);const o=await(0,a.P2)();console.log("üì¶ Almacenes en la base de datos:",Array.from(o.objectStoreNames));const n=await l();console.log(`üìã Platos almacenados (${n.length}):`,n);const t=await p();return console.log(`üîÑ Cola de sincronizaci√≥n (${t.length}):`,t),console.log("‚úÖ DEPURACI√ìN COMPLETADA"),{databases:e,stores:Array.from(o.objectStoreNames),platos:n,syncQueue:t}}catch(e){throw console.error("‚ùå ERROR EN DEPURACI√ìN:",e),e}}function w(e){const o={...e};return o.name=o.name?.trim()||"Plato sin nombre",o.price="string"===typeof o.price?parseFloat(o.price)||0:o.price||0,o.is_available=!1!==o.is_available,o.availableQuantity=parseInt(o.availableQuantity)||0,o.includesDrink=!0===o.includesDrink,o.createdAt||(o.createdAt=(new Date).toISOString()),o.updatedAt=(new Date).toISOString(),o.syncStatus||(o.syncStatus="pending"),o.image&&"string"===typeof o.image&&o.image.length>2e5&&(console.warn("‚ö†Ô∏è Imagen demasiado grande, se reducir√° para evitar problemas de sincronizaci√≥n"),o.image_thumbnail=y(o.image),o.has_local_image=!0),o}function y(e){try{if(!e||!e.startsWith("data:"))return e;const o=e.match(/^data:([A-Za-z-+/]+);base64,(.+)$/);if(!o)return console.warn("‚ö†Ô∏è Formato de imagen no v√°lido para compresi√≥n"),e;const n=5e4,a=o[2];return a.length<=n?e:`data:${o[1]};base64,${a.substring(0,n)}`}catch(o){return console.error("‚ùå Error al comprimir imagen:",o),e}}async function E(e){console.log("üîÑ Iniciando guardado de plato con guardarPlato():",e);try{if(!e||"object"!==typeof e)throw new Error("Los datos del plato deben ser un objeto v√°lido");if(!e.name||""===e.name.trim())throw new Error("El plato debe tener un nombre v√°lido");const o=w(e);console.log("‚úÖ Datos normalizados:",o);const n=await v(o);return console.log("‚úÖ Plato guardado exitosamente:",n),n}catch(o){throw console.error("‚ùå Error en guardarPlato():",o),o}}const k=async e=>{try{console.log(`Obteniendo plato con ID ${e} de IndexedDB...`);const o=await(0,a.P2)();return new Promise(((n,a)=>{const t=o.transaction([i],"readonly"),r=t.objectStore(i),s=r.get(e);s.onsuccess=o=>{const a=o.target.result;a?(console.log(`Plato con ID ${e} encontrado:`,a),n(a)):(console.log(`No se encontr√≥ plato con ID ${e}`),n(null))},s.onerror=o=>{console.error(`Error al obtener plato con ID ${e}:`,o),a(`Error al obtener plato con ID ${e}`)}}))}catch(o){throw console.error("Error en getPlato:",o),o}};"undefined"!==typeof window&&(window.debugDB=b,window.guardarPlato=E)},4640:function(e,o){const n=!0,a=localStorage.getItem("apiUrl"),t=a||(n?"https://websap-backend.onrender.com":"http://localhost:3000"),r={production:{API_URL:`${t}/api`,RAW_URL:`${t}/raw`,API_TEST_ENDPOINT:`${t}/api/test/ping`,API_DOMAIN:t},development:{API_URL:`${t}/api`,RAW_URL:`${t}/raw`,API_TEST_ENDPOINT:`${t}/api/test/ping`,API_DOMAIN:t}},s=n?r.production:r.development;o.A=s},4887:function(e,o,n){n.d(o,{L3:function(){return i},lJ:function(){return r},qf:function(){return t},xE:function(){return s},zz:function(){return c}});var a=n(953);const t=(0,a.Kh)({show:!1,title:"Mensaje",message:"",confirmText:"Aceptar",cancelText:"Cancelar",showCancel:!1,resolvePromise:null});Boolean;function r(e,o={}){return new Promise((n=>{t.show=!0,t.message=e,t.title=o.title||"Confirmar",t.confirmText=o.confirmText||"Aceptar",t.cancelText=o.cancelText||"Cancelar",t.showCancel=!0,t.resolvePromise=n}))}function s(e,o={}){return new Promise((n=>{t.show=!0,t.message=e,t.title=o.title||"Mensaje",t.confirmText=o.confirmText||"Aceptar",t.showCancel=!1,t.resolvePromise=n}))}function i(){t.resolvePromise&&(t.resolvePromise(!0),t.resolvePromise=null),t.show=!1}function c(){t.resolvePromise&&(t.resolvePromise(!1),t.resolvePromise=null),t.show=!1}},6429:function(e,o,n){n.d(o,{CN:function(){return p},MT:function(){return m},S1:function(){return i},SG:function(){return c},sB:function(){return l},sb:function(){return d}});n(8111),n(1701);var a=n(133),t=n(7051);let r=[];try{const e=localStorage.getItem("websap_reservations");e&&(r=JSON.parse(e),console.log("Reservas cargadas desde localStorage:",r.length))}catch(h){console.error("Error al cargar reservas desde localStorage:",h)}function s(){try{localStorage.setItem("websap_reservations",JSON.stringify(r))}catch(h){console.error("Error al guardar reservas en localStorage:",h)}}async function i(e){try{const n=localStorage.getItem("token");n&&a["default"].setToken(n);const i="res_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),c={id:i,fullName:e.fullName,mobilePhone:e.mobilePhone,landlinePhone:e.landlinePhone||"",email:e.email||"",address:e.address||"",date:e.reservationDate,time:e.reservationTime,peopleCount:e.peopleCount,notes:e.additionalNotes||"",status:"pending",createdAt:(new Date).toISOString(),source:e.source||"web"};try{const o=await a["default"].post("/whatsapp/reservas",{nombre:c.fullName,telefono:c.mobilePhone,email:c.email,fecha:c.date,hora:c.time,personas:c.peopleCount,notas:c.notes,created_by:e.created_by||localStorage.getItem("userId")||null,usuario_id:e.usuario_id||("user"===localStorage.getItem("userType")?localStorage.getItem("userId"):null)});o.data&&o.data.success&&(console.log("Reserva guardada en el backend:",o.data),c.id=o.data.reservationId||c.id)}catch(o){console.warn("No se pudo guardar la reserva en el backend, usando almacenamiento local:",o)}return r.unshift(c),s(),t.A.emit("nueva-reserva",c),console.log("Reserva guardada correctamente:",c),{success:!0,reservation:c}}catch(h){return console.error("Error al guardar la reserva:",h),{success:!1,error:h.message||"Error al guardar la reserva"}}}async function c(){try{const e=localStorage.getItem("token");e&&a["default"].setToken(e);try{const e=await a["default"].get("/whatsapp/reservas");if(e&&e.success&&Array.isArray(e.reservas)){console.log("‚úÖ Reservas obtenidas desde el backend:",e.reservas.length);const o=e.reservas.map((e=>({id:e.id,fullName:e.nombre,mobilePhone:e.telefono,email:e.email||"",date:g(e.fecha),time:e.hora,peopleCount:e.personas,notes:e.notas||"",status:"confirmada"===e.estado?"confirmed":"cancelada"===e.estado?"cancelled":"pending",createdAt:e.creado_en,source:e.origen||"web",created_by:e.created_by,usuario_id:e.usuario_id})));return r=o,s(),{success:!0,reservations:o}}}catch(h){console.warn("Error al obtener reservas desde el backend, usando datos locales:",h)}console.log("üìã Usando datos de reservas locales:",r.length);const o=r.map((e=>({...e,date:g(e.date)})));return 0===o.length?{success:!0,reservations:[]}:{success:!0,reservations:o}}catch(h){return console.error("‚ùå Error al obtener las reservas:",h),{success:!1,error:h.message||"Error al obtener las reservas"}}}async function l(e,o){try{try{const n=await a["default"].put(`/whatsapp/reservas/${e}`,{estado:"confirmed"===o?"confirmada":"cancelled"===o?"cancelada":"pendiente"});n.data&&n.data.success&&console.log("Estado de reserva actualizado en el backend:",n.data)}catch(n){console.warn("No se pudo actualizar el estado de la reserva en el backend:",n)}const i=r.findIndex((o=>o.id===e));if(-1===i)throw new Error("Reserva no encontrada");return r[i].status=o,s(),t.A.emit("reserva-actualizada",{id:e,status:o}),{success:!0,message:"Estado de reserva actualizado correctamente"}}catch(h){return console.error("Error al actualizar el estado de la reserva:",h),{success:!1,error:h.message||"Error al actualizar el estado de la reserva"}}}async function d(e){console.log("Procesando reserva desde WhatsApp:",e);const o=localStorage.getItem("token");o&&a["default"].setToken(o);const n={...e,created_by:e.created_by||localStorage.getItem("userId")||null,usuario_id:e.usuario_id||("user"===localStorage.getItem("userType")?localStorage.getItem("userId"):null)};try{const e=await a["default"].post("/whatsapp/reservas",n),o={id:e.reservationId||Date.now().toString(),fullName:n.nombre,mobilePhone:n.telefono,email:n.email||"",date:g(n.fecha),time:n.hora,peopleCount:n.personas||2,notes:n.notas||"",status:"pending",createdAt:(new Date).toISOString(),source:"whatsapp",created_by:n.created_by,usuario_id:n.usuario_id};return{success:!0,reservation:o,message:"Reserva guardada correctamente"}}catch(h){return console.warn("‚ö†Ô∏è No se pudo guardar la reserva en el backend, pero se guard√≥ localmente:",h),await u(n),{status:"local",success:!0,reservation:{id:Date.now().toString(),fullName:n.nombre,mobilePhone:n.telefono,email:n.email||"",date:g(n.fecha),time:n.hora,peopleCount:n.personas||2,notes:n.notas||"",status:"pending",createdAt:(new Date).toISOString(),source:"whatsapp",created_by:n.created_by,usuario_id:n.usuario_id},message:"Reserva guardada localmente debido a un error de conexi√≥n"}}}async function u(e){try{const o={id:"local_"+Date.now(),fullName:e.nombre||e.fullName,mobilePhone:e.telefono||e.mobilePhone,email:e.email||"",date:g(e.fecha||e.date),time:e.hora||e.time,peopleCount:e.personas||e.peopleCount,notes:e.notas||e.notes||"",status:"pending",createdAt:(new Date).toISOString(),source:"whatsapp",created_by:e.created_by||localStorage.getItem("userId")||null,usuario_id:e.usuario_id||("user"===localStorage.getItem("userType")?localStorage.getItem("userId"):null),pendingSave:!0};return r.unshift(o),s(),t.A.emit("nueva-reserva",o),o}catch(h){throw console.error("Error al guardar reserva localmente:",h),h}}async function m(e){try{try{const o=await a["default"].delete(`/reservas/${e}`);console.log("Reserva eliminada en el backend:",o)}catch(o){console.warn("No se pudo eliminar la reserva en el backend:",o)}const n=r.findIndex((o=>o.id===e));return-1!==n?(r.splice(n,1),s(),t.A.emit("reserva-eliminada",{id:e}),{success:!0,message:"Reserva eliminada correctamente"}):{success:!1,error:"No se encontr√≥ la reserva especificada"}}catch(h){return console.error("Error al eliminar reserva:",h),{success:!1,error:h.message||"Error al eliminar la reserva"}}}function p(e,o=30){if(!e||!e.date)return!1;const n=new Date(e.date),a=new Date,t=a-n,r=Math.ceil(t/864e5);return r>o}function g(e){if(!e)return"";try{if(e.includes("T")&&e.includes("/")){const o=e.split("/");if(3===o.length){const e=o[0].split("T")[0];return`${e}/${o[1]}/${o[2]}`}}if(e.includes("-")){const o=e.split("-");if(3===o.length)return`${o[2]}/${o[1]}/${o[0]}`}if(e.includes("/")&&!e.includes("T"))return e;const o=new Date(e);if(!isNaN(o.getTime())){const e=o.getDate().toString().padStart(2,"0"),n=(o.getMonth()+1).toString().padStart(2,"0"),a=o.getFullYear();return`${e}/${n}/${a}`}return e}catch(h){return console.error("Error al formatear fecha:",h),e}}o.Ay={saveReservation:i,getReservations:c,updateReservationStatus:l,saveWhatsAppReservation:d,deleteReservation:m,isReservationOlderThan:p}},7051:function(e,o,n){n(4114),n(8111),n(7588);var a=n(953);class t{constructor(){this.events=(0,a.Kh)({})}on(e,o){this.events[e]||(this.events[e]=[]),this.events[e].push(o)}off(e,o){if(this.events[e])if(o){const n=this.events[e].indexOf(o);n>-1&&this.events[e].splice(n,1)}else this.events[e]=[]}emit(e,o){this.events[e]&&this.events[e].forEach((e=>{e(o)}))}}o.A=new t},9098:function(e,o,n){n.d(o,{z:function(){return t}});const a=(e,o=800,n=.7)=>new Promise(((a,t)=>{try{if(!e||"string"!==typeof e)return console.warn("La imagen no es v√°lida para compresi√≥n"),void a(e);const t=new Image;t.onload=()=>{const r=document.createElement("canvas");let s=t.width,i=t.height;s>o&&(i=Math.round(i*o/s),s=o),r.width=s,r.height=i;const c=r.getContext("2d");c.drawImage(t,0,0,s,i);const l=r.toDataURL("image/jpeg",n);l.length<e.length?(console.log(`Imagen comprimida: ${Math.round(l.length/1024)}KB (original: ${Math.round(e.length/1024)}KB)`),a(l)):(console.log("La compresi√≥n no redujo el tama√±o, manteniendo original"),a(e))},t.onerror=()=>{console.warn("Error al cargar la imagen para compresi√≥n"),a(e)},e.startsWith("data:image")?t.src=e:t.src="data:image/jpeg;base64,"+e}catch(r){console.error("Error en la compresi√≥n de imagen:",r),a(e)}})),t=async(e,o=500)=>{try{if(!e||"string"!==typeof e)return e;const n=Math.round(e.length/1024);if(n<=o)return e;console.log(`Optimizando imagen de ${n}KB (m√°ximo: ${o}KB)`);let t=.7;n>3*o?t=.5:n>2*o&&(t=.6);let r=await a(e,800,t);return r.length/1024>o&&(r=await a(r,600,.5)),r.length/1024>o&&(r=await a(r,400,.4)),r}catch(n){return console.error("Error al optimizar imagen:",n),e}}},9864:function(e,o,n){var a=n(3751),t=n(641),r=n(33),s=n(532),i=n.p+"img/moon.ef46db37.svg";const c={key:0,class:"ws-status reconnecting"},l={key:1,class:"ws-status error"},d={key:2,class:"main-nav"},u={class:"nav-container"},m={class:"nav-links"},p={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"20",height:"20",class:"theme-icon"},g={key:1,src:s,alt:"Modo claro",class:"theme-icon"},h={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"20",height:"20",class:"theme-icon"},f={key:1,src:i,alt:"Modo oscuro",class:"theme-icon"};function v(e,o,n,s,i,v){const b=(0,t.g2)("router-link"),w=(0,t.g2)("router-view"),y=(0,t.g2)("WhatsAppReservationHandler"),E=(0,t.g2)("WhatsAppSimulator"),k=(0,t.g2)("DialogContainer");return(0,t.uX)(),(0,t.CE)("div",{id:"app",class:(0,r.C4)({"dark-mode":i.isDarkMode})},[v.wsState.reconnecting?((0,t.uX)(),(0,t.CE)("div",c,[o[4]||(o[4]=(0,t.Lk)("span",{class:"loading-spinner"},null,-1)),(0,t.eW)(" Reconectando... (Intento "+(0,r.v_)(v.wsState.reconnectAttempts)+" de "+(0,r.v_)(v.wsState.maxReconnectAttempts)+") ",1),(0,t.Lk)("button",{onClick:o[0]||(o[0]=(...e)=>v.stopReconnecting&&v.stopReconnecting(...e)),class:"reconnect-btn stop-btn"},"Cancelar")])):v.wsState.error?((0,t.uX)(),(0,t.CE)("div",l,[o[5]||(o[5]=(0,t.Lk)("span",{class:"error-icon"},"‚ö†Ô∏è",-1)),(0,t.eW)(" Error de conexi√≥n: "+(0,r.v_)(v.wsState.error)+" ",1),(0,t.Lk)("button",{onClick:o[1]||(o[1]=(...e)=>v.handleReconnect&&v.handleReconnect(...e)),class:"reconnect-btn"},"Reconectar")])):(0,t.Q3)("",!0),v.showNav?((0,t.uX)(),(0,t.CE)("nav",d,[(0,t.Lk)("div",u,[(0,t.bF)(b,{to:"/",class:"nav-logo"},{default:(0,t.k6)((()=>o[6]||(o[6]=[(0,t.eW)("WebSAP")]))),_:1}),(0,t.Lk)("div",m,[(0,t.bF)(b,{to:"/"},{default:(0,t.k6)((()=>o[7]||(o[7]=[(0,t.eW)("Inicio")]))),_:1}),(0,t.bF)(b,{to:"/about"},{default:(0,t.k6)((()=>o[8]||(o[8]=[(0,t.eW)("Acerca de")]))),_:1}),i.isLoggedIn?((0,t.uX)(),(0,t.CE)(t.FK,{key:0},[(0,t.bF)(b,{to:"/menu"},{default:(0,t.k6)((()=>o[9]||(o[9]=[(0,t.eW)("Men√∫")]))),_:1}),v.isSuperAdmin?((0,t.uX)(),(0,t.Wv)(b,{key:0,to:"/superadmin"},{default:(0,t.k6)((()=>o[10]||(o[10]=[(0,t.eW)("Admin")]))),_:1})):(0,t.Q3)("",!0),v.isEmployee?((0,t.uX)(),(0,t.Wv)(b,{key:1,to:"/employee"},{default:(0,t.k6)((()=>o[11]||(o[11]=[(0,t.eW)("Panel Empleado")]))),_:1})):(0,t.Q3)("",!0),(0,t.Lk)("a",{href:"#",onClick:o[2]||(o[2]=(0,a.D$)(((...e)=>v.logout&&v.logout(...e)),["prevent"]))},"Cerrar Sesi√≥n")],64)):((0,t.uX)(),(0,t.CE)(t.FK,{key:1},[(0,t.bF)(b,{to:"/login"},{default:(0,t.k6)((()=>o[12]||(o[12]=[(0,t.eW)("Iniciar Sesi√≥n")]))),_:1}),(0,t.bF)(b,{to:"/register"},{default:(0,t.k6)((()=>o[13]||(o[13]=[(0,t.eW)("Registrarse")]))),_:1})],64)),(0,t.Lk)("button",{onClick:o[3]||(o[3]=(...e)=>v.toggleDarkMode&&v.toggleDarkMode(...e)),class:"dark-mode-toggle","aria-label":"Cambiar modo oscuro"},[i.isDarkMode?((0,t.uX)(),(0,t.CE)(t.FK,{key:0},[i.svgFallback?((0,t.uX)(),(0,t.CE)("svg",p,o[14]||(o[14]=[(0,t.Lk)("path",{fill:"currentColor",d:"M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.697 7.758a.75.75 0 001.06-1.061l-1.59-1.591a.75.75 0 00-1.061 1.06l1.59 1.591z"},null,-1)]))):((0,t.uX)(),(0,t.CE)("img",g))],64)):((0,t.uX)(),(0,t.CE)(t.FK,{key:1},[i.svgFallback?((0,t.uX)(),(0,t.CE)("svg",h,o[15]||(o[15]=[(0,t.Lk)("path",{fill:"currentColor",d:"M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 003.463-.69.75.75 0 01.981.98 10.503 10.503 0 01-9.694 6.46c-5.799 0-10.5-4.701-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 01.818.162z"},null,-1)]))):((0,t.uX)(),(0,t.CE)("img",f))],64))])])])])):(0,t.Q3)("",!0),(0,t.bF)(w),(0,t.bF)(y,{ref:"whatsappHandler"},null,512),(0,t.bF)(E),(0,t.bF)(k)],2)}n(4114);const b={key:0,class:"dialog-overlay"},w={class:"dialog-container"},y={class:"dialog-header"},E={class:"dialog-content"},k={class:"dialog-footer"};function S(e,o,n,a,s,i){return(0,t.uX)(),(0,t.CE)("div",null,[a.dialogState.show?((0,t.uX)(),(0,t.CE)("div",b,[(0,t.Lk)("div",w,[(0,t.Lk)("div",y,[(0,t.Lk)("h3",null,(0,r.v_)(a.dialogState.title),1)]),(0,t.Lk)("div",E,[(0,t.Lk)("p",null,(0,r.v_)(a.dialogState.message),1)]),(0,t.Lk)("div",k,[a.dialogState.showCancel?((0,t.uX)(),(0,t.CE)("button",{key:0,onClick:o[0]||(o[0]=(...e)=>a.handleCancel&&a.handleCancel(...e)),class:"dialog-button cancel-button"},(0,r.v_)(a.dialogState.cancelText),1)):(0,t.Q3)("",!0),(0,t.Lk)("button",{onClick:o[1]||(o[1]=(...e)=>a.handleConfirm&&a.handleConfirm(...e)),class:"dialog-button confirm-button"},(0,r.v_)(a.dialogState.confirmText),1)])])])):(0,t.Q3)("",!0)])}var A=n(4887),I={name:"DialogContainer",setup(){return{dialogState:A.qf,handleConfirm:A.L3,handleCancel:A.zz}}},$=n(6262);const P=(0,$.A)(I,[["render",S]]);var L=P,R=n(953),C=n(6429),z=n(7051);const T={style:{display:"none"}};var D={__name:"WhatsAppReservationHandler",setup(e,{expose:o}){const n=(0,R.KR)(!1),a=(0,R.KR)(""),r=async e=>{try{if(e===a.value)return void console.log("Mensaje ya procesado, ignorando duplicado:",e);console.log("Procesando mensaje de WhatsApp:",e),n.value=!0,a.value=e;const o=s(e);if(!o)return void console.warn("No se pudo extraer informaci√≥n de reserva del mensaje:",e);console.log("Datos extra√≠dos del mensaje:",o);const t=await(0,C.sb)(o);t.success?(console.log("Reserva de WhatsApp guardada correctamente:",t.reservation),z.A.emit("nueva-reserva",t.reservation),z.A.emit("refresh-reservations"),console.log("Eventos emitidos: nueva-reserva y refresh-reservations")):console.error("Error al guardar reserva de WhatsApp:",t.error)}catch(o){console.error("Error al procesar mensaje de WhatsApp:",o)}finally{n.value=!1}},s=e=>{try{const o=e.match(/\*Nombre:\*\s*([^\n]+)/i),n=e.match(/\*Tel√©fono m√≥vil:\*\s*([^\n]+)/i),a=e.match(/\*Fecha:\*\s*([^\n]+)/i),t=e.match(/\*Hora:\*\s*([^\n]+)/i),r=e.match(/\*Personas:\*\s*([^\n]+)/i),s=e.match(/\*Notas:\*\s*([^\n]+)/i),i=e.match(/\*Email:\*\s*([^\n]+)/i);return o||n?{nombre:o?o[1].trim():"Cliente sin nombre",telefono:n?n[1].trim():"",email:i?i[1].trim():"",fecha:a?a[1].trim():(new Date).toISOString().split("T")[0],hora:t?t[1].trim():"19:00",personas:r&&parseInt(r[1].trim(),10)||2,notas:s?s[1].trim():"Reserva desde WhatsApp"}:(console.warn("El mensaje no contiene informaci√≥n suficiente para una reserva"),null)}catch(o){return console.error("Error al extraer datos del mensaje:",o),null}},i=e=>{console.log("Mensaje de WhatsApp simulado recibido"),r(e)};return(0,t.sV)((()=>{console.log("WhatsAppReservationHandler montado"),z.A.on("whatsapp-message",i)})),(0,t.hi)((()=>{console.log("WhatsAppReservationHandler desmontado"),z.A.off("whatsapp-message",i)})),o({processWhatsAppMessage:r,simulateWhatsAppMessage:i}),(e,o)=>((0,t.uX)(),(0,t.CE)("div",T,o[0]||(o[0]=[(0,t.Lk)("p",null,"Manejador de reservas de WhatsApp activo",-1)])))}};const x=D;var _=x,M=n(5220);const N={key:0,class:"whatsapp-simulator"},O={key:0},j={key:1},W={key:0,class:"simulator-panel"},F={class:"form-group"},U={class:"form-group"},B={class:"form-group"},V={class:"form-group"},q={class:"form-group"},X={class:"form-group"},H={class:"form-group"},K={class:"buttons"},J=["disabled"];var Q={__name:"WhatsAppSimulator",setup(e,{expose:o}){const n=(0,M.lq)(),s=(0,R.KR)(!1),i=(0,R.KR)(!1),c=(0,R.KR)(null),l=(0,R.KR)(!1),d=(0,t.EW)((()=>{const e="login"===n.name,o="/login"===n.path||"/login/"===n.path;return console.log(`WhatsAppSimulator - Route check: name=${n.name}, path=${n.path}, isLoginRoute=${e}, isLoginPath=${o}`),e||o})),u=(0,t.EW)((()=>"shared-menu"===n.name||n.path.startsWith("/menu/"))),m=(0,t.EW)((()=>{const e=!d.value&&!u.value,o=e&&l.value;return console.log(`WhatsAppSimulator - Visibility check: isLoginPage=${d.value}, isSharedMenuView=${u.value}, shouldShow=${o}`),o})),p=e=>{console.log(`WhatsAppSimulator - Config changed: button enabled = ${e}`),l.value=e};(0,t.sV)((()=>{console.log(`WhatsAppSimulator - Component mounted on route: ${n.name} (${n.path})`);const e=localStorage.getItem("whatsappButtonEnabled");null!==e&&(l.value="true"===e,console.log(`WhatsAppSimulator - Loaded config: button enabled = ${l.value}`)),z.A.on("whatsapp-button-config-changed",p)})),(0,t.hi)((()=>{z.A.off("whatsapp-button-config-changed",p)}));const g=(0,R.Kh)({nombre:"",telefono:"",email:"",fecha:(new Date).toISOString().split("T")[0],hora:"20:00",personas:2,notas:""}),h=()=>{s.value=!s.value},f=async()=>{try{if(i.value=!0,c.value={type:"info",message:"Enviando reserva..."},!g.nombre||!g.telefono)return alert("Por favor, completa al menos el nombre y tel√©fono"),void(c.value={type:"error",message:"Faltan datos obligatorios"});console.log("Enviando reserva desde WhatsApp Simulator:",g);const e=`\n*NUEVA RESERVA DE MESA*\n---------------------------\n*Nombre:* ${g.nombre}\n*Tel√©fono m√≥vil:* ${g.telefono}\n${g.email?`*Email:* ${g.email}`:""}\n*Fecha:* ${g.fecha}\n*Hora:* ${g.hora}\n*Personas:* ${g.personas}\n${g.notas?`*Notas:* ${g.notas}`:""}\n---------------------------\nReserva enviada desde WhatsApp Simulator\n`;console.log("Emitiendo evento whatsapp-message con el mensaje:",e),z.A.emit("whatsapp-message",e),console.log("Emitiendo evento refresh-reservations"),z.A.emit("refresh-reservations"),c.value={type:"success",message:"Reserva enviada correctamente"},v()}catch(e){console.error("Error al enviar reserva:",e),c.value={type:"error",message:"Error al enviar la reserva: "+e.message}}finally{i.value=!1,setTimeout((()=>{c.value=null}),5e3)}},v=()=>{g.nombre="",g.telefono="",g.email="",g.fecha=(new Date).toISOString().split("T")[0],g.hora="20:00",g.personas=2,g.notas=""};return o({toggleSimulator:h,sendReservation:f}),(e,o)=>m.value?((0,t.uX)(),(0,t.CE)("div",N,[(0,t.Lk)("button",{onClick:h,class:"toggle-button"},[s.value?((0,t.uX)(),(0,t.CE)("span",O,"‚ùå Cerrar Simulador")):((0,t.uX)(),(0,t.CE)("span",j,"üì± Simular WhatsApp"))]),s.value?((0,t.uX)(),(0,t.CE)("div",W,[o[16]||(o[16]=(0,t.Lk)("h3",null,"Simulador de Reservas WhatsApp",-1)),(0,t.Lk)("div",F,[o[7]||(o[7]=(0,t.Lk)("label",{for:"nombre"},"Nombre:",-1)),(0,t.bo)((0,t.Lk)("input",{type:"text",id:"nombre","onUpdate:modelValue":o[0]||(o[0]=e=>g.nombre=e),placeholder:"Nombre del cliente"},null,512),[[a.Jo,g.nombre]])]),(0,t.Lk)("div",U,[o[8]||(o[8]=(0,t.Lk)("label",{for:"telefono"},"Tel√©fono:",-1)),(0,t.bo)((0,t.Lk)("input",{type:"text",id:"telefono","onUpdate:modelValue":o[1]||(o[1]=e=>g.telefono=e),placeholder:"612345678"},null,512),[[a.Jo,g.telefono]])]),(0,t.Lk)("div",B,[o[9]||(o[9]=(0,t.Lk)("label",{for:"email"},"Email:",-1)),(0,t.bo)((0,t.Lk)("input",{type:"email",id:"email","onUpdate:modelValue":o[2]||(o[2]=e=>g.email=e),placeholder:"cliente@example.com"},null,512),[[a.Jo,g.email]])]),(0,t.Lk)("div",V,[o[10]||(o[10]=(0,t.Lk)("label",{for:"fecha"},"Fecha:",-1)),(0,t.bo)((0,t.Lk)("input",{type:"date",id:"fecha","onUpdate:modelValue":o[3]||(o[3]=e=>g.fecha=e)},null,512),[[a.Jo,g.fecha]])]),(0,t.Lk)("div",q,[o[12]||(o[12]=(0,t.Lk)("label",{for:"hora"},"Hora:",-1)),(0,t.bo)((0,t.Lk)("select",{id:"hora","onUpdate:modelValue":o[4]||(o[4]=e=>g.hora=e)},o[11]||(o[11]=[(0,t.Fv)('<option value="13:00" data-v-40696f3f>13:00</option><option value="13:30" data-v-40696f3f>13:30</option><option value="14:00" data-v-40696f3f>14:00</option><option value="14:30" data-v-40696f3f>14:30</option><option value="20:00" data-v-40696f3f>20:00</option><option value="20:30" data-v-40696f3f>20:30</option><option value="21:00" data-v-40696f3f>21:00</option><option value="21:30" data-v-40696f3f>21:30</option>',8)]),512),[[a.u1,g.hora]])]),(0,t.Lk)("div",X,[o[14]||(o[14]=(0,t.Lk)("label",{for:"personas"},"Personas:",-1)),(0,t.bo)((0,t.Lk)("select",{id:"personas","onUpdate:modelValue":o[5]||(o[5]=e=>g.personas=e)},o[13]||(o[13]=[(0,t.Lk)("option",{value:1},"1 persona",-1),(0,t.Lk)("option",{value:2},"2 personas",-1),(0,t.Lk)("option",{value:3},"3 personas",-1),(0,t.Lk)("option",{value:4},"4 personas",-1),(0,t.Lk)("option",{value:5},"5 personas",-1),(0,t.Lk)("option",{value:6},"6 personas",-1),(0,t.Lk)("option",{value:8},"8 personas",-1)]),512),[[a.u1,g.personas]])]),(0,t.Lk)("div",H,[o[15]||(o[15]=(0,t.Lk)("label",{for:"notas"},"Notas:",-1)),(0,t.bo)((0,t.Lk)("textarea",{id:"notas","onUpdate:modelValue":o[6]||(o[6]=e=>g.notas=e),placeholder:"Notas adicionales"},null,512),[[a.Jo,g.notas]])]),(0,t.Lk)("div",K,[(0,t.Lk)("button",{onClick:f,class:"send-button",disabled:i.value},"Enviar Reserva",8,J)]),c.value?((0,t.uX)(),(0,t.CE)("div",{key:0,class:(0,r.C4)(["status",c.value.type])},(0,r.v_)(c.value.message),3)):(0,t.Q3)("",!0)])):(0,t.Q3)("",!0)])):(0,t.Q3)("",!0)}};const G=(0,$.A)(Q,[["__scopeId","data-v-40696f3f"]]);var Y=G;function Z(e={}){try{const o={nombre:"Cliente de Prueba WhatsApp",telefono:"612345678",email:"whatsapp@example.com",fecha:(new Date).toISOString().split("T")[0],hora:"20:00",personas:2,notas:"Reserva realizada desde WhatsApp"},n={...o,...e};console.log(" Simulando mensaje de WhatsApp con datos:",n);const a={type:"whatsapp_reservation",reservation:n,timestamp:Date.now(),id:"whatsapp_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)};return z.A.emit("whatsapp_message",a),setTimeout((()=>{z.A.emit("refresh-reservations")}),1e3),console.log(" Simulaci√≥n de mensaje de WhatsApp completada"),!0}catch(o){return console.error(" Error al simular mensaje de WhatsApp:",o),!1}}window.testWhatsAppReservation=Z;function ee(){const e=["Juan P√©rez","Mar√≠a Garc√≠a","Carlos Rodr√≠guez","Ana Mart√≠nez","Luis L√≥pez","Laura S√°nchez","Pedro Gonz√°lez","Sof√≠a Fern√°ndez"],o=["612345678","623456789","634567890","645678901","656789012","667890123","678901234","689012345"],n=[],a=new Date;for(let s=1;s<=7;s++){const e=new Date(a);e.setDate(a.getDate()+s),n.push(e.toISOString().split("T")[0])}const t=["13:00","13:30","14:00","14:30","20:00","20:30","21:00","21:30"],r=[1,2,2,2,3,4,5,6,8];return{nombre:e[Math.floor(Math.random()*e.length)],telefono:o[Math.floor(Math.random()*o.length)],email:Math.random()>.5?`cliente${Math.floor(100*Math.random())}@example.com`:"",fecha:n[Math.floor(Math.random()*n.length)],hora:t[Math.floor(Math.random()*t.length)],personas:r[Math.floor(Math.random()*r.length)],notas:Math.random()>.7?"Mesa cerca de la ventana si es posible":Math.random()>.5?"Celebraci√≥n de cumplea√±os":Math.random()>.3?"Alergias: gluten":""}}function oe(){const e=ee();return console.log("Enviando reserva aleatoria:",e),Z(e)}function ne(e=3,o=2e3){console.log(`Enviando ${e} reservas aleatorias con intervalo de ${o}ms`);let n=0;const a=()=>{n<e?(oe(),n++,setTimeout(a,o)):console.log(`‚úÖ ${e} reservas enviadas correctamente`)};a()}window.testReservations={random:oe,multiple:ne,generate:ee};const ae=(0,R.Kh)({connected:!1,reconnecting:!1,error:null,reconnectAttempts:0,maxReconnectAttempts:5,socket:null,messages:[],enableWebsocket:!1});let te={reconnectInterval:2e3,reconnectAttempts:5},re=null;function se(e,o={}){if(te={...te,...o},ae.maxReconnectAttempts=te.reconnectAttempts,"WebSocket"in window){0,ae.socket&&ae.socket.close();try{ae.reconnecting=!1,ae.error=null,console.log(`Intentando conectar a WebSocket: ${e}`);const o=new WebSocket(e);o.onopen=()=>{console.log("Conexi√≥n WebSocket establecida"),ae.connected=!0,ae.reconnecting=!1,ae.error=null,ae.reconnectAttempts=0},o.onmessage=e=>{try{const o=JSON.parse(e.data);ae.messages.push(o),console.log("Mensaje recibido:",o)}catch(o){console.error("Error al parsear mensaje WebSocket:",e.data)}},o.onclose=e=>{ae.connected=!1,e.wasClean?console.log("Conexi√≥n WebSocket cerrada"):(console.log("Conexi√≥n WebSocket cerrada inesperadamente"),ce())},o.onerror=e=>{console.error("Error WebSocket:",e),ae.error="Error de conexi√≥n",ae.connected=!1,ae.reconnecting||ce()},ae.socket=o}catch(n){console.error("Error al inicializar WebSocket:",n),ae.error=`Error al inicializar: ${n.message}`,ae.connected=!1,ce()}}else console.warn("Este navegador no soporta WebSocket")}function ie(){ae.enableWebsocket=!1,ae.socket&&ue(),console.log("WebSocket deshabilitado")}function ce(){if(re&&clearTimeout(re),ae.reconnectAttempts>=ae.maxReconnectAttempts)return console.log("N√∫mero m√°ximo de reconexiones alcanzado"),void(ae.reconnecting=!1);ae.enableWebsocket,ae.reconnecting=!0,ae.reconnectAttempts++,console.log(`Programando reconexi√≥n ${ae.reconnectAttempts}/${ae.maxReconnectAttempts} en ${te.reconnectInterval}ms`),re=setTimeout((()=>{ae.socket&&ae.socket.url&&(console.log("Intentando reconexi√≥n..."),se(ae.socket.url))}),te.reconnectInterval)}function le(){ae.socket&&ae.socket.url&&se(ae.socket.url)}function de(){re&&clearTimeout(re),ae.reconnecting=!1,console.log("Intentos de reconexi√≥n detenidos")}function ue(){if(de(),ae.socket){try{ae.socket.close()}catch(e){console.error("Error al cerrar WebSocket:",e)}ae.socket=null}ae.connected=!1,console.log("Conexi√≥n WebSocket cerrada manualmente")}var me=n(981),pe=n(4216),ge=n(9098),he=n(4640);n(7642),n(8004),n(3853),n(5876),n(2475),n(5024),n(1698);let fe=navigator.onLine,ve=!1,be=!1,we="true"===localStorage.getItem("offlineMode");const ye=async()=>{if(be)return ve;be=!0,console.log("üîÑ Probando conexi√≥n con la API...");const e=[he.A.API_DOMAIN,"https://websap-backend.onrender.com","https://allseo.xyz","https://api.websap.app","http://localhost:3000"],o=[...new Set(e)];for(const a of o)try{console.log(`üîç Probando API en: ${a}`);const e=new AbortController,o=setTimeout((()=>e.abort()),3e3),n=await fetch(`${a}/api/test/ping`,{method:"GET",signal:e.signal,headers:{Accept:"application/json"},mode:"cors",credentials:"omit"});if(clearTimeout(o),n.ok)return console.log(`‚úÖ Conexi√≥n exitosa con: ${a}`),localStorage.setItem("apiUrl",a),ve=!0,we=!1,localStorage.setItem("offlineMode","false"),be=!1,!0}catch(n){console.warn(`‚ùå Error al conectar con ${a}:`,"AbortError"===n.name?"Timeout":n.message)}return console.error("‚ùå No se pudo conectar con ning√∫n servidor API"),ve=!1,we=!0,localStorage.setItem("offlineMode","true"),be=!1,!1},Ee=()=>{window.addEventListener("online",(async()=>{fe=!0,console.log("üåê Conexi√≥n a Internet detectada");const e=await ye();window.dispatchEvent(new CustomEvent("api-connection-change",{detail:{connected:e}}))})),window.addEventListener("offline",(()=>{fe=!1,ve=!1,console.log("üîå Conexi√≥n a Internet perdida"),window.dispatchEvent(new CustomEvent("api-connection-change",{detail:{connected:!1}}))})),setTimeout((()=>{ye().then((e=>{window.dispatchEvent(new CustomEvent("api-connection-change",{detail:{connected:e}}))}))}),1e3)};Ee();const ke=()=>{const e=localStorage.getItem("apiUrl");return e?{API_URL:`${e}/api`,RAW_URL:`${e}/raw`}:{API_URL:he.A.API_URL,RAW_URL:he.A.RAW_URL}};let{API_URL:Se,RAW_URL:Ae}=ke();const Ie=()=>{const e=ke();Se=e.API_URL,Ae=e.RAW_URL,console.log("üîÑ URLs de API actualizadas:",{API_URL:Se,RAW_URL:Ae})};window.addEventListener("api-connection-change",(e=>{console.log("üåê Estado de conexi√≥n API cambiado:",e.detail.connected),Ie()}));const $e={skipServerAvailabilityCheck:!0,maxPlatoSize:3e4,retryIntervals:[5e3,15e3,3e4],maxRetries:2,platoUrl:`${Se}/sync/platos`,emergencyPlatoUrl:`${Se}/platos/minimal`,useEmergencyEndpoint:!0};let Pe=!1,Le=navigator.onLine;const Re=async()=>{if(!navigator.onLine)return!1;try{await fetch(`${Se}/favicon.ico`,{method:"HEAD",mode:"no-cors",cache:"no-store",credentials:"omit"});return!0}catch(e){return console.error("Error al verificar estado de conexi√≥n:",e),!1}},Ce=()=>{window.addEventListener("online",(async()=>{console.log("Evento online detectado"),Le=await Re(),Le&&(console.log("Conexi√≥n a Internet restablecida"),De())})),window.addEventListener("offline",(()=>{console.log("Evento offline detectado"),Le=!1,console.log("Conexi√≥n a Internet perdida")})),Re().then((e=>{console.log("Estado inicial de conexi√≥n: "+(e?"En l√≠nea":"Fuera de l√≠nea"))}))},ze=async()=>{console.log("üîÑ Probando conexi√≥n con el servidor (modo emergencia)...");try{const e=new XMLHttpRequest,o=new Promise((o=>{const n=setTimeout((()=>{console.warn("‚è±Ô∏è Timeout en la prueba de conexi√≥n"),e.abort(),o(!1)}),5e3);e.onreadystatechange=function(){4===e.readyState&&(clearTimeout(n),e.status>=200&&e.status<300?(console.log("‚úÖ Conexi√≥n b√°sica establecida"),o(!0)):431===e.status?(console.error("‚ùå Error 431: Request Header Fields Too Large"),console.log("üëâ Necesitas reducir el tama√±o de las cookies o headers"),o(!1)):(console.error(`‚ùå Error en prueba de conexi√≥n: ${e.status}`),o(!1)))},e.onerror=function(){clearTimeout(n),console.error("‚ùå Error de red en prueba de conexi√≥n"),Te().then(o)},e.open("GET",`${Se}/test/ping`,!0),e.withCredentials=!1,e.send()}));return await o}catch(e){return console.error("‚ùå Error en prueba de conexi√≥n:",e),!1}},Te=async()=>{console.log("üîÑ Probando puertos alternativos...");const e=[8080,3e3,5e3,8e3];for(const n of e)try{console.log(`Probando en puerto: ${n}`);const e=await fetch(`http://localhost:${n}/raw/ping`,{method:"GET",mode:"no-cors",cache:"no-store",credentials:"omit"});if(e.ok||0===e.status)return console.log(`‚úÖ Servidor encontrado en puerto ${n}`),window.SERVER_PORT=n,!0}catch(o){console.log(`Puerto ${n} no disponible`)}return console.error("‚ùå No se encontr√≥ el servidor en ning√∫n puerto com√∫n"),!1},De=async()=>{if(!await Re())return console.log("Sin conexi√≥n a Internet, la sincronizaci√≥n no es posible"),!1;if(Pe)return console.log("Ya hay una sincronizaci√≥n en progreso"),!1;Pe=!0,console.log("üîÑ Iniciando sincronizaci√≥n de datos...");try{const o=await(0,pe.Hk)();console.log(`üìã Cola de sincronizaci√≥n: ${o.length} elementos`);for(const a of o)if("plato"===a.entityType){const o=await(0,pe.Ds)(a.entityId);if(o){console.log(`üçΩÔ∏è Sincronizando plato: ${o.name} (${o.id})`);try{const e=await je(o);e.success?(console.log(`‚úÖ Plato ${o.id} sincronizado correctamente`),await(0,pe.vh)(a.id)):console.error(`‚ùå Error al sincronizar plato ${o.id}`)}catch(e){console.error(`‚ùå Excepci√≥n al sincronizar plato ${o.id}:`,e)}}else console.warn(`‚ö†Ô∏è Plato ${a.entityId} no encontrado en IndexedDB`),await(0,pe.vh)(a.id)}console.log("üîç Buscando platos pendientes de sincronizaci√≥n...");const n=await(0,pe.Fk)();console.log(`üìã Platos pendientes: ${n.length}`);for(const a of n)try{console.log(`üçΩÔ∏è Sincronizando plato pendiente: ${a.name} (${a.id})`);const e=await je(a);e.success?console.log(`‚úÖ Plato pendiente ${a.id} sincronizado correctamente`):console.error(`‚ùå Error al sincronizar plato pendiente ${a.id}: ${e.error}`)}catch(e){console.error(`‚ùå Excepci√≥n al sincronizar plato pendiente ${a.id}: ${e}`)}return console.log("‚úÖ Sincronizaci√≥n completada"),!0}catch(o){return console.error("‚ùå Error durante la sincronizaci√≥n:",o),!1}finally{Pe=!1}},xe=async(e,o)=>{try{console.log("üö® Intentando sincronizaci√≥n ultra-minimal para plato:",o);const n=new XMLHttpRequest,a=new Promise((e=>{const a=setTimeout((()=>{console.warn("‚è±Ô∏è Timeout en sincronizaci√≥n ultra-minimal"),n.abort(),e(!1)}),15e3);n.onreadystatechange=async function(){if(4===n.readyState)if(clearTimeout(a),n.status>=200&&n.status<300){console.log("‚úÖ Sincronizaci√≥n ultra-minimal exitosa");try{await(0,pe.rM)(o,"synced")}catch(t){console.error("Error al actualizar estado en BD:",t)}e(!0)}else console.error(`‚ùå Error en sincronizaci√≥n ultra-minimal: ${n.status}`),e(!1)},n.onerror=function(){clearTimeout(a),console.error("‚ùå Error de red en sincronizaci√≥n ultra-minimal"),e(!1)}}));n.open("POST",`${Se}/platos/emergency-sync`,!0),n.setRequestHeader("Content-Type","application/json");const t=await We(e),r={id:t.id,name:(t.name||"").substring(0,30),price:Number(t.price)||0};return n.send(JSON.stringify(r)),await a}catch(n){return console.error("‚ùå Error en sincronizaci√≥n ultra-minimal:",n),!1}},_e=async(e,o,n=0)=>{const a=$e.maxRetries,t=await We(e),r={id:t.id,name:t.name?.substring(0,50)||"Plato sin nombre",price:Number(t.price)||0,description:t.description?.substring(0,100)||"",category:t.category||"principal",image:t.image,is_available:Boolean(t.is_available),minimal_sync:!0};return new Promise((s=>{const i=setTimeout((()=>{console.warn("‚è±Ô∏è Timeout global de la operaci√≥n de sincronizaci√≥n"),s(!1)}),3e4),c=new XMLHttpRequest;c.timeout=15e3,c.onreadystatechange=async function(){if(4===c.readyState)if(c.status>=200&&c.status<300){clearTimeout(i);try{await(0,pe.rM)(o,"synced"),console.log(`‚úÖ Sincronizaci√≥n exitosa para plato ${o}`)}catch(e){console.error("Error al actualizar estado:",e)}s(!0)}else 0===c.status?(console.warn("‚ö†Ô∏è Conexi√≥n interrumpida"),l()):431===c.status?(console.error("‚ùå Error 431 (Headers demasiado grandes) - Intentando m√©todo ultraminimal"),xe(t,o).then((e=>{clearTimeout(i),s(e)}))):(console.error(`‚ùå Error HTTP ${c.status} en sincronizaci√≥n`),l())},c.ontimeout=function(){console.warn("‚è±Ô∏è Timeout de la petici√≥n HTTP"),l()},c.onerror=function(){console.error("‚ùå Error de red en sincronizaci√≥n"),l()};const l=()=>{if(n<a){const t=$e.retryIntervals[n]||5e3;console.log(`üîÑ Reintentando en ${t}ms... (${n+1}/${a})`),setTimeout((()=>{clearTimeout(i),_e(e,o,n+1).then((e=>s(e)))}),t)}else clearTimeout(i),console.warn("‚ùå Agotados todos los reintentos de sincronizaci√≥n"),s(!1)};try{c.open("POST",`${Se}/platos`,!0),c.setRequestHeader("Content-Type","application/json"),c.send(JSON.stringify(r))}catch(d){console.error("‚ùå Error al iniciar la petici√≥n:",d),l()}}))},Me=async()=>{try{console.log("üîÑ Verificando estado de sincronizaci√≥n...");const e=await fetch(`${Se}/sync/status`,{method:"GET",headers:{Accept:"application/json"},credentials:"omit"});if(e.ok){const o=await e.json();return console.log("üìä Estado de sincronizaci√≥n:",o),o.data.mysql.tablaPlatos||(console.log("‚ö†Ô∏è La tabla platos no existe, intentando configurar..."),await Ne()),o.data}return console.error("‚ùå Error al verificar estado de sincronizaci√≥n:",await e.text()),null}catch(e){return console.error("‚ùå Error al verificar estado de sincronizaci√≥n:",e),null}},Ne=async()=>{try{console.log("üîÑ Configurando sincronizaci√≥n...");const e=await fetch(`${Se}/sync/setup`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"omit",body:JSON.stringify({force:!1})});if(e.ok){const o=await e.json();return console.log("‚úÖ Configuraci√≥n de sincronizaci√≥n completada:",o),!0}return console.error("‚ùå Error al configurar sincronizaci√≥n:",await e.text()),!1}catch(e){return console.error("‚ùå Error al configurar sincronizaci√≥n:",e),!1}},Oe=()=>{console.log("üîÑ Inicializando servicio de sincronizaci√≥n..."),Promise.all([ze(),Me()]).then((([e,o])=>{if(console.log(`‚úÖ Estado de conexi√≥n directa - API: ${e}`),e)if(Ce(),o&&o.mysql&&o.mysql.connected){console.log("üìä MySQL conectado, procediendo con sincronizaci√≥n"),De();setInterval(De,6e4)}else console.log("‚ö†Ô∏è MySQL no est√° configurado correctamente, intentando configurar..."),Ne().then((e=>{if(e){console.log("‚úÖ Configuraci√≥n exitosa, iniciando sincronizaci√≥n"),De();setInterval(De,6e4)}}));else console.error("‚ùå No se pudo establecer conexi√≥n con el servidor.")})),console.log("‚öôÔ∏è Servicio de sincronizaci√≥n inicializado")},je=async e=>{console.log(`üîÑ Sincronizando plato: ${e.name} (ID: ${e.id})`);try{const n=await We(e);console.log("üì§ Datos a enviar:",{...n,image:n.image?"Imagen en base64 (omitida en log)":null});const a=$e.platoUrl;console.log(`üîó URL de sincronizaci√≥n: ${a}`);const t=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n),credentials:"omit"});if(!t.ok){const o=await t.text();return console.error(`‚ùå Error de sincronizaci√≥n (${t.status}): ${o}`),t.status>=400?(console.log("‚ö†Ô∏è Intentando sincronizaci√≥n minimalista como fallback..."),await _e(e)):{success:!1,message:`Error de servidor: ${t.status} ${t.statusText}`,error:o}}const r=await t.json();console.log("‚úÖ Sincronizaci√≥n exitosa:",r);try{await(0,pe.rM)(e.id,!0),console.log(`‚úÖ Estado de sincronizaci√≥n actualizado para plato ID: ${e.id}`)}catch(o){console.warn(`‚ö†Ô∏è No se pudo actualizar el estado de sincronizaci√≥n: ${o.message}`)}return{success:!0,message:"Plato sincronizado correctamente",data:r}}catch(n){return console.error("‚ùå Error en sincronizaci√≥n:",n),console.log("‚ö†Ô∏è Intentando sincronizaci√≥n minimalista como fallback..."),await _e(e)}},We=async e=>{const o={...e};if(o.id=e.id,o.name=e.name||"Plato sin nombre",o.price=parseFloat(e.price)||0,o.description=e.description||"",o.category=e.category||"principal",e.image&&"string"===typeof e.image&&e.image.length>0)try{o.image=await(0,ge.z)(e.image),console.log(`Imagen optimizada para ${e.name}`)}catch(n){console.warn(`Error al optimizar imagen para ${e.name}:`,n),o.image=e.image}else o.image=e.image||null;return o.image_url=e.image_url||"",o.is_available=!1!==e.is_available,o.includesDrink=e.includesDrink||!1,o.availableQuantity=e.availableQuantity||0,o};var Fe={name:"App",components:{DialogContainer:L,WhatsAppReservationHandler:_,WhatsAppSimulator:Y},data(){return{isLoggedIn:(0,me.wR)(),isDarkMode:"true"===localStorage.getItem("darkMode"),svgFallback:!1,whatsappHandler:null}},computed:{wsState(){return ae},showNav(){return!this.$route.path.match(/^\/menu\/[^\/]+$/)},isSuperAdmin(){return this.isLoggedIn&&(0,me.hf)("Superadministrador")},isEmployee(){return this.isLoggedIn&&(0,me.hf)("Empleado")}},watch:{$route(){this.isLoggedIn=(0,me.wR)()}},methods:{logout(){(0,me.ri)(),this.isLoggedIn=!1,this.$router.push("/")},toggleDarkMode(){this.isDarkMode=!this.isDarkMode,localStorage.setItem("darkMode",this.isDarkMode),(0,t.dY)((()=>{this.isDarkMode?(document.documentElement.classList.add("dark-mode"),document.body.classList.add("dark-mode")):(document.documentElement.classList.remove("dark-mode"),document.body.classList.remove("dark-mode"))}))},handleReconnect(){le()},stopReconnecting(){stopReconnecting()}},mounted(){const e=new Image;if(e.onerror=()=>{console.warn("Error al cargar im√°genes SVG, usando fallback inline"),this.svgFallback=!0},e.src=n(532),this.isDarkMode&&(document.documentElement.classList.add("dark-mode"),document.body.classList.add("dark-mode")),null===localStorage.getItem("darkMode")){const e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;this.isDarkMode=e,localStorage.setItem("darkMode",e),e&&(document.documentElement.classList.add("dark-mode"),document.body.classList.add("dark-mode"))}ie(),Oe()},unmounted(){ue()}};const Ue=(0,$.A)(Fe,[["render",v]]);var Be=Ue;n(8111),n(3579);const Ve={class:"home-container"},qe={class:"auth-options"},Xe={class:"menu-options"};function He(e,o,n,a,r,s){const i=(0,t.g2)("router-link");return(0,t.uX)(),(0,t.CE)("div",Ve,[o[4]||(o[4]=(0,t.Lk)("h1",null,"Sistema de Gesti√≥n de Men√∫",-1)),(0,t.Lk)("div",qe,[(0,t.bF)(i,{to:"/login",class:"auth-button login"},{default:(0,t.k6)((()=>o[1]||(o[1]=[(0,t.eW)("Iniciar Sesi√≥n")]))),_:1}),(0,t.bF)(i,{to:"/register",class:"auth-button register"},{default:(0,t.k6)((()=>o[2]||(o[2]=[(0,t.eW)("Registrarse")]))),_:1})]),o[5]||(o[5]=(0,t.Fv)('<div class="login-info" data-v-4e8e3a5c><p data-v-4e8e3a5c>Para probar la aplicaci√≥n, puedes usar estas credenciales:</p><ul data-v-4e8e3a5c><li data-v-4e8e3a5c><strong data-v-4e8e3a5c>Email:</strong> superadmin@example.com | <strong data-v-4e8e3a5c>Contrase√±a:</strong>SuperAdmin2023</li><li data-v-4e8e3a5c><strong data-v-4e8e3a5c>Email:</strong> admin@example.com | <strong data-v-4e8e3a5c>Contrase√±a:</strong>Admin2023</li><li data-v-4e8e3a5c><strong data-v-4e8e3a5c>Email:</strong> empleado@example.com | <strong data-v-4e8e3a5c>Contrase√±a:</strong>Empleado2023</li></ul></div>',1)),(0,t.Lk)("div",Xe,[(0,t.Lk)("div",{class:"option-card",onClick:o[0]||(o[0]=(...e)=>a.goToMenu&&a.goToMenu(...e))},o[3]||(o[3]=[(0,t.Lk)("h2",null,"Gestionar Men√∫",-1),(0,t.Lk)("p",null,"Configura tu men√∫, precios y formas de pago",-1)]))])])}var Ke={name:"HomeView",setup(){const e=(0,M.rd)(),o=()=>{e.push("/menu")};return{goToMenu:o}}};const Je=(0,$.A)(Ke,[["render",He],["__scopeId","data-v-4e8e3a5c"]]);var Qe=Je;const Ge={class:"login-container"},Ye={class:"login-card"},Ze={class:"form-group"},eo={class:"form-group"},oo={key:0,class:"error-message"},no=["disabled"],ao={class:"login-options"};function to(e,o,n,s,i,c){const l=(0,t.g2)("router-link");return(0,t.uX)(),(0,t.CE)("div",Ge,[(0,t.Lk)("div",Ye,[o[7]||(o[7]=(0,t.Lk)("h1",{class:"login-title"},"Iniciar Sesi√≥n",-1)),(0,t.Lk)("form",{onSubmit:o[2]||(o[2]=(0,a.D$)(((...e)=>s.handleLogin&&s.handleLogin(...e)),["prevent"])),class:"login-form"},[(0,t.Lk)("div",Ze,[o[4]||(o[4]=(0,t.Lk)("label",{for:"email"},"Correo electr√≥nico",-1)),(0,t.bo)((0,t.Lk)("input",{type:"email",id:"email","onUpdate:modelValue":o[0]||(o[0]=e=>s.email=e),required:"",placeholder:"Ingresa tu correo"},null,512),[[a.Jo,s.email]])]),(0,t.Lk)("div",eo,[o[5]||(o[5]=(0,t.Lk)("label",{for:"password"},"Contrase√±a",-1)),(0,t.bo)((0,t.Lk)("input",{type:"password",id:"password","onUpdate:modelValue":o[1]||(o[1]=e=>s.password=e),required:"",placeholder:"Ingresa tu contrase√±a"},null,512),[[a.Jo,s.password]])]),s.errorMessage?((0,t.uX)(),(0,t.CE)("div",oo,(0,r.v_)(s.errorMessage),1)):(0,t.Q3)("",!0),(0,t.Lk)("button",{type:"submit",disabled:s.isLoading,class:"login-button"},(0,r.v_)(s.isLoading?"Iniciando sesi√≥n...":"Iniciar Sesi√≥n"),9,no)],32),(0,t.Lk)("div",ao,[(0,t.bF)(l,{to:"/register"},{default:(0,t.k6)((()=>o[6]||(o[6]=[(0,t.eW)("¬øNo tienes cuenta? Reg√≠strate")]))),_:1}),(0,t.Lk)("a",{href:"#",onClick:o[3]||(o[3]=(0,a.D$)(((...e)=>s.handleForgotPassword&&s.handleForgotPassword(...e)),["prevent"]))},"¬øOlvidaste tu contrase√±a?")])])])}var ro={name:"LoginView",setup(){const e=(0,M.rd)(),o=((0,M.lq)(),(0,R.KR)("")),n=(0,R.KR)(""),a=(0,R.KR)(!1),t=(0,R.KR)(""),r=async()=>{t.value="",a.value=!0;try{localStorage.clear(),sessionStorage.clear(),console.log("Intentando login con:",o.value);const a=await(0,me.iD)(o.value,n.value);console.log("Login exitoso:",a),localStorage.setItem("isLoggedIn","true"),a.user.roles&&a.user.roles.includes("Superadministrador")?e.push("/superadmin"):a.user.roles&&a.user.roles.includes("Administrador")?e.push("/admin"):e.push("/employee")}catch(r){console.error("Error de login:",r),t.value=r.message||"Error al iniciar sesi√≥n"}finally{a.value=!1}},s=async()=>{await(0,A.xE)("Funci√≥n de recuperaci√≥n de contrase√±a no implementada en esta versi√≥n de demostraci√≥n.")};return{email:o,password:n,isLoading:a,errorMessage:t,handleLogin:r,handleForgotPassword:s}}};const so=(0,$.A)(ro,[["render",to],["__scopeId","data-v-7af9a333"]]);var io=so;const co=[{path:"/",name:"home",component:Qe},{path:"/about",name:"about",component:()=>n.e(594).then(n.bind(n,7633))},{path:"/login",name:"login",component:io,meta:{requiresGuest:!0}},{path:"/register",name:"register",component:()=>n.e(224).then(n.bind(n,8506))},{path:"/menu",name:"menu",component:()=>Promise.all([n.e(207),n.e(854)]).then(n.bind(n,6207)),meta:{requiresAuth:!0}},{path:"/menu/:id",name:"shared-menu",component:()=>Promise.all([n.e(982),n.e(260)]).then(n.bind(n,8109)),props:!0},{path:"/superadmin",name:"superadmin",component:()=>Promise.all([n.e(982),n.e(869),n.e(441)]).then(n.bind(n,3145)),meta:{requiresAuth:!0,roles:["Superadministrador"]}},{path:"/admin",name:"admin",component:()=>Promise.all([n.e(982),n.e(207),n.e(869),n.e(70),n.e(970),n.e(884)]).then(n.bind(n,6296)),meta:{requiresAuth:!0,roles:["Administrador","Superadministrador"]}},{path:"/admin/sync-business-info",name:"sync-business-info",component:()=>Promise.all([n.e(982),n.e(70),n.e(838)]).then(n.bind(n,4070)),meta:{requiresAuth:!0,roles:["Administrador","Superadministrador"]}},{path:"/employee",name:"employee",component:()=>Promise.all([n.e(207),n.e(970),n.e(83)]).then(n.bind(n,4398)),meta:{requiresAuth:!0,roles:["Empleado"]}},{path:"/platos",name:"platos",component:()=>n.e(770).then(n.bind(n,2054)),meta:{requiresAuth:!0,roles:["Administrador","Superadministrador"]}},{path:"/admin/usuarios",name:"admin-usuarios",component:()=>n.e(654).then(n.bind(n,2995)),meta:{requiresAuth:!0,roles:["Administrador","Superadministrador"]}},{path:"/admin/restaurantes",name:"admin-restaurantes",component:()=>n.e(328).then(n.bind(n,1929)),meta:{requiresAuth:!0,roles:["Administrador","Superadministrador"]}},{path:"/reservas",name:"reservas",component:()=>n.e(140).then(n.bind(n,1641)),meta:{requiresAuth:!0,roles:["Administrador","Superadministrador","Empleado"]}},{path:"/:pathMatch(.*)*",name:"notFound",component:()=>n.e(463).then(n.bind(n,2463))}],lo=(0,M.aE)({history:(0,M.LA)("/websap/"),routes:co});lo.beforeEach((async(e,o,n)=>{const a=e.matched.some((e=>e.meta.requiresAuth)),t=e.matched.some((e=>e.meta.requiresGuest)),r=e.meta.roles;if("/login"===e.path&&(localStorage.removeItem("user"),localStorage.removeItem("isLoggedIn"),(0,me.eF)()),a&&!(0,me.wR)())await(0,A.xE)("Debe iniciar sesi√≥n para acceder a esta p√°gina",{title:"Acceso Restringido"}),n({name:"login"});else if(t&&(0,me.wR)()){const e=(0,me.HW)();e&&e.roles?e.roles.includes("Superadministrador")?n({name:"superadmin"}):e.roles.includes("Administrador")?n({name:"admin"}):n({name:"employee"}):n({name:"home"})}else if(r&&(0,me.wR)()){const e=r.some((e=>(0,me.hf)(e)));e?n():(await(0,A.xE)("No tiene permisos para acceder a esta secci√≥n",{title:"Acceso Denegado"}),n({name:"home"}))}else n()}));var uo=lo;n(1701);const mo="websapDatabase",po=3,go=[{name:"menuItems",keyPath:"id"},{name:"menuImages",keyPath:"id"},{name:"soldItems",keyPath:"id"},{name:"businessInfo",keyPath:"id"},{name:"users",keyPath:"id"},{name:"sharedMenus",keyPath:"id"}];async function ho(){return new Promise(((e,o)=>{try{const n=indexedDB.open(mo,po);n.onerror=e=>{console.error("Error al abrir la base de datos:",e.target.error),o(e.target.error)},n.onsuccess=n=>{const a=n.target.result;console.log("Base de datos abierta correctamente, versi√≥n:",a.version);const t=Array.from(a.objectStoreNames);let r=!0;const s=go.filter((e=>!t.includes(e.name)));if(s.length>0){console.error("Faltan los siguientes almacenes:",s.map((e=>e.name)).join(", ")),r=!1,a.close();const n=po+1;console.log(`Intentando actualizar a versi√≥n ${n} para crear almacenes faltantes`);const t=indexedDB.open(mo,n);t.onupgradeneeded=e=>{const o=e.target.result;for(const n of s)o.objectStoreNames.contains(n.name)||(o.createObjectStore(n.name,{keyPath:n.keyPath}),console.log(`Almac√©n creado: ${n.name}`))},t.onerror=e=>{console.error("Error al actualizar la base de datos:",e.target.error),o(e.target.error)},t.onsuccess=()=>{console.log("Base de datos actualizada correctamente con los nuevos almacenes"),e()}}else console.log("Todos los almacenes existen en la base de datos"),e()},n.onupgradeneeded=e=>{const o=e.target.result;for(const n of go)o.objectStoreNames.contains(n.name)||(o.createObjectStore(n.name,{keyPath:n.keyPath}),console.log(`Almac√©n creado: ${n.name}`))}}catch(n){console.error("Error cr√≠tico al inicializar la base de datos:",n),o(n)}}))}function fo(e){if(!e)return"";try{if("string"===typeof e&&e.includes("T")&&e.includes("/")){const o=e.split("/");if(3===o.length){const e=o[0].split("T")[0];return`${e}/${o[1]}/${o[2]}`}}if("string"===typeof e&&e.includes("-")){const o=e.split("-");if(3===o.length)return`${o[2]}/${o[1]}/${o[0]}`}const o=new Date(e);if(!isNaN(o.getTime())){const e=o.getDate().toString().padStart(2,"0"),n=(o.getMonth()+1).toString().padStart(2,"0"),a=o.getFullYear();return`${e}/${n}/${a}`}return e}catch(o){return console.error("Error al formatear fecha:",o),e}}async function vo(){try{await ho(),console.log("Base de datos inicializada correctamente");const e=(0,a.Ef)(Be);e.config.globalProperties.$filters={formatDate:fo},e.use(uo),e.mount("#app")}catch(e){console.error("Error al inicializar la aplicaci√≥n:",e)}}vo()}},o={};function n(a){var t=o[a];if(void 0!==t)return t.exports;var r=o[a]={exports:{}};return e[a].call(r.exports,r,r.exports,n),r.exports}n.m=e,function(){var e=[];n.O=function(o,a,t,r){if(!a){var s=1/0;for(d=0;d<e.length;d++){a=e[d][0],t=e[d][1],r=e[d][2];for(var i=!0,c=0;c<a.length;c++)(!1&r||s>=r)&&Object.keys(n.O).every((function(e){return n.O[e](a[c])}))?a.splice(c--,1):(i=!1,r<s&&(s=r));if(i){e.splice(d--,1);var l=t();void 0!==l&&(o=l)}}return o}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[a,t,r]}}(),function(){n.n=function(e){var o=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(o,{a:o}),o}}(),function(){var e,o=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__};n.t=function(a,t){if(1&t&&(a=this(a)),8&t)return a;if("object"===typeof a&&a){if(4&t&&a.__esModule)return a;if(16&t&&"function"===typeof a.then)return a}var r=Object.create(null);n.r(r);var s={};e=e||[null,o({}),o([]),o(o)];for(var i=2&t&&a;"object"==typeof i&&!~e.indexOf(i);i=o(i))Object.getOwnPropertyNames(i).forEach((function(e){s[e]=function(){return a[e]}}));return s["default"]=function(){return a},n.d(r,s),r}}(),function(){n.d=function(e,o){for(var a in o)n.o(o,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:o[a]})}}(),function(){n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce((function(o,a){return n.f[a](e,o),o}),[]))}}(),function(){n.u=function(e){return"js/"+({83:"employee",140:"reservas",224:"register",260:"shared-menu",328:"admin-restaurantes",441:"superadmin",594:"about",654:"admin-usuarios",770:"platos",884:"admin"}[e]||e)+"."+{70:"23a9c7a1",83:"c1af6227",140:"dca8d07a",207:"af4c0005",224:"aeadf46b",260:"1f75a3f7",328:"811fa75c",441:"cb464c08",457:"783786d0",460:"ef1c2356",463:"71b0ceb1",594:"bc4f37bc",654:"b50025b2",668:"335d74e6",770:"af87abfb",869:"8943b79c",884:"64249cfc",970:"bf0aa9bd",982:"84da56ab"}[e]+".js"}}(),function(){n.miniCssF=function(e){return"css/"+({83:"employee",140:"reservas",224:"register",260:"shared-menu",328:"admin-restaurantes",441:"superadmin",594:"about",654:"admin-usuarios",770:"platos",838:"sync-business-info",854:"menu",884:"admin"}[e]||e)+"."+{83:"3d5ca415",140:"e1c71206",224:"2f3b7f9e",260:"3b5ce1dd",328:"4d8e7f9a",441:"d9ebc473",463:"9936a330",594:"187c5855",654:"4bcf276b",770:"40de06ea",838:"183a93b2",854:"e5de4efe",869:"7aa96af8",884:"a3789379"}[e]+".css"}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)}}(),function(){var e={},o="websap:";n.l=function(a,t,r,s){if(e[a])e[a].push(t);else{var i,c;if(void 0!==r)for(var l=document.getElementsByTagName("script"),d=0;d<l.length;d++){var u=l[d];if(u.getAttribute("src")==a||u.getAttribute("data-webpack")==o+r){i=u;break}}i||(c=!0,i=document.createElement("script"),i.charset="utf-8",i.timeout=120,n.nc&&i.setAttribute("nonce",n.nc),i.setAttribute("data-webpack",o+r),i.src=a),e[a]=[t];var m=function(o,n){i.onerror=i.onload=null,clearTimeout(p);var t=e[a];if(delete e[a],i.parentNode&&i.parentNode.removeChild(i),t&&t.forEach((function(e){return e(n)})),o)return o(n)},p=setTimeout(m.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=m.bind(null,i.onerror),i.onload=m.bind(null,i.onload),c&&document.head.appendChild(i)}}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){n.p="/websap/"}(),function(){if("undefined"!==typeof document){var e=function(e,o,a,t,r){var s=document.createElement("link");s.rel="stylesheet",s.type="text/css",n.nc&&(s.nonce=n.nc);var i=function(n){if(s.onerror=s.onload=null,"load"===n.type)t();else{var a=n&&n.type,i=n&&n.target&&n.target.href||o,c=new Error("Loading CSS chunk "+e+" failed.\n("+a+": "+i+")");c.name="ChunkLoadError",c.code="CSS_CHUNK_LOAD_FAILED",c.type=a,c.request=i,s.parentNode&&s.parentNode.removeChild(s),r(c)}};return s.onerror=s.onload=i,s.href=o,a?a.parentNode.insertBefore(s,a.nextSibling):document.head.appendChild(s),s},o=function(e,o){for(var n=document.getElementsByTagName("link"),a=0;a<n.length;a++){var t=n[a],r=t.getAttribute("data-href")||t.getAttribute("href");if("stylesheet"===t.rel&&(r===e||r===o))return t}var s=document.getElementsByTagName("style");for(a=0;a<s.length;a++){t=s[a],r=t.getAttribute("data-href");if(r===e||r===o)return t}},a=function(a){return new Promise((function(t,r){var s=n.miniCssF(a),i=n.p+s;if(o(s,i))return t();e(a,i,null,t,r)}))},t={524:0};n.f.miniCss=function(e,o){var n={83:1,140:1,224:1,260:1,328:1,441:1,463:1,594:1,654:1,770:1,838:1,854:1,869:1,884:1};t[e]?o.push(t[e]):0!==t[e]&&n[e]&&o.push(t[e]=a(e).then((function(){t[e]=0}),(function(o){throw delete t[e],o})))}}}(),function(){var e={524:0};n.f.j=function(o,a){var t=n.o(e,o)?e[o]:void 0;if(0!==t)if(t)a.push(t[2]);else if(/^8(38|54)$/.test(o))e[o]=0;else{var r=new Promise((function(n,a){t=e[o]=[n,a]}));a.push(t[2]=r);var s=n.p+n.u(o),i=new Error,c=function(a){if(n.o(e,o)&&(t=e[o],0!==t&&(e[o]=void 0),t)){var r=a&&("load"===a.type?"missing":a.type),s=a&&a.target&&a.target.src;i.message="Loading chunk "+o+" failed.\n("+r+": "+s+")",i.name="ChunkLoadError",i.type=r,i.request=s,t[1](i)}};n.l(s,c,"chunk-"+o,o)}},n.O.j=function(o){return 0===e[o]};var o=function(o,a){var t,r,s=a[0],i=a[1],c=a[2],l=0;if(s.some((function(o){return 0!==e[o]}))){for(t in i)n.o(i,t)&&(n.m[t]=i[t]);if(c)var d=c(n)}for(o&&o(a);l<s.length;l++)r=s[l],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return n.O(d)},a=self["webpackChunkwebsap"]=self["webpackChunkwebsap"]||[];a.forEach(o.bind(null,0)),a.push=o.bind(null,a.push.bind(a))}();var a=n.O(void 0,[504],(function(){return n(9864)}));a=n.O(a)})();
//# sourceMappingURL=app.6e3e3e2b.js.map